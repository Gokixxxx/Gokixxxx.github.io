---
layout: post
title: 杨表
subtitle: 乐
tags: 数学
---

已经是老年选手了，却没有一个老年选手应有的科技树，这是为什么呢?

-----

杨图

就是把ferrers图的点换成可以填数的格子。我们还是用从上往下每行的长度表示一个杨图。

-----

杨表

杨图里填一个排列。标准杨表是每个格子填的数比右边和下边都小的杨表，如果连连边并固定所有极右下的格子，它就是一个拓扑序。

如果杨图里填的不是排列，性质就没这么好啦，但是也是有一些用的!比右边小，不比下边大的称为行严格杨表，反过来就是列严格。

一般我们说杨表，说的都是标准杨表。

-----

斜杨图，斜杨表

斜杨图是一个杨图挖去另一个杨图，我们可以用两个分拆$\lambda,\mu$来表示它为$\lambda/\mu$。斜杨表是斜杨图里填一个排列。

-----

rsk algorithm

对于一个排列，我们从左往右把每个数插进一个杨表。每次插入，从上往下扫每一行，如果要插的数比这一行所有数都大(或者这一行没有数了)，把它附到这一行末尾，否则找到它的后继和它交换，转而插入它的后继。

有这么几个结论 : 把排列翻转，则得到的杨表转置。把$p_i$变成$n-p_i+1$，则得到的杨表形状转置，内容不一定。

第一行的长度是lis长度。第一列的长度是lds长度。前$k$行长度的和是最长 只包含长不超过$k$的下降子序列 的子序列的长度，前$k$列反过来。

ctsc2017 最长上升子序列

那么我们就直接维护前缀rsk杨表对吧。

注意到如果杨表很长，我们会跑的很慢，但是它大概很窄。考虑只维护前$\sqrt{n}$行和前$\sqrt{n}$列的形状，因为$\sqrt{n}+1$行的长度必然不超过$\sqrt{n}$。后者可以通过维护$n-p_i+1$的杨表来完成。

rsk双射

注意到rsk是可逆的。我们插入的时候，记录下每个数最后停在哪，这可以用另一个杨表，称为记录表，来表示，也就是第$i$次插入的结束位置放一个$i$的杨表。那么我们就得到形状相同的杨表对到排列的双射，也就是说大小为$n$的每个形状杨表数量的平方之和是$n!$。

-----

杨表计数

hook formula用于计算一个杨图对应的标准杨表个数。定义一个位置的 hook length 钩长 是它，它正下方，它正右方的格子总数，那么答案就是$n!$除以各钩长的积。

容易在$O(n)$时间内算出一个杨表的所有钩长。

雅礼集训2017 D11 path

排成一个第$i$行长$a_i$的杨图，对于每种方案，在$i$行$j$列填$i$维第一次到达$j$的时刻，那么合法当且仅当这是一个杨表，问题就是杨表计数啦。

但是这里$\sum a_i$可能很大。注意到钩长很小，考虑统计每种钩长的出现次数，我们可以把$(i,j)$的钩长改写为$a_i-j+\sum\limits_k[a_k\geq j]-i+1$，于是它是$a_i-i,1\leq i\leq n$和$\sum\limits_k[a_k\geq j]-j,1\leq j\leq a_1$的卷积平移一位，此时可以沿着轮廓分治法法塔了，这里要分治是因为我们不能统计上杨图外面的点的钩长。不过继续注意到按照这么算，外面的点的钩长总是负数，所以直接卷一次然后扔掉$\leq 0$的位置即可。

_rqy题

$01$序列，每次可以把一个$10$子串换成$01$，求有多少种方案换到不能再换。$n\leq 2\times 10^5$。

最后当然是变成$0...01...1$这样的，并且$01$内部的顺序分别没有变。考虑我们把$0$编号为$0_1,...,0_{c_0}$，$1$同理，把操作序列写成每次选择一个$1_i$和一个$0_j$交换，那么一个操作序列合法当且仅当交换$1_i,0_j$的时候$1_i$真的在$0_j$前面一位，并且每一对逆序的$1_i,0_j$出现恰好一次。可以发现这个等价于$1_{i+1},0_j$和$1_i,0_{j-1}$都已经换完了，于是这就转化成杨表计数。和 雅礼集训2017 D11 path 一样做即可。

-----

bjwc2018 最长上升子序列

那么我们枚举这个杨表的形状，它的个数是分拆数，非常小对吧!然后就可以hook formula一下了。

集训队论文题

求长$n$，lds长度$\leq 3$的排列个数。

那么也就是不超过三行。我们枚举三行的长度，这是$O(n^2)$的，问题是怎么$O(1)$地更新钩长乘积。考虑第二行变长$1$的时候，第一行只有一个钩长受影响，第二行几乎所有钩长都变长$1$所以实际上变化量只有两边的$O(1)$。考虑第三行变短$1$的时候，第一行只有一个钩长受影响，第二行只有一个钩长受影响，第三行几乎所有钩长都变短$1$所以实际上变化量只有两边的$O(1)$。

-----

斜杨表计数

https://www.emis.de/journals/SLC/wpapers/s73vortrag/naruse.pdf

斜杨表的计数就没有一个hook formula这么劲爆的公式了。对于一个$d$行共有$n$个格子的斜杨表$\lambda/\mu$，我们构造$d\times d$的矩阵$A$满足$a_{i,j}=\frac{1}{((\lambda_i-i)-(\mu_j-j))!}$，如果$(\lambda_i-i)-(\mu_j-j)$是负数则是$0$，那么答案是$n!\det A$。

考虑刚才我们看到的那个游走问题，斜杨表计数其实就是说在$d$维空间中从$\mu$走到$\lambda$，保持各维坐标递增的方案数。这让我们一定程度上想起lgv引理。

考虑这么一个构造，让每维从$(1,\mu_i-i)$走到$(n,\lambda_i-i)$，每一步可以选择往右或者往上走，要求路径不交，每次$i$维往上走我们就在$i$维的最后记下此时的横坐标，那么这是一个每个值在$1,...,n$中的列严格斜杨表数。$-i$是为了把本来要求的不互相穿过变成lgv中的不交。

发现问题在于我们可能在一个横坐标往上走很多步，并且可能有很多行都在这个横坐标上走了。考虑类似于lgv引理枚举一个排列进行容斥，然后把每个横坐标的恰好一步的往上走分给每行，这里如果根据这个排列$i$最后走到$j$，那么就需要$(\lambda_i-i)-(\mu_j-j)$步，于是拿多项式系数选选就得到了公式中的$\frac{1}{((\lambda_i-i)-(\mu_j-j))!}$。但是这个还是比较感性啊。

xix open cup gp of zhejiang G. Good Game

进行一个经典容斥dp之后，就是模板 斜杨表计数 了。你可以在boj19023找到这个题。