---
layout: post
title: dp优化容斥
subtitle: 玄幻
tags: 数学 dp
---

[CF Gym 102978H Harsh Comments](https://codeforces.com/gym/102978/problem/H)

GP of 998244353!

CF上有一场番薯田大赛，大家都在往Announcement下面开喷。一共有$$n+m$$条评论，其中前$$n$$条是你发的，第$$i$$条获得了$$a_i$$个downvote；后$$m$$条是别人发的，第$$i$$条获得了$$b_i$$个downvote。现在Mike要删评，他会以downvote加权随机一个评论删掉，问期望多少次删光你发的评论。$$n,m\leq 100,a_i\leq 100,\sum a_i+\sum b_i<998244353$$，答案膜$$998244353$$。

你发现答案是$$n$$加上 删别人评论数量的期望。因为期望的线性性，我们可以拆开每一个别人发的评论，忽略掉所有其它别人发的评论，然后算它在删光你的评论之前删掉的概率，最后加起来。这好像是这题最重要的部分/jy

别人发的评论也会对取到各个评论的概率有影响，那么忽略其它评论为什么是对的?考虑一个经典问题，我有一个随机数生成器，它可以均匀随机生成$$1,2,3$$，现在我想均匀随机生成$$1,2$$怎么办?如果随出来$$3$$，那就忽略掉它再随一次，这样还是均匀随机的。这里的道理是一样的。如果你看不懂我在说什么，那就当没看到吧，你应该不会和我有一样的问题（

设$$a$$的和是$$s$$。

这个别人的评论，设它的downvote数是$$b$$，在所有你的评论之前的概率很好算，它就是$$\frac{b}{b+s}$$。但是在所有你的评论之后的概率就不是很好算。倒过来是不可行的，因为downvote数是不同的。

考虑容斥。我们枚举一个你的评论的子集$$S$$，这个别人的评论在$$S$$之前的概率就是$$\frac{b}{b+\sum_{i\in S}a_i}$$。可以忽略掉其它你的评论的原因，和上面类似。于是我们就得到了一个式子

$$
\sum_{S}(-1)^{\vert S\vert}\frac{b}{b+\sum_{i\in S}a_i}
$$

这个咋算?注意到$$\sum a_i$$最大也只有$$10000$$，所以背包一下求出每一种$$\sum a_i$$对容斥系数的贡献就好了。

也可以min-max容斥，实际上差不多?

-----

[ARC093F Dark Horse](https://www.luogu.com.cn/problem/AT3981)

发现你在哪答案都是一样的，因为可以通过换换换把你换到第一位，所以不妨只考虑你在第一位，最后乘上$$2^n$$。

考虑第一轮你要对战的是$$p_2$$，第二轮是$$\min(p_3,p_4)$$......第$$k$$轮是$$\min(p_{2^{k-1}+1},...,p^{2^k})$$。如果她们都不是你的对手，你就赢了。



-----

[AGC041F Histogram Rooks](https://www.luogu.com.cn/problem/AT5697)

