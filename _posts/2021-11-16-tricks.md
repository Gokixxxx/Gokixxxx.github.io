---
layout: post
title: 如果我不知道把一些东西放在哪里，那就放在这里吧
subtitle: 实际上是一些trick
tags: 杂项
show: true
---

呃。

-----

Y-center

`lca(x,y)^lca(y,z)^lca(x,z)`

-----

树上动态斯坦纳树边权和

对于一个点集，按dfn排序，相邻dis之和(转一圈)就是斯坦纳树边权和的两倍。

可以用set维护，更牛逼的方法是veb。

-----

操作独立删少量边动态图连通性

大概是说每次删一个集合，集合大小不超过$$15$$，然后求是不是连通，查询独立。

如果dfs树上一条树边被删了，并且所有跨过它的非树边也删了，那就完蛋了。

xor hash。每条非树边分配一个权值，树边的权值是跨过它的非树边权值的xor，那么如果删掉的边线性相关，那就说明完蛋了。用线性基判断是否线性相关。

-----

毛毛虫修改查询

定义树上一条链的毛毛虫是说这条链加上它的邻接点。支持链/子树/毛毛虫 加/求和，呃实际上感觉可以做任意交换并结合的信息。你说为什么结合?因为子树或者毛毛虫上的信息不结合你难道强行规定顺序/jy

考虑重链剖分之后，每条链走三遍来分配编号 : 

 - 第一遍从上到下分配重链。

 - 第二遍从上到下分配重链上每个点的所有轻儿子。这导致除了以$$1$$为根的链，别的链在第一步的时候，链头是已经分配完了的，它和重链剩下的部分不连续，需要特殊处理。

 - 第三遍从上到下递归重链上每个点的所有轻儿子的重链。

how it works?

 - 对于链，显然。

 - 对于毛毛虫，每次往上跳需要考虑一条重链的一个区间的所有点和它们的所有轻儿子，这是两个标号区间。注意如果信息不幂等，需要换一种对链头的特殊处理(实际上就是不把它算到这条重链里，除了在lca处特判)，因为它会作为它父亲的一个轻儿子。

 - 对于子树，考虑这个点所在的重链从它开始往下的部分。它的子树分为这半条重链，这半条重链上每个点的轻儿子，这半条重链上每个点的轻子树，而三部分分别是一个标号区间。

很难写，但是它确实可行。我觉得这个东西肯定不是我第一个搞出来的，所以有没有人有一份简洁的实现?

呃另外，这个科技的启发还是动态链分治有很强的扩展性。

-----

Prufer序列

$$n$$个点的有标号无根树和长$$n-2$$值域在$$1,...,n$$的序列形成双射。每个点在序列中的出现次数是它的度数$$-1$$。

-----

Pick定理

顶点都是格点的多边形面积是$$S=a+\frac{b}{2}-1$$，其中$$a$$是多边形内部的格点数，$$b$$是边上的格点数。

-----

三元环计数

无向图三元环计数说的是，我们先给边定向，从度数小的连向度数大的，然后枚举两层出边打标记，再枚举一条出边统计答案。

这个可以推广到四元环，也就是枚举两层出边打标记，再枚举两层出边统计答案。

这样做，每个点的出度不超过根号，于是复杂度就是正确的(实际上反过来连也是正确的，因为入度不超过根号)。同时我们也证明了三元环和四元环的个数都是$$O(m\sqrt{m})$$级别。

证明是，考虑到一个点连到的点度数都比它大，于是如果它的出度是$$d$$，那么它连向的点的度数都至少是$$d$$，于是这些点的度数和至少是$$d^2$$。这些点之间最多连$$\frac{d(d-1)}{2}$$条边，每条在度数中会贡献两次，所以它们连的边至少有$$d^2-\frac{d(d-1)}{2}$$条，于是$$d$$不能超过大约$$\sqrt{2m}$$，否则就会飞。

这个比根号分治常数要小，并且在一些问题上有更好的性质。

比如 : 

lxl口中的经典题

给一张图，支持修改一个点权，查询一个点邻点的点权和。

来自vuq的题

给一张图，一条边的边权是端点点权的和，支持修改一个点权，求所有边的边权max。

做法是一样的，套这个trick然后每个点维护入边的贡献，修改的时候爆力改出边，查询的时候爆力加入出边。

-----

双栈代替队列维护双指针

有些时候我们双指针的时候需要维护一个满足某种性质的极长区间，数据结构问题是支持判断是否能插入，插入到右边，删除左边。

有些时候删除比较困难，但是合并是简单的，于是我们可以用两个栈来维护。具体地，我们用两个栈维护当前的可行区间的左半边和右半边，这样插入就是push到右半边，删除就是撤销左半边。什么时候把左半边弹空了，我们就爆力重构，把当前的合法区间全部塞进左边的栈，把右边的弹空。这样每个元素只会被插入撤销两次，可以看个图 : 

![img](/img/2021-11-16-tricks/2-stacks.png)

这个也被用于类似于滑动窗口的优化建图问题，也就是我们左边后缀和优化建图而右边前缀和，爆了就重构。

-----

Stern-Brocot Tree

有理数的二叉搜索树。关于复杂度的性质是$$\frac{n}{m}$$到$$1$$的路径上不超过$$\log$$次转向，这可以用来在有理数上二分，也就是倍增一口气走到哪。

s-b树只包括正有理数，如果加入负的，我们得到s-b环(stern-brocot wreath)(从$$\frac{0}{1},\frac{1}{0},\frac{0}{-1},\frac{-1}{0},\frac{0}{1}$$开始)，它表示平面上所有有理方向。

s-b树上两个点lca的意义是，它俩之间分母最小的数。

-----

三的倍数

如果$$k\bmod{d}=1$$，那么一个数膜$$d$$等于它的$$k$$进制下各位和膜$$d$$。

这个结论还有更强的形式。比如$$\mathrm{ord}_7(10)=6$$，所以第$$6$$位和第$$0$$位的贡献是一样的，所以我们可以六位一组加起来。

再比如$$2\mid 10$$，那么我们只需要看最后一位。

所以结论是，如果$$k\bmod{d}=0$$，那么一个数膜$$d$$等于它的$$k$$进制下最后一位膜$$d$$；否则这个数膜$$d$$等于它的$$k$$进制下每$$\mathrm{ord}_d(k)$$位一组加起来得到的数膜$$d$$。

还有一个问题，如果$$k^i\bmod{d}$$都不是$$0$$但是也都不是$$1$$怎么办呢?你发现这不可能出现，因为必然会出现两个相同的，而它们相除就得到$$1$$。