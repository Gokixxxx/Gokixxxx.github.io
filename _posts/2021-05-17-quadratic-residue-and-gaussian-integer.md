---
layout: post
title: 二次剩余与高斯整数
subtitle: /fad
tags: 数论
---

我可能有时候用 质数，有时候用 素数，大家懂的都懂即可（

## 二次剩余

以下默认$$p$$是奇素数。

我们称 $$n$$是膜$$p$$的二次剩余 当且仅当存在$$x$$使得$$x^2\bmod{p}=n$$，此时这个$$x$$称为$$n$$的离散平方根。特别的，$$0$$不是二次剩余。

### 勒让德符号和欧拉准则

众所周知，有个勒让德符号$$\left(\frac{n}{p}\right)=n^{\frac{p-1}{2}}\bmod{p}$$。

关于这个符号怎么打，我看了wiki，好像就是直接括号+分数线......可以右键上面的公式看具体怎么打。

下面是重要结论。

**欧拉准则**

对于$$\left(\frac{n}{p}\right)=n^{\frac{p-1}{2}}\bmod{p}$$ : 

 - 如果$$n=0$$，它是$$0$$

 - 否则，如果$$n$$是膜$$p$$的二次剩余，它是$$1$$

 - 否则，它是$$-1$$

。这个东西就很好。

**证明**

必要性 : 如果存在$$x^2\equiv n$$，那么代入一下就得到$$n^{\frac{p-1}{2}}=x^{p-1}\equiv 1$$。

充分性 : 如果$$n^{\frac{p-1}{2}}\equiv 1$$，那么我们找到一个原根$$g$$并设$$n=g^k$$，于是$$g^{\frac{k(p-1)}{2}}\equiv 1$$。

原根的阶是$$p-1$$，所以这说明$$(p-1)\mid\frac{k(p-1)}{2}$$，容易发现此时$$k$$必须是偶数，于是$$g^{\frac{k}{2}}$$就是$$n$$的一个离散平方根。

### Cipolla

Cipolla是一个随机算法。要证明它的复杂度，需要下面的引理 : 

**引理1** 膜$$p$$，恰有$$\frac{p-1}{2}$$个二次剩余。

**证明** 每一个数和它的相反数，应该是同一个数的离散平方根。所以这个结论好像很自然。

接下来需要证明，如果$$x,y$$不同，并且也不是相反数，那么$$x^2\not\equiv y^2$$。

反证，如果$$x^2\equiv y^2$$，那么$$(x+y)(x-y)\equiv 0$$，这就说明$$x,y$$要么相同，要么相反。

注意到这个证明并没有依赖 $$p$$是素数，所以它对所有数都是成立的。

-----

Cipolla先找到一个$$w$$使得$$w^2-n$$是非二次剩余。然后扩域，令$$\omega^2=w^2-a$$，则$$(n+\omega)^{\frac{p+1}{2}}$$就是$$n$$的一个离散平方根。

要找到这个$$w$$，容易发现因为二次剩余有恰好一半，最多随机期望四次就可以得到一个$$w$$。

这个结论建议背诵（

要证明也可以，我们来照抄wiki。

**引理2** $$\omega^{p-1}\equiv -1$$。

**证明** 因为$$p-1$$是偶数，$$\omega^{p-1}\equiv w^{\frac{p-1}{2}}$$，又因为$$w$$不是二次剩余，所以它确实等于$$-1$$。

-----

**引理3** $$(a+b)^p\equiv a^p+b^p$$。

**证明** 二项式定理展开 : 

$$
(a+b)^p=\sum_{i=0}^p\binom{p}{i}a^ib^{p-i}
$$

你发现只有$$i=0,p$$的时候，$$\binom{p}{i}$$中不含因子$$p$$，所以其它项都被膜没了，只剩下这两项，就得到了$$a^p+b^p$$。

直接推论是，$$(x+y\omega)^p\equiv x^p+y^p\omega^p\equiv x^py^p\omega^{p-1}\omega\equiv x^p-y^p$$。

-----

**定理** Cipolla是正确的，或者说$$(n+\omega)^{\frac{p+1}{2}}$$确实是$$n$$的离散平方根。

**证明** $$(w+\omega)^{p+1}=(w+\omega)(w+\omega)^p=(w+\omega)(w-\omega)=w^2-\omega^2=w^2-(w^2-n)=n$$。

/jy所以直接搞就好了。复杂度是$$O(\log p)$$。

### exCipolla

照抄wiki。

Cipolla可以支持膜奇素数幂，而膜$$2^k$$很好办，因此为了对付某些毒瘤出题人，可以扩展到任意模数。这个东西我喜欢叫它exCipolla（

要算$$n$$膜$$p^k$$的离散平方根，设$$w$$是随便一个使得$$w^2-n$$**膜$$p$$意义下**是非二次剩余的数(注意不是膜$$p^k$$)，$$t=\frac{1}{2}(p^k-2p^{k-1}+1),s=\frac{1}{2}p^{k-1}(p+1)$$，那么答案是

$$
\pm\frac{1}{2}n^t\left((w+\omega)^s+(w-\omega)^s\right)
$$

。这里不给出证明。

呃你说怎么搞膜$$2^k$$的?你发现$$n^{2^{k-1}}$$就是一个解，我不知道怎么来的，不过抄一下对不对都没关系。

## 高斯整数

高斯整数是形如$$a+bi$$的数，其中$$a,b$$都是整数。

画到复平面上，高斯整数就是整点。

高斯整数对加法和乘法都是封闭的，并且存在加法单位元、逆元和乘法单位元。然而只有$$1,-1,i,-i$$是可逆元(有乘法逆元)，当然这四个构成一个群，称为高斯整数的可逆元群。

对于$$z=a+bi$$，定义$$\overline{z}=a-bi$$。定义范数$$\Vert z\Vert=a^2+b^2$$。

容易发现几个性质 : $$\overline{u+v}=\overline{u}+\overline{v},\overline{uv}=\overline{u}\overline{v},\Vert u\Vert=u\overline{u},\Vert uv\Vert=\Vert u\Vert\Vert v\Vert$$。

### 高斯素数

高斯整数里也有素数。当然这里的素数还是不能被别的数乘一乘得到的数。

这里先只给出定义，高斯素数的判定定理是基于费马二平方和定理的，这个定理的证明则要用到高斯素数的概念/jy

### 带余除法，取膜，gcd和exgcd

我们定义$$\lfloor\frac{a}{b}\rfloor$$就是把$$\frac{a}{b}$$的实部虚部都四舍五入得到的东西。

为什么这么搞?因为性质确实很好。具体怎么好......你可以认为它有和数论里面带余除法一样好的性质。

```cpp
#define round(x) ((int)((x)+0.5))
inline Complex operator / (const Complex &a,const Complex &b)
{
    double x=sqr(b.x)+sqr(b.y);
    return {round((a.x*b.x+a.y*b.y)/x),round((a.y*b.x-a.x*b.y)/x)};
}
inline Complex operator % (const Complex &a,const Complex &b){ return a-a/b*b; }
Complex gcd(Complex a,Complex b){ return b.x||b.y?gcd(b,a%b):a; }
```

啊你说exgcd在哪里?它跟普通的exgcd完全一样，所以没什么好说的（实际上是我忘了exgcd咋写了

### 二平方和分解

高斯整数的重要应用。

#### 费马二平方和定理

**费马二平方和定理** 一个奇素数$$p$$可以被分解成两个平方数的和，当且仅当它可以表示成$$p=4k+1$$，此时一定有恰好一种分解方案。

这里给出一个有趣的证明，它直接地启发我们得到构造二平方和分解的算法。

**证明** 考虑一定存在一个$$w$$使得$$w^2\equiv -1\pmod{p}$$，因为膜$$p=4k+1$$下，根据欧拉准则$$-1$$一定是二次剩余。

所以我们知道$$p\mid w^2+1=(w+i)(w-i)$$。如果$$p$$是高斯素数，后面两个必然有一个是它的倍数，但是你除一下发现都除不尽，所以$$p$$不是高斯素数。

于是考虑$$p$$的高斯素数分解，假设它有一个素因子$$u=a+bi$$，设$$p=uv$$。因为$$p$$不是高斯素数，$$v$$一定不是可逆元。同时因为$$u$$是高斯素数，它也一定不是可逆元。

考虑它们的模长，我们有

$$
p^2=\Vert p\Vert=\Vert u\Vert\Vert v\Vert=u\overline{u}v\overline{v}
$$

。由于$$\Vert u\Vert$$是正整数，它一定是$$p^2$$的因数之一，而$$p^2$$只有$$1,p,p^2$$三个因数。

如果$$\Vert u\Vert=1$$或$$p^2$$，都会导出$$u$$或者$$v$$是可逆元，所以必有$$\Vert u\Vert=p$$，于是也有$$\Vert v\Vert=p$$。

这俩东西模长相同，乘起来是$$p$$，说明它们只能共轭，也即$$v=a-bi$$，于是$$p=uv=(a+bi)(a-bi)=a^2+b^2$$，我们就得到了解。

剩下的问题是证明唯一性，和$$4k+3$$型素数不能这么分解，此处略去，可以自行百度（

#### 分解$$4k+1$$型素数

接下来，如何构造$$4k+1$$型素数的二平方和分解?

那个$$w$$很好搞，随就行了。接下来问题是怎么找到素因子$$u$$。

你发现我们不需要找到素因子，只需要找到一个非平凡因子即可，根据分解的唯一性它就是我们要找的素因子。

考虑$$\gcd(p,w+i)$$，这个东西首先显然是因子。

它一定不是$$p$$或者$$p$$乘上可逆元，因为$$w+i$$不能被$$p$$除尽，这个刚才证过了。

它一定不是$$1$$或者$$1$$乘上可逆元，因为$$p\mid(w+i)(w-i)$$，如果$$\gcd(p,w+i)=1$$就说明$$p\mid(w-i)$$，而$$w-i$$也不能被$$p$$除尽，这个刚才也证过了。(可以看出实际上$$p$$和$$1$$是对称的。)

于是我们证明了，取$$\gcd(p,w+i)$$就可以得到上面证明中的一个$$u$$。

#### 分解任意数，求方案数

接下来，如何构造任意数$$n$$的二平方和分解，并求方案数?

还是考虑构造$$u=a+bi$$使得$$u\overline{u}=n$$。

先把$$n$$质因数分解。

对于$$4k+3$$型质因子，它不能分解成$$z\overline{z}$$的形式，所以我们只能把它分成两半乘到$$u$$和$$\overline{u}$$里面去，所以如果这个质因子次数不是偶数则无解(不可能得到共轭)。

对于$$4k+1$$型质因子，设它的次数是$$e$$，利用刚才的算法可以把它分解成$$z^e\overline{z}^e$$，我们可以选择一个$$t$$，把$$z^t\overline{z}^{e-t}$$乘到$$u$$，$$z^{e-t}\overline{z}^t$$乘到$$\overline{u}$$，这样可以保证它们共轭，分配到方案数是$$e+1$$。

对于$$2$$，可以分解成$$(1+i)^e(1-i)^e$$，不过你发现不管怎么分配都是本质相同的。

最后还要乘上四个可逆元，方案数变成四倍。

#### 分解可行性和方案数前缀和

容易发现每个质因子是独立的，同时这个可行性和方案数都是积性函数，所以可以用Min_25筛求前缀和。

### 高斯素数判定

**定理** 一个数$$u=a+bi$$是高斯素数，当且仅当下面两个条件中任意一个成立

 - $$a,b$$中一个是$$0$$，另一个是$$4k+3$$型素数

 - $$\Vert u\Vert=a^2+b^2$$是(非$$4k+3$$型)素数

。

**证明** 

首先证明 : 高斯素数$$u$$的模长$$\Vert u\Vert$$要么是素数，要么是素数的平方。

考虑把$$\Vert u\Vert=u\overline{u}$$质因数分解，那么分解中一定存在一个素数$$p_i$$，使得$$u\mid p_i$$，否则$$u$$就不是高斯素数了。

于是我们显然可以得到$$\overline{u}\mid \overline{p_i}=p_i$$。于是$$\Vert u\Vert=u\overline{u}\mid p_i^2$$，所以$$\Vert u\Vert$$一定是素数。

接下来第一个好像很简单。

充分性 : 根据二平方和定理，$$4k+3$$型素数不能分解成共轭复数的积，而如果不是共轭复数乘上可逆元，积不可能是实数。

必要性 : 不是素数随便分，$$2=(1+i)(1-i)$$，$$4k+1$$型素数可以分解成共轭复数的积。

第二个好像也不难。

充分性 : 如果$$u=vw$$，那么$$\Vert u\Vert=\Vert v\Vert\Vert w\Vert$$，而$$\Vert u\Vert$$是质数，所以$$v,w$$必定一个是可逆元，一个是$$u$$乘上可逆元，这个分解是平凡的。

必要性 : 上面证过了。

## 说在后面

好像没什么了。又水了一篇blog（