---
layout: post
title: 一轮省集
subtitle: /kk
tags: 题选做
---

## Day1

### 模拟赛

兔队搬题。

T1 permutation

XXI Opencup, GP of Tokyo, Problem. I

CF Gym 102978I

给一个长$$m$$，值域$$[1,n]$$的串$$x$$，计数有多少个长$$n$$的排列以这个串作为字典序最小的长$$m$$的子序列。$$n,m\leq 2.5\times 10^5$$，膜$$998244353$$。

两个特殊性质部分分，分别是$$x$$单增和$$x_2=1$$。

先考虑第二个部分分。什么时候不能选$$x_1=1$$作为字典序最小的子序列?当$$1$$后面不足$$m-1$$个数的时候。而$$x_2=1$$，这说明$$1$$一定在$$n-m+1$$这个位置上，而剩下的部分一定紧凑地排在后面。

所以，我们考虑$$x_1$$的位置，它可能在前面任何一个位置，进一步你发现前面是全排列。但是如果前面有比$$x_1$$小的，那么不可能取到$$x_1$$，我们特判一下输出$$0$$。

然后考虑第一个部分分。考虑把不在这个子序列里面的数插入进去。打表你发现此时每个数可以插入的空位是一个前缀，并且随着数的增大这个前缀变长，具体怎么样可以自己观察。这样我们的决策就没有后效性了，所以我们直接从小到大乘起来就好了。

正解考虑把这两个结合起来。(然而我都打出来了，没想到正解)

考虑第一个$$x_i>x_{i+1}$$。此时一定是$$x_{i+1}$$因为后面的数太少了之前没法取，可以类似第二个部分分得到它和后面的数位置已经确定。此时前面的数就是第一档部分分了。复杂度$$O(n)$$。

T2 game

2020-2021 ACM-ICPC, Asia Nanjing Regional Contest, Problem. M

CF Gym 102992J

背景是一个Nim，这里只说转化后的问题。

维护一个序列，支持区间对一个数取$$\max$$，查询区间异或和，或者区间中有多少个数在第$$k$$位上是$$1$$。$$n,m\leq 2\times 10^5$$。

考虑吉老师线段树。做完了。复杂度$$O(n\log n\log v)$$。

当场写完!结果修改写错了（

T3 skate

XIX Open Cup, GP of Korea, Problem B

CF Gym 102059B

有一个$$n\times m$$的滑冰场，场上每个格子可能是空地或者障碍。

你的移动方式是，选择上下左右中的一个方向，然后向那个方向滑过去，直到到达边界或者撞到障碍才停下。

你从一个空地出发，需要经过一些标记点(滑过去也算经过)。问有没有可能经过所有标记点。$$n,m\leq 50$$，$$5$$组数据。

考虑一个经典做法，我们对于每个位置，求出它所在的极长的横着和竖着的段。显然有如果你在一个极长段的任意一个位置停住了，你接下来都可以走遍这个段。同时，一个标记点被走到了，当且仅当它所在的横着的段和竖着的段至少一个被走到了。

你看到了一个2-SAT!

然后问题就是怎么在2-SAT上描述各种限制，从而充要地得到一条路径。

实际上只需要表示两个段不能互相到达，此时选了一个不能选另一个。为什么满足这个限制就等价于有解?

首先证明充分性，即满足这个限制一定有解。如果满足这个限制，说明我们选的任意两个段$$a,b$$，要么$$a$$可以走到$$b$$，要么反过来，要么可以互相走到。所以这是一个竞赛图加上一些重边，我们缩SCC之后还是有一样的结论——得到一条链，沿着链走就可以得到一条合法路径。

然后必要性显然，证完了。复杂度$$O((nm)^2)$$。

-----

期望得分50+100+52=202，实际得分60+15+4=79。

挂分王!

### 讲课

图论咋提宣讲。

Jump

XVI Open Cup, Grand Prix of Asia

https://official.contest.yandex.ru/opencupXVI/contest/2145/problems/C/

http://opentrains.snarknews.info/~ejudge/team.cgi?contest_id=010391

有一个数轴，数轴上有一堆点$$a_i$$，有一堆询问，问你从$$s$$出发，每次选择一个$$a_i$$进行对称，最少几次到$$t$$。$$n\leq 200,v\leq 10^4,q\leq 10^5$$。

考虑对称出来式子的形态，是$$2(a_{p_k}-a_{p_{k-1}}+...+(-1)^{k+1}a_{p_1})+(-1)^ks$$，移个项问题就变成求一堆$$a_i$$的交错和等于$$t-(-1)^ks$$，并且项数尽量少。我们枚举$$k$$的奇偶性，然后就可以得到一个更简单的式子。

考虑拆点，每个点拆成正和负两个点，然后从$$0$$开始跑最短路，胡乱连边即可。复杂度$$O(v\log v+q)$$。

-----

Today is a rainy day

ICPC 2015 Asia East - Beijing Regional

https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=5275

给定串$$s,t$$，你可以对$$s$$进行若干次操作，每次是修改一位或者把一种字符完全替换成另一种，求把$$s$$变成$$t$$的最小操作数。字符只有123456，$$n\leq 100$$。

考虑替换操作一定可以放到最前面做，所以我们可以枚举一个映射，然后直接搞。映射只有$$6^6$$种，可以接受。

不过怎么才能找到最小操作数呢?考虑最多只有$$6$$次操作，先bfs一下预处理，复杂度就是$$O(6^4)$$的样子，不过它是多少都没问题。

-----

Walk

收录于 优化建图。

-----

树上传送

LYDSY Monthly Contest

https://www.lydsy.com/JudgeOnline/problem.php?id=5129

简单题。直接点分治优化建图。

-----

Travel

http://acm.scu.edu.cn/soj/problem.action?id=4444

有一张完全图，其中$$m$$条边边权是$$a$$，剩下的边权是$$b$$，求$$1$$到$$n$$的最短路。$$n\leq 10^5,m\leq 5\times 10^5$$。

考虑$$1\leftrightarrow n$$的边权。如果是$$a$$，那么答案已经至多是$$a$$了，要想更新答案我们不可能再走$$a$$，此时是保留所有$$b$$边的一个bfs，或者说补图bfs。如果这个边权是$$b$$就很好说。

考虑因为是完全图，我们本来应该每个点都找一遍$$1,...,n$$来着。为了搞快点，如果一个点已经在队列中，我们希望找邻接点的时候跳过它。

每次扔进队列都是删除。删除、查找后继，可以使用并查集或者链表来实现。并查集复杂度$$O((n+m)\alpha(n))$$，或者链表$$O(n+m)$$。

-----

Kirakira

Moscow International Workshop ACM ICPC 2016 Day 3, Division A: SJTU Dreadnought Contest

https://official.contest.yandex.ru/mipt2016autumn/contest/3163/enter/

数学题。用递推处理一个什么东西，然后直接建图跑最大环。具体是啥可以自己看（

-----

新年的繁荣

UOJ Goodbye Yiwei

https://uoj.ac/problem/176

好题。将会收录于 sos-dp。

-----

病毒实验

JOI Open 2019

https://loj.ac/p/3155

好题。看懂了再写。

-----

Expectation

矩阵树定理+拉插裸题。

-----

白金元首与独舞

CodePlus 2017 December Contest

https://loj.ac/p/6259

胡乱建图，内向树计数就是了。

-----

生成树

三种颜色的边，求蓝绿边数分别不超过$$g,b$$的生成树个数，膜$$998244353$$。$$n\leq 40$$。

非常简单，直接拿生成函数扔进去，为了快速我们就拉插插出来。

怎么二元多项式拉插?我也不会，好像一会要讲。

复杂度$$O(n^5)$$。

-----

生成树计数

Beijing Team Training

https://www.luogu.com.cn/problem/P5296

经典题。用奇怪的生成函数。

-----

C4

AtCoder Grand Contest 051

https://atcoder.jp/contests/agc051/tasks/agc051_d

best定理。

-----

Binary Code

ICPC 2016, Northeastern European Regional Contest(Northern Eurasia).

https://codeforces.com/gym/101190/problem/B

2-SAT。树上前缀和优化建图。

-----

Flags

AtCoder Regular Contest 069

https://atcoder.jp/contests/arc069/tasks/arc069_d

还是2-SAT。用神秘分块砍$$\log$$。

-----

LYZ

16th Polish Olympiad in Informatics

https://szkopul.edu.pl/problemset/problem/kadKFW3YScAMW8o20u0BctQh/site/?key=statement

用Hall定理推式子，转成经典数据结构问题。还是很妙的。

Hall定理说的是，一个二分图，左部点有完美匹配，当且仅当每个左部点子集邻接的右部点个数都至少是这个子集的大小。

-----

Rooms

给一张地图，每个房间是极大同色四连通块，每次查一个矩形与多少房间有交。$$n,m\leq 2000,q\leq 5000$$。

复杂度是$$O(q(n+m))$$。

考虑每个连通块选一个关键点，然后先统计矩形内的关键点数量，可以使用二维前缀和。

考虑关键点不在矩形内的所有房间，它们一定跟这个矩形有交。所以我们枚举矩形边上一圈的点，统计关键点在外面的部分。

-----

Xor-matic Number of the Graph

图，边权，对于所有三元组$$(u,v,w)$$满足$$u<v$$，且$$u,v$$之间有一条边权异或和为$$w$$的路径，求$$w$$之和。$$n\leq 10^5,m\leq 2\times 10^5,w\leq 10^{18}$$，膜1e9+7。

类似 最大xor路径。求出所有非树边确定的环，扔进线性基，然后问题变成

-----

Bajtocja

有$$d$$个点集相同的图，一开始都没有边，支持在某个图连一条边，或者查询有多少点在所有图中都连通。$$d\leq 2000,n\leq 5000,m\leq 10^6$$。

考虑每个图开一个并查集，两个点在所有图都连通相当于它们的集合代表元都相同。

给每个点在各图的代表元们进行hash。合并集合的时候，我们启发式地爆力改较小的集合里面的点，复杂度是$$O(dn\log n+m\alpha(dn))$$。用神秘hash table维护hash值即可。

-----

Rally

给一个DAG，可以删一个点，最小化最长路长度。

考虑拓扑排序。枚举删掉的点，那么

-----

Tournament cycle

求有多少个有标号竞赛图包含一个大小为$$k$$的环。$$n,k\leq 5000$$。

结论 : 如果有一个大小为$$k$$的环，那么有所有大小为$$1,...,k$$的环。

我们反过来算，计算有多少个竞赛图没有大小为$$k$$的环。

相当于是说没有大小至少是$$k$$的SCC。

进行dp，设$$dp(i)$$表示$$i$$个点的答案，就可以枚举最后一个SCC的大小，用组合数选出来这个SCC进行转移。

然后问题变成这个SCC的方案数。这是著名问题，可以dp或者带项式预处理。

诶这个dp也可以带项式加速?不知道。

## Day2

### 模拟赛

还是兔队搬题。

T1 segtree

zsy瞎写过了/xia

qlr随机过了/xia

suxxsfe随机55/xia

我输出随机数爆零/xia

原题CF1120D，有魔改。

给一棵树，一开始点权全是$$0$$。你可以进行若干次操作，每次选择一个点，给它的子树都加上一个数。每个点有一个代价$$v$$，每次操作这个点需要支付对应的代价。求最小的代价，使得每个叶子的点权不同。$$n\leq 2\times 10^5,v\leq 10^9$$，你的操作数必须是$$[1,10^9]$$的整数。

这题难点在于构造操作数。

只是求出要操作什么东西的话，非常简单!我们先假设每次操作都可以随便选，那么两个叶子到根的链上，被操作的集合不同，它们的值一定可以不同。

然后你就发现，我们从每个叶子都选了开始贪心，每个点可以选一下来换子树里一个点不选。可以用线段树或者可并堆维护贪心，也可以树形dp。

然后至于怎么构造?直接随机是不行的，因为有生日悖论，$$2\times 10^5$$得把值域开到$$10^{12}$$甚至更多才能稳过。

但是qlr太神了!他写的有冲突就重新随，实践中大约30次就可以得到一组对的。

考虑一个简单结论，每个叶子到根路径上最深的被操作的点一定是不同的，证明显然。

所以这个形成了一个一一对应关系，我们可以利用这件事来操纵每个叶子的权值。

找到被操作点和叶子的对应关系，然后自顶向下进行调整。兔队的做法是钦定每个叶子的值和它的编号膜$$n$$同余，每次操作都把当前点对应的叶子的权值搞对。

复杂度$$O(n)$$。

-----

T2 strhash

终于不挂分了 qwq

另外为什么都是T2最简单啊（

给一个随机字符串，求它所有子串中hash值最大的。基数$$2333333$$，模数$$998244353$$。多组数据，$$T\leq 50,\sum \vert s\vert\leq 2\times 10^6$$。

考虑因为是随机，子串的hash值应该近似于均匀分布，所以从上到下枚举应该期望$$O(\frac{p}{n^2})$$次就可以找到答案。

然后就是怎么判断枚举的答案$$k$$是否可行。考虑推式子

$$
\begin{aligned}
pre_{r}-base^{r-l+1}pre_{l-1}&=k\\
base^{-r}(pre_{r}-k)&=base^{-l+1}pre_{l-1}
\end{aligned}
$$

然后我们就可以枚举一个右端点，用hash table支持查询左端点，如果这个值最小的左端点在枚举的右端点左边那就可行。复杂度$$O(\frac{p}{n^2}n)=O(\frac{p}{n})$$。我忘了预处理幂，多个$$\log$$，但是手写了hash table，跑的飞快（

当$$n$$很小时，可以爆力$$O(n^2)$$。稳得很。

结果因为这题直接小数据爆力，大数据998244352，就可以得到85pts，我被神们吊起来打。

-----

T3 multbfs

原题CF1086F。

3 5 0 0

有一个平面，一开始有一些bfs的起点，它们的$$dis$$为$$1$$；每次会扩展到切比雪夫距离为$$1$$的点。对所有$$dis$$不超过$$k$$的点的$$dis$$求和。$$n\leq 50,1\leq k\leq 10^8,-10^8\leq x,y\leq 10^8$$，膜$$998244353$$。

把$$dis$$看成时间来考虑。

发现每一时刻，被遍历到点会扩大一圈，而答案会增加(这一时刻的面积减去上一时刻的面积)乘

这是一个分段函数，有$$O(n^2)$$个时刻会有一些块撞在一起(枚举两个起点，它们切比雪夫距离的一半上取整就是相交时间)，而每一段内部是一个三次函数，可以拉插插出来。

然后怎么单点求值?这是两个矩形并面积的差，可以用扫描线。

不过并没有必要开线段树!瞎写就可以了，复杂度$$O(n^4)$$。

唐椰叶给了一个$$O(n^2)$$做法，说的是，从每个点画横线竖线，会把平面切成$$O(n^2)$$个矩形。然后你就发现，每个

-----

期望得分24+100+12=136，实际得分0+100+12=112。至少不是挂分王了。

### 讲课

数据结构!

Sinao

有一排草，一开始高度全是$$0$$，每天每棵草会长高$$a_i$$，在若干个$$d_i$$天，兔会吃掉所有高度超过$$b_i$$的草，求每次吃了多少草。$$n,q\leq 10^5$$。

按$$a_i$$排序，每次吃掉的就是一个后缀。线段树维护这个长高的操作，然后二分出吃掉的后缀，再支持推平操作即可。

-----

动态图

离线动态图连通性。

cdq分治。

-----

二分图

懂的都懂!

线段树分治。

-----

直径

树，每次给两个区间，查各选一个点距离的最大值。$$n,q\leq 10^5$$。

直接合并两个集合的直径。使用线段树，$$O(n+m\log n)$$。

用st表，然后建立虚树做四毛子，$$O(n+m)$$。

但是你发现并不能四毛子!因为编号信息量太大。

-----

Painting Edges

线段树分治!

先假设所有操作都被执行了。

不挂操作，而是每次遇到一个操作的左端点，看它会不会被执行，如果不会被执行就把之前的颜色拿过来代替它的颜色。

-----

Segment

懂的都懂!

李超树。

兔讲了一个基于二进制分组的好玩的做法。

这里扯一句无关的 : 二进制分组是分治的不完全执行。

EI的集训队论文，除了烤兔兔还有一个东西，说的是这个问题之类的问题中函数$$\min/\max$$的段数。这里是线段，段数是$$2n\alpha(n)+O(n)$$。

用神秘做法给每组求一个$$\max$$，这个函数段数是$$O(n\alpha(n))$$，合并的时候直接归并或者重构，总复杂度就是$$O(n\log n\alpha(n)+m\log^2 n)$$。据说可以用分散层叠优化掉查询的一个$$\log$$，反正我不会。

-----

楼房重建

我之前写了啥来着......

-----

Election

A和B竞选总统。有一排选民，每个人支持A或B，或者中立。

你要把选民分成若干长度在$$[l,r]$$之间区间的并，每个区间会有一票，这一票将投给区间中支持人数更多的候选人。如果两方支持人数一样多那就弃票。

现在你可以随便划分选民，最大化A的得票减去B的得票。$$n\leq 10^6$$。

把A看成$$+1$$，B看成$$-1$$，中立看成$$0$$。设$$t(x)=[x>0]-[x<0]$$表示一个区间的权值。

$$n^2$$ dp很简单，设$$dp(i)$$表示懂的都懂，有

$$
dp(i)=\min_{j=i-r}^{i-l}dp(j)+t(pre_i-pre_j)
$$

(上下界不重要)发现这个后面的东西只和$$pre_i$$与$$pre_j$$的大小有关。这启示我们把$$pre$$扔进状态。

对每个$$pre$$开一个vector，然后这个转移可以用单调队列优化。需要支持在某个单调队列里面插入、删除，查询所有单调队列队首的最大值。

用线段树维护所有队首，做完了。复杂度$$O(n\log n)$$。

因为是$$\pm$$，可以再用一个单调队列来维护队首们，做到$$O(n)$$。类似某个POI单调队列题。

-----

文明城市

树，点权，支持修改点权，查询点权和最大的连通块的点权和。$$n,q\leq 10^5$$。

树上ddp。

-----

线段树

有一个序列和一个长$$m$$的操作序列，每个操作是把一个区间推平成这个区间的最大值。

支持对序列的单点修改，以及对执行完一个区间的操作得到的序列做单点查询。$$n,m,q\leq 10^5$$。

考虑倒过来。倒着做，你会发现这个操作相当于合并连续段。

-----

树上的路径

给一棵树，正边权，求$$\mathrm{dis}(u,v)$$从小到大排序之后前$$m$$个值。$$n\leq 5\times 10^4,m\leq 3\times 10^5$$。

二分答案!然后你发现这是仨$$\log$$，T飞了。不过其实只需要先排好序，此后每次统计都是一个$$\log$$的，复杂度就是$$O(n\log n\log m)$$。



超级钢琴

-----

等差数列

单点修改，查询区间重排能不能变成公差为$$k$$的等差数列。强制在线。

经典题。

兔队给了一个更棒的做法，说的是能构成等差数列，等价于满足以下三个条件 : 

 - 最小值减最大值等于$$k(r-l)$$

 - 数不重复

 - 差分数组的$$\gcd$$是$$k$$

看起来很容易证明。线段树维护最大值、最小值以及差分的$$\gcd$$，主席树二维数点来搞不重复。

注意维护$$\gcd$$的线段树是一个$$\log$$的!复杂度$$O((n+q)(\log n+\log v))$$。

-----

Good Subsegments

给一个排列，每次查一个区间，问有多少子区间构成值域连续段。$$n,q\leq 1.2\times 10^5$$。

简单做法 : 回滚莫队，套一个CF526F的线段树。$$O(n\sqrt{n}\log n)$$。

普通做法 : 再次考虑526F的线段树。

每次右端点右移，影响一个时间后缀。所以每个左端点的查询相当于一个历史最小值和个数的查询。使用吉老师线段树即可。

神仙做法 : 析合树。

-----

Puzzled Elena

有根树，点权，对于每个点，求出子树里有多少点点权和它互质。$$n,a_i\leq 10^5$$。

先莫反!变成对于因数们做一些事情。

子树可以变成区间，然后拆成前缀和相减，然后扫描线扫过去。用一个桶维护，每次插入一个数就把因数们的什么东西扔进桶，查询就查所有因数，复杂度$$O(nd(n))$$。

-----

Odwiedziny

树，点权，每次查询从$$u$$出发跳到$$v$$，每一步跳$$k$$条边，求经过的点权之和。$$n,q\leq 10^5$$。

根号分治。对于超过根号的直接跳，少于根号的预处理$$u$$跳到$$1$$和$$1$$跳到$$u$$的答案，然后拆$$\mathrm{lca}$$即可。$$O((n+q)\sqrt{n})$$。

-----

Bear and Chemistry

无向图，每次查询加入一些边之后，一个点集是否边双连通。询问互不影响。$$n,m,q\leq 3\times 10^5$$，加入的总边数、点数均不超过$$3\times 10^5$$。

边双树。建立虚树然后连上新的边，再求一遍边双即可。奇妙?

-----

Duff is Mad

类似于547E，我们建立ACAM。

然后问题变成，对区间每个串的终止结点子树$$+1$$，求查询串所有点的和。

先对询问进行差分。

根号分治。认为各种东西都同阶。

对于长串，预处理这个前缀和。串个数是$$O(\sqrt{n})$$，每次复杂度是$$O(n)$$，乘起来是$$O(n\sqrt{n})$$。

对于短串，先离线下来。枚举前缀进行子树$$+1$$操作，扫到查询就爆力查。

注意到查询个数是$$O(n\sqrt{n})$$，但是子树$$+1$$只有$$O(n)$$次，可以用根号平衡干掉BiT的$$\log$$。总复杂度$$O(n\sqrt{n})$$。

-----

A Text Problem

有一个串$$t$$，每次查询一个$$s$$，求$$s$$在$$t$$中允许一个位置不同的匹配次数。$$\sum\vert s\vert,\vert t\vert\leq 10^5$$可以强制在线。

考虑建立$$t$$的前缀树和后缀树，然后枚举$$s$$那个不同的位置，分别求出此时$$s$$的前缀/后缀对应的$$t$$的前缀/后缀树上的结点。然后相当于求同时在两个子树中的所有$$pos$$个数，发现子树是区间，于是变成二维数点，主席树即可支持在线。

-----

Matches Are Not a Child’s Play

3 4 0 0

树，点权，定义它的删除序列为 : 每次删除权值最小的叶子，把这些叶子的编号按删除顺序排列。

支持修改一个点的点权为比当前最大值更大的值，或者查询一个点在删除序列中的位置。

考虑每次操作之后，相当于把操作点和原来最大值的链全都移到删除序列的末尾。

考虑LCT维护连续段，然后同时用平衡树维护序列。做完了。

具体怎么做完了?我也不知道（