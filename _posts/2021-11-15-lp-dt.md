---
layout: post
title: 线性规划对偶
subtitle: 离谱
tags: 数学
---

关于 线性规划对偶定理 的一些问题。

[对偶是什么，你真的知道吗?(wikipedia)](https://zh.wikipedia.org/wiki/%E5%AF%B9%E5%81%B6_(%E6%95%B0%E5%AD%A6))

## 经典的引入

Alice开了一个拖拉机厂，她进购了一批铁，轮胎和发动机，这些东西可以用来生产拖拉机，挖掘机和三蹦子，每个都需要一定量的原料。显然，Alice希望自己的利润尽量大。

Bob有一个魔法工厂，他用铁，轮胎和发动机批量生产黄金，于是Bob想买走Alice的这批原料。两个人都是绝顶聪明的，于是Bob知道如果想买下来，自己出的钱必须足够多，不少于Alice生产这些东西所能得到的收益。更进一步，Bob买足够制造一个拖拉机的原料，那么他出的价钱必须不低于一个拖拉机的价钱，挖掘机和三蹦子也是一样的。

于是两个人的目标看起来好像是相反的 : Alice希望提高价格，而Bob希望降低价格。容易感觉到最后两个人将会达成一致，也就是Alice的最大利润将等于Bob的最小出价。感性理解一下这就是线性规划对偶定理。

下面我们需要形式化地表述这个问题。假设Alice这边生产一个拖拉机需要$$a_{1,1},a_{1,2},a_{1,3}$$个单位的铁，轮胎和发动机，挖掘机，三蹦子是$$a_{2,...},a_{3,...}$$，它们构成了矩阵$$A$$。设三种原料分别有$$b_1,b_2,b_3$$个，它们构成了向量$$b$$。设三种产品分别生产$$x_1,x_2,x_3$$个，售价分别是$$c_1,c_2,c_3$$，它们构成了向量$$x,c$$。那么Alice就希望求

$$
\max_x c^T x\\
Ax\leq b\\
x\geq 0
$$

设Bob对三种原料的开价分别是$$y_1,y_2,y_3$$，那么Bob希望求

$$
\min_x b^T y\\
A^T y\geq c\\
y\geq 0
$$

。线性规划对偶定理的内容，就是这两个线性规划的最优值相等。

要证明这个?我不会，如果你想知道可以自己查一查（

如果你想要记住这个式子，这是很简单的。但是如果你想直接用出来，就比较困难，一个方法是你可以认为线性规划对偶就是把变量变成限制，把限制变成变量，符号取反，交换$$b,c$$。

-----

一个笑话

可能会帮助你理解对偶线性规划?

![img](/img/2021-11-15-lp-dt/img.png)

-----

试看看!例题1.6

二分图最大权匹配的对偶。

线性规划是

$$
\max \sum_{u,v}w_{u,v}f_{u,v}\\
\sum_v f_{u,v}\leq 1\text{ for }u\\
\sum_u f_{u,v}\leq 1\text{ for }v
$$

当然$$f$$需要是正的。设第一个限制对应$$y_u$$，第二个对应$$z_v$$，对偶这个我们得到

$$
\min \sum_u y_u+\sum_v z_v
y_u+z_v\geq w_{u,v}\\
$$

呃这是怎么对偶出来的......考虑到每条边只会被端点算两次，系数都是$$1$$，然后你就可以大致理解这个式子。

这个对偶问题看起来像是......km。$$y,z$$就是km中的顶标。

-----

试看看!例题1.7

费用流的对偶。这个很有用。

这里我们对偶最大费用循环流，它可以使用最大费用最大流解决(充满正权边再建立虚源汇调整)，并且很多题目可以转化成这个。

首先考虑循环流需要流量平衡，也就是出入相等，这就需要我们考虑等式的对偶。等式会被拆成两个不等式，看起来是$$a\leq b,-a\leq -b$$。这两个约束会对偶成两个变量$$y,y^\prime$$，它们的系数分别是$$b,-b$$，于是在对偶线性规划中就有一项$$b(y-y^\prime)$$。原来的变量会对偶成约束，这相当于是有一个变量$$y^{\prime\prime}$$可以取任意实数而系数是$$b$$。

## 它有什么用

最直观的用法是，不管原问题多么复杂，对偶问题都可能变得非常简单。

比如说，如果你对解决原问题毫无头绪，考虑它的对偶问题可能会有这些好处 : 

 - 如果原问题需要写simplex的init，对偶问题的基本解可能可行

 - 如果原问题有大量的变量和很少的限制，对偶问题将具有很少的变量和大量的限制，反过来也是成立的

 - 对偶问题可能是经典的(不过一般经典问题的对偶问题也是经典的)或者一眼的(比如它有简单的意义，或者它直接是个费用流之类的)

，等等。接下来我们将通过两道例题带你领略一下。

-----

NOI2008 志愿者招募

有$$m$$家公司的拖拉机可以租用，每家的拖拉机有一个费用$$c_i$$，租了之后可以在一个时间区间$$s_i,t_i$$使用(每一天都可以使用)，同一家公司的拖拉机价格相同，可以同时租用多台。接下来$$n$$天每天有一个拖拉机需求量$$a_i$$，问至少需要多少钱，才能满足每天都需求。$$n\leq 10^3,m\leq 10^4$$。

猜测这是网络流题，但是网络流不会建图，怎么办呢?可以simplex硬冲。因为既然可以用网络流来做，线性规划的最优解一定是整数解。

这题可以很容易地写出一个线性规划，它看起来像是这个样子 : 

$$
\min cx\\
\sum_{s_j\leq i\leq t_j}x_j\geq a_i(i=1,...,n)
$$

然后你发现这个不是很好冲，因为它的基本解不可行。如果你不知道为什么不好冲?你可以去写一发uoj simplex板子，然后体验一下wa extra test。

考虑把它对偶一下，所有$$c$$都是正的，每一个约束都变成了$$\leq c_i$$，于是基本解可行了。直接转即可。

-----

CF605C Freelancer's Dreams

你在玩一个挂机游戏，有若干工作可以做，但是你同时只能做一项。你有两种资源，每一项每秒会给你提供$$a_i$$个第一种资源和$$b_i$$个第二种资源，你可以做任意实数秒并得到实数的资源。求最短的时间让你的两种资源分别超过$$x,y$$。$$n\leq 10^5$$。

容易写出线性规划。你发现它有$$n$$个变量和两个限制，这我们就不会了，于是对偶变成两个变量和$$n$$个限制。然后你发现这就是一个半平面交?做完了。

-----

CF1307G Cow and Exercise

给一个有向图，边权，每次给一个$$x$$，你可以把每一个边权加上一个实数，要求总共不能加超过$$x$$，最大化$$1$$到$$n$$的最短路。$$n\leq 50,q\leq 10^5$$。

呃看起来很困难。

这个题有很多推法，我们随便找一个。

注意到$$n\leq 50$$，可以想到费用流，于是我们开始想费用流，发现完全想不动怎么搞定这个最短路。(实际上最短路本身有一个线性规划，只不过我忘了)

于是考虑钦定一个最短路，然后要求它就是最短路，也就是是否满足三角形不等式。然后就可以写出一个线性规划，约束是所有的三角形不等式，边权只能增加，增加总量不超过$$x$$；目标是最大化$$dis(n)$$。

$$
\max d_n\\
d_u+w_{u,v}+a_{u,v}\geq d_v\\
\sum a_{u,v}\leq x
$$

其中$$w$$是邻接矩阵，$$a$$是增加的边权。

然后你发现这个不对，因为$$d_1$$可能不是$$0$$，但是加这么一个限制又不好看，所以我们把它改成

$$
\max d_n-d_1\\
d_u+w_{u,v}+a_{u,v}\geq d_v\\
\sum a_{u,v}\leq x
$$

这就对了。然后呢?

simplex/cy

然而这是cf，所以我们就飞了。

既然没什么性质，我们就对偶这个。

$$

$$

