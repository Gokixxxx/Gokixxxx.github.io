---
layout: post
title: 扫描线方向
subtitle: 垂直屏幕向外扫描线
tags: 杂项
---

呃这个可能会用作讲稿?

大概就是收录一些奇怪的扫描线方向。

扫描线方向说的是，在解决一些有多个变量的问题的时候，我们先枚举哪一个，再枚举哪一个，每一层的枚举是从小到大还是从大到小这样的。一般将最外面那一个称为扫描线方向。

有些题的扫描线方向是简单的，有些是自然的，有些则违背直觉，第三种问题往往是非常有趣的。

-----

![img](/img/2021-11-21-sweepline-direction/saying.png)

摘自lxl的扫描线ppt。

-----

常见的扫描线方向

枚举扫描线方向，指的是尝试所有可能的扫描线方向。

序列问题可以在序列上扫描线。树上问题可以在dfs序上扫描线，DAG上问题可以在拓扑序上扫描线。

在值域上扫描线。这个常常不直觉，需要有枚举扫描线方向的意识。

在时间上扫描线。这个很自然，但是有时候会显得奇怪。

序列上的区间问题，可以选择扫左端点还是右端点，也可以选择从左往右还是从右往左扫。

高维空间中的问题，可以选择按照哪一维扫描线。实际上所有线性结构的问题都可以归结到高维空间中。

-----

AGC016F Games on DAG

给一个DAG，有两个棋子分别在$$1,2$$号点，Alice和Bob轮流沿有向边移动棋子，不能动就输了，求有多少生成子图使得Alice必胜。$$n\leq 15$$。

考虑这相当于$$1,2$$的SG值不同。转而计算相同的方案数，但是你发现SG值这东西不是很好做。

考虑在值域上扫描线，设$$dp(i,S)$$表示$$S$$中的点们SG值至少是$$i$$，外面的点SG值不超过$$i-1$$的生成子图个数，也就是说$$S$$中的每个点都连到了SG值是$$i-1,i-2,...,0$$的点。此时转移就是枚举SG值就是$$i$$的点集$$T$$，$$S-T$$中的点必须连到$$T$$中的至少一个点，于是复杂度就是枚举子集的复杂度$$O(3^n)$$。

-----

洛谷省选计划2021 R4T3

给一个棋盘，有一些格子之间有隔板，你需要放一些骨牌，骨牌不能跨过隔板，求方案数。骨牌的形状有

![img](/img/2021-11-21-sweepline-direction/lgsxr4t3.png)

$$n,m\leq 20$$，膜$$10^9+7$$。

考虑直接dp，做完了。吗?直接轮廓线的话，我们设$$dp(i,j,S)$$表示走到$$i,j$$这个位置，轮廓线状态是$$S$$，转移枚举选哪一个，复杂度是$$O(2^nn^2)$$，不是很能过$$20$$。

考虑一个牛逼做法，我们斜着扫描线，也就是从左上往右下依次处理每条斜线，对于每条斜线我们再从左往右处理，状态中记录这么一段 : 

![img](/img/2021-11-21-sweepline-direction/lgsxr4t3_2.png)

呃粉色是已经决策的区域，黄色和绿色需要记入状态，蓝色还没处理，绿色是现在要处理的。

转移的时候，我们钦定放后两种块的时候一定是把中心的那个块放在当前的格子上，这样转移居然还是$$O(1)$$的。状态数只需要考虑前一半，它是

$$
\sum_{i=1}^n 2^ii=O(2^nn)
$$

，于是就做完了。

呃这个式子是为什么?你发现只有最后一项在起作用。

-----

Gym100543L Outer space invaders

有一排敌人开着飞船，每个会在$$a_i$$时刻出现，在$$b_i$$时刻之后立刻对你开炮，而你不能抵抗这一炮，所以你必须在$$b_i$$前消灭第$$i$$个敌人。

每个敌人有一个距离$$d_i$$，你的武器是一根棍子，它可以伸缩，如果你使用长$$l$$的棍子，会消耗$$l$$单位的能量，并干掉所有距离你不超过$$l$$的敌人。求消灭所有敌人的最小消耗。$$n\leq 300,a_i,b_i,d_i\leq 10^4$$。

考虑了几个扫描线方向，你发现按照距离扫描线是可行的。具体地，我们考虑最远的敌人，它必须被开一炮。考虑我们这一炮开出去，所有出现时间和开炮时间跨过你开炮的时间的敌人都没了，于是离散化后设$$dp(l,r)$$表示干掉两个时间都在$$[l,r]$$内的敌人的最小消耗，转移枚举什么时候干掉最远的敌人即可。复杂度$$O(n^3)$$。

-----

loj2728 joi 2015 final E. 城墙

给一个01矩阵，求其中有多少个正方形边框只包含0。$$n,m\leq 4000$$，10s。

直接做的复杂度是$$O(n^3)$$，这会飞掉。你说10s?sorry，肯定跑不过。

不过看起来复杂度是$$O(n^2\log n)$$或者$$O(n^{2.5})$$之类的东西。

考虑几种直接做的做法。本质上所有的爆力都是枚举了三条边，但是这里我们显然只能枚举两条，于是需要考虑枚举哪两条。

我们先枚举左边和右边，然后考虑这个正方形上下的位置。首先可以把左右边上有障碍的情况都删掉，这个怎么想都不超过4e8，随便跑了。问题变成两条横线上都不能有障碍的方案数。

讲道理，一条都不好做。诶一条好像是好做的，我们只需要从每个点出发强行往右延申就好了。

那么现在设一个格子延申的长度是$$f(i,j)$$，当前枚举的边长是$$l$$，我们就是要求左边$$x$$上有多少对$$i,j$$满足$$f(x,i)\geq l,f(x,j)\geq l$$之类的东西，可能还有一些$$\pm 1$$不过那不重要。

这玩意看起来像是法法塔吗?想了想你发现不行。fuck!换一个。

注意到，如果先枚举左边和下边，也就是先枚举左下角，那么剩下的两条边会形成了一个拐角的形状，而我们可以让它只剩下右上角一个变量。

我们让每个点强行往左、往下延申，看最多延伸到哪里，这个记为$$f$$。然后枚举左下角的时候，计算往右、往上最多延伸到哪里。那么可以画个图解释一下 : 

![img](/img/2021-12-18-loj-problems/2728.png)

然后你发现我们要求右上角那个点的$$f$$要比它到左下角的距离更大，这个大概是什么$$f(x+k,y+k)\geq k$$之类的，移一项就变成$$f(x+k,y+k)-\frac{1}{2}(x+y+2k)\geq-\frac{1}{2}(x+y)$$之类的，然后就变成在一条斜线的区间上查询比某个数大的数的个数，这完全是二维数点，扫描线BiT即可。

这个题告诉我们两个道理，一个是只要你能枚举所有的扫描线方向，肯定可以做出来；另一个是能快速减少变量数量的扫描线方向看起来会更优。