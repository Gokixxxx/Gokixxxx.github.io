---
layout: post
title: 三元环计数相关问题
subtitle: 有趣
tags: 数据结构 图论
---

好水?

无向图三元环计数说的是，我们先给边定向，从度数小的连向度数大的，然后枚举两层出边打标记，再枚举一条出边统计答案。

这个可以推广到四元环，也就是枚举两层出边打标记，再枚举两层出边统计答案。

这样做，每个点的出度不超过根号，于是复杂度就是正确的(实际上反过来连也是正确的，因为入度不超过根号)。同时我们也证明了三元环和四元环的个数都是$$O(m\sqrt{m})$$级别。

证明是，考虑到一个点连到的点度数都比它大，于是如果它的出度是$$d$$，那么它连向的点的度数都至少是$$d$$，于是这些点的度数和至少是$$d^2$$。这些点之间最多连$$\frac{d(d-1)}{2}$$条边，每条在度数中会贡献两次，所以它们连的边至少有$$d^2-\frac{d(d-1)}{2}$$条，于是$$d$$不能超过大约$$\sqrt{2m}$$，否则就会飞。

这个比根号分治常数要小，并且在一些问题上有更好的性质。

-----

lxl口中的经典题

给一张图，支持修改一个点权，查询一个点邻点的点权和。

来自vuq的题

给一张图，一条边的边权是端点点权的和，支持修改一个点权，求所有边的边权max。

做法是一样的，套这个trick然后每个点维护入边的贡献，修改的时候爆力改出边，查询的时候爆力加入出边。