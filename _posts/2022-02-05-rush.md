---
layout: post
title: 省选前的集训内容
subtitle: /kk
tags: 杂项
---

所有的都在这里了。不放来源了（

## 数论

2022-02-05

$$O(v)$$预处理，$$O(1)$$ gcd

没看懂，自己胡了一个。考虑要求$$\gcd(x,y)$$，我们可以把$$x$$分解成若干个$$\sqrt{v}$$级别的数的乘积，然后预处理$$\sqrt{v}$$以内的$$\gcd$$，把$$y$$对第一个取膜并查表，然后把$$y$$除掉第一轮的答案，再对第二个取膜并查表......如果分解成$$O(1)$$个数，那么复杂度就是$$O(1)$$。

结论是每个数都可以分解成三个$$\leq\sert{n}$$的数的乘积，除非$$n$$有一个很大的素因子。构造方法是，线筛筛出每个数$$i$$的最小素因子$$p$$，然后把$$p$$塞到$$\frac{i}{p}$$的分解里面，尽量塞到靠前的位置。

看起来常数吓人了（

-----

Pollard-rho

先MR判掉素数。

考虑$$n$$的最小素因子$$p$$，有$$p\leq\sqrt{n}$$。

考虑一个随机函数$$f(x)$$，我们找一个$$x$$，假装我们可以计算$$x,f(x),f(f(x)),...$$膜$$p$$的值(但是我们还是不知道$$p$$)，根据生日悖论的结论，期望$$\sqrt{p}$$次就能找到两个相同的，设为$$x,y$$，此后会进入一个循环，于是这个过程看起来像是一个rho。

相同的有啥用?考虑膜$$p$$会在期望$$\Theta(\sqrt{p})=O(\sqrt[4]{n})$$次后循环，而膜$$n$$是$$\Theta(\sqrt{n})$$次，这两个rho很可能不一样，于是$$x\equiv y\pmod{p}$$，但是$$x\not\equiv y\pmod{n}$$，于是$$x-y$$是$$p$$的倍数而不是$$n$$的倍数，于是使用$$\gcd(x-y,n)$$就可以求出$$p$$。

我们并不能计算$$x,f(x),f(f(x)),...$$膜$$p$$的值，但是我们可以每一步都当成进入了循环。期望$$O(\sqrt[4]{n})$$次就循环了，于是我们每次随机两个，期望$$O(\sqrt[4]{n})$$就能找到值相同的，虽然我们并不知道它们值是否相同，但是可以每随一次都求一个$$\gcd(x-y,n)$$直到它$$>1$$，或者我们觉得这个$$f$$没希望了而换一个。然后因为函数是随机的，看起来我们直接迭代就是随机的，于是可以用一个类似于floyd判环的做法，让一个变量每轮迭代一步，另一个每轮迭代两步这样的。

这个找一个素因子的复杂度看起来是$$O(\sqrt[4]{n}\log n)$$，分解的复杂度还需要多一个$$\log$$。

考虑我们怎么砍$$\gcd$$的$$\log$$，你发现我们每次是有一堆$$x-y$$然后要求$$\gcd(x-y,n)>1$$的一个，那么我们可以每$$\log$$个分一块，每一块都乘起来和$$n$$求$$\gcd$$，如果$$>1$$再爆力遍历这一块。

实现可以取$$f(x)=x^2+c$$，其中$$c$$是随机整数。

-----

exLucas

这年头还会出这种东西吗（

咕咕咕。

-----

exBsgs

小驼峰（~~。BSgS : 大驼峰小驼峰~~

求解$$a^x\bmod{n}=b$$，其中$$a,n$$不一定互素。

考虑没法直接bsgs是因为$$a,n$$不互素，此时我们把$$x$$拆成$$x_1K-x_2$$的话，因为没有逆所以可能一个$$x_1$$对应了多个$$x_2$$，但是这些$$x_2$$并不都可行。

于是我们考虑除掉$$\gcd(a^x,n)$$让它俩互素。但是我们不知道$$a^x$$啊?

考虑我们先除掉$$\gcd(a,n)$$，然后有可能有$$a\not\perp\frac{n}{\gcd(a,n)}$$，那我们就继续除掉新的$$\gcd$$，显然除$$k=O(\log n)$$次就除没了，然后我们再判一下$$k$$以内有没有解。

现在方程看起来是$$\frac{a^x}{d}\bmod{\frac{n}{d}}=\frac{b}{d}$$，如果$$d\not\mid b$$就直接无解了，否则我们把$$\frac{a^k}{d}$$扔到右边(除光了所以必然有逆元)，然后用一般的bsgs。

-----

扩欧定理（

众所周知，~~扩欧可以用来求解一元一次同余方程~~ 费马小定理可以用来在膜素数的时候给指数取膜。exEuler定理说明，膜合数也可以给指数取膜，方法是如果我们要算$$a^x\bmod{n}$$，那么

 - 如果$$a\perp n$$，那么$$a^x\equiv a^{x\bmod{\varphi(n)}}$$。

 - 否则，如果$$x\geq\varphi(n)$$，那么$$a^x\equiv a^{x\bmod{\varphi(n)}+\varphi(n)}$$。

 - 否则exEuler定理并不能做什么。

这个可以保证指数在$$[0,2\varphi(n)]$$之内。经典题是 相逢是问候 和 Power Tower(好像是这个名字?)。

-----

反的莫反

反的莫反也是成立的，也就是说$$f(d)=\sum\limits_{d\mid n}g(n)\Leftrightarrow g(d)=\sum\limits_{d\mid n}\mu(\frac{n}{d})f(n)$$。当然这只对有限的函数有效。

如果用dgf解释这个......好像不行。

看起来反的二项式反演也是成立的，并且比正的二项式反演更常用，大量出现在 钦点一些 的容斥中。反的子集反演也是成立的。

-----

寿司晚宴

考虑存在一对不互素的，就是素因子有交。转而算无交的方案数。

然后就可以得到$$2^{\pi(n)}$$的爆力，就是直接枚举每个素数是A选了，B选了，还是都没选。然后如果一个数包含的素数有的被A选了有的被B选了，那就不能选它，否则一方或者两方可以选它也可以不选它。

考虑为什么值域只有可怜的500。注意到500以内有很多个素数，但是$$\sqrt{500}<23$$以下只有$$2,3,5,7,11,13,17,19$$八个素数，于是我们至少可以爆力枚举这些素数的情况。

每个数最多有一个$$\geq 23$$的素因子，于是每个数可以表示成至多一个大素数乘上若干个小素数。现在小素数已经枚举完了，我们在大素数处处理这个数选不选即可。复杂度是$$O(3^{\frac{n}{\ln n}}n)$$。

-----

$$\mu^2$$前缀和

这玩意是可以powerful number的/jy，因为$$\mu^2(p)=1$$，于是找一个$$\mathrm{id}_1$$就行了。这个好像早在去年省选计划就出过，但是我已经完全忘了。

-----

jloi2014 聪明的燕姿

搜。

听起来好离谱?

-----

haoi2018 奇怪的背包

判断是否可行就是，所有数都取$$\gcd$$，看是否整除$$w$$。

然后要计数的话，就是数多少子集加上$$p$$的$$\gcd$$整除$$w$$。这个咋做?

考虑我们记录一下$$\gcd$$，1e9以内最大因数个数只有1e3级别，因为总是要和$$p$$取$$\gcd$$，所以这个$$\gcd$$总是$$p$$的因数，于是我们就直接dp就行了，转移考虑一下感觉可以做到$$O(1)$$，于是就是$$O(nd(v))$$了。

然后这个还是不够好，你发现因为要跟$$p$$取$$\gcd$$，所以实际上只有$$d(v)$$种不同的数，于是就是$$O(d^2(v))$$了。

-----

snoi2017 遗失的答案

把gcd和lcm都分解掉，然后我们得到了对每个素因子的次数上下界限制，这样的素因子最多也只有$$8$$个。呃发现可以把每个数都除掉gcd，然后把gcd扔了，所以只剩上界了。

然后我们选的集合，对每个素因子，都需要有一个数达到上界，有一个数达到下界，这个就容斥一下，每个素因子的上界和下界各有两种情况，一共是$$4^{\omega(n)}=65536$$这么多的状态，然后看起来强制选$$x$$的效果就是不去枚举一些枝了，直接记忆化一下答案就$$O(9^{\omega(n)})$$了，然后就过了。

-----

codechef invxor

定义一个序列的权值是所有子序列xor的和，定义$$f(n,b)$$是长$$n$$的权值为$$b$$的非负整数序列个数，给$$n,m,x$$，求最小的$$b$$使得$$f(n,b)\equiv x\pmod{m}$$，可能无解。$$100$$组数据，$$n\leq 10^{10000},m\leq 10^9$$。

先考虑$$f(n,b)$$是啥，考虑每一位的出现次数，你发现如果这一位有1，那么贡献是$$2^{n-1}$$倍的位权，否则是$$0$$，于是权值就是整个序列的or乘上$$2^{n-1}$$。

然后$$f(n,b)$$也就是有多少个序列的or是$$\frac{b}{2^{n-1}}$$，这个可以容斥一下，钦点一些应该是1的位出现了0。如果or有$$c$$个1，我们钦点有$$i$$位被搞成$$0$$了，于是序列中所有数都在剩下的$$2^{c-i}$$个数中随意选，于是得到

$$
\sum\limits_{i=0}^c(-1)^i\binom{c}{i}2^{(c-i)n}=(2^n-1)^c
$$

。然后问题就是求$$(2^n-1)^c\equiv x\pmod{m}$$的最小解了，exBsgs即可。

-----

一个原根，所有原根

$$g$$是膜$$m$$的原根，当且仅当对于$$\varphi(m)$$的每个素因数$$p$$，都有$$g^{\frac{\varphi(m)}{p}}\ot\equiv 1\pmod{m}$$。同时最小原根是$$O(n^\frac{1}{4})$$级别的，所以从小到大枚举就可以求得最小原根。

如果我们已经得到了一个原根$$g$$，$$g^k$$也是原根，当且仅当$$k\perp\varphi(m)$$，可以想象在一个环上走。

-----

wc2021 斐波那契

给$$a,b,m$$，定义$$g_0=a,g_1=b,g_n=g_{n-1}+g_{n-2}$$，求最小的$$p$$使得$$f_p\bmod{m}=0$$。$$10^5$$次询问，每次给出$$a,b$$而$$m$$不变，$$m\leq 10^5$$。

有很多做法，这里讨论两种，但是有一种咕了。

第一个，先考虑膜素数怎么做。

考虑$$g_n=bf_n+af_{n-1}\equiv 0$$，这样看起来我们可以搞一搞$$f_{n-1},f_{n-2}$$来处理多组询问。经典结论是循环节长度$$\leq 6m$$，于是我们搜出所有循环，然后对每个循环把相邻的$$\frac{f_{n-1}}{f_n}$$扔进map，查询查$$-\frac{b}{a}$$。

如果不膜素数，就没有逆了，我们先给$$a,b,m$$都除掉$$\gcd(a,b,m)$$，只需要考虑$$\gcd(a,b,m)=1$$的情况。

注意到一个牛逼性质$$f_n\perp f_{n-1}$$，于是有一个离奇结论是$$\gcd(f_n,m)=\gcd(a,m),\gcd(f_{n-1},m)=\gcd(b,m)$$，这里不作证明，可以看一看 https://www.luogu.com.cn/blog/CJL/solution-p7325。

把这俩值设为$$d_1,d_2$$，那么我们三边同除$$d_1d_2$$得到$$\frac{b}{d_2}\cdot\frac{f_n}{d_1}+\frac{a}{d_1}\cdot\frac{f_{n-1}}{d_2}\equiv 0\pmod{\frac{m}{d_1d_2}}$$，然后大家就全都互素了，于是求逆元就行了。不过需要对$$m$$的每个因数都预处理一遍，复杂度升高为$$O(\sigma(m)\log m)$$。

第二个，考虑crt，膜$$m$$为$$0$$等价于膜$$m$$的每个素因数幂都为$$0$$，而膜每个素数幂看起来都是一个rho形，我们可以用exgcd合并等差数列。现在问题是怎么做膜$$p^k$$，我不是很会。

我总感觉我打的比赛都没有神仙题，实际上只是因为我做简单题和套路题的速度不够快，以至于我没有时间感受神仙题的神仙（

-----

蒜头的奖杯

怎么说都有点离谱（

## 状压dp，集合幂

2022-02-06

-----

cf1584f

考虑要求lcs，我们需要记上一个字符，然后就设$$dp(c,S)$$表示匹配到字符$$c$$，这个$$c$$ 在各串中是第几个$$c$$ 的状态是$$S$$，然后就做完了。

-----

cf1530f

直接dp，设$$dp(i,S,0/1,0/1)$$表示考虑前$$i$$列，各行状态是$$S$$，两对角线状态是$$0/1,0/1$$的概率，转移枚举这一列的状态，如果一列全是$$1$$那就直接计入答案。然后就死了，因为这是$$4^n$$。

考虑转移是个啥，你发现它看起来是，我们枚举这一行的状态$$T$$，然后用$$\mathrm{P}(T)dp(i,S,0/1,0/1)$$转移到$$S\operatorname{and}T$$。这个看起来是and卷积，于是法嘛塔一下就是$$O(2^nn^2)$$了。

如何优化?换个想法。容斥，枚举对角线和每一行，然后直接算每一列的容斥，每一列就是独立的了，看起来可以直接做。复杂度$$O(2^nn)$$。

-----

cf1523f

直接dp，设$$dp(i,S)$$表示处理了前$$i$$个任务，并且完成了第$$i$$个任务，已经激活了$$S$$中的传送门的答案，转移枚举接下来要激活哪些传送门，以及下一个要做的任务，用另一个状压dp预处理旅行商，复杂度猜测是$$O(3^nm^2)$$。

如何优化?法嘛塔，看起来就是$$O(2^nnm^2)$$了。然后还是过不了，考虑砍一个$$n$$或者砍一个$$m$$。

维度交换。设$$f(i,S)$$表示完成了$$i$$个任务，激活了$$S$$中的传送门，现在在一个传送门的最小时间，这个看起来是强行缩减状态数了。转移枚举接下来是激活一个传送门还是做一个任务，于是设$$g(i,S)$$表示刚完成第$$i$$个任务，激活了$$S$$中的传送门的最大答案。$$g$$的转移也是枚举接下来干什么，复杂度是$$O(2^nm^2)$$。

这个维度交换的作用是，把连续的时间扔到dp的值上去，这看起来是避免把时间变成离散事件的直接方法。不过两个dp数组用不同的维度还是很有趣的。

-----

cf1553h

看起来爆力足有$$4^k$$。

考虑对于一个$$x$$，不要排序啊，从高往低贪心，然后如果一位不同了，大小就确定了，接下来肯定是让小的尽可能大，大的尽可能小，所以我们可以建一个trie然后在上面贪心。

考虑$$x$$增加$$1$$的时候这个trie怎么变化，每一位变化，相当于把这个trie一层每个点的左右子树交换，于是我们每层打一个标记，然后总变化次数是$$2k$$，所以就做完了。复杂度是$$O(nk)$$。

但是这不是状压dp啊?

-----

cf1519f

任意箱子子集对应的钥匙，权值之和比箱子的权值之和大，这个东西让人很难不想起hall定理。建一个图，左边是宝箱，右边是钥匙，要保留一些边，让任意左部点子集的权值和不比邻接的右部点子集权值更大，也就是中间的边容量无穷，左部点有完美匹配。

这个东西看起来就很离谱。设$$dp(i,j,S)$$表示现在匹配了左部点$$i$$的$$j$$个流量，前面的匹配完了，后面的没有匹配，而右部点的情况是$$S$$的最小花费，这个是$$6\times 5\times 5^6$$，看起来就成功了。

-----

后面看起来是集合幂的杂题。

-----

agc043c

看起来很离奇。

首先我们肯定选$$(n,n,n)$$。

然后我们尝试选$$(n-1,n,n),(n,n-1,n),(n,n,n-1)$$中的一个。但是如果$$n-1$$和$$n$$在某个图上有边，对应的就没法选了。

然后我们尝试选$$(n-1,n-1,n),(n-1,n,n-1),(n,n-1,n-1),(n-2,n,n),(n,n-2,n),(n,n,n-2)$$中的一个，你发现如果$$n-1$$和$$n$$在某个图上有边，比如第一个图，这会ban掉两个点。

尝试总结一下，选了$$(n,n,n)$$之后，会在每一维ban掉几个点，然后我们继续选最大的就行了。看起来开三个堆即可，但是为什么会这么简单呢?

呃实际上确实不这么简单。我们可能会遇到几个一样大的，此时就需要在这里面跑一个最大独立集了，并且可能选的点的数量也非常多。

然后正解非常离谱。考虑我们把所有的点建一个dag，从权值小的指向大的，那么问题变成如果一个点连向的点都不选，那就选它，然后这个看起来很像是博弈论里面先/后手必胜的转移。

然后我们可以考虑把sg定理搬过来，一个点的sg值是连到的点的mex，然后因为这是三个维度拼起来，维度之间是独立的，所以sg值相当于这个点三张图上sg值的xor，爆力求出三张图每个点的sg值，然后法哇塔一下求xor起来得到$$0$$的方案数就好了。复杂度是$$O(m\log m)$$。

更好的方法是，sg值最大在$$O(\sqrt{m})$$级别，所以我们枚举两个统计另一个即可，复杂度是$$O(m)$$。

-----

