---
layout: post
title: 省选前的集训内容
subtitle: /kk
tags: 杂项
---

所有的都在这里了。不放来源了（

## 数论

2022-02-05

$$O(v)$$预处理，$$O(1)$$ gcd

没看懂，自己胡了一个。考虑要求$$\gcd(x,y)$$，我们可以把$$x$$分解成若干个$$\sqrt{v}$$级别的数的乘积，然后预处理$$\sqrt{v}$$以内的$$\gcd$$，把$$y$$对第一个取膜并查表，然后把$$y$$除掉第一轮的答案，再对第二个取膜并查表......如果分解成$$O(1)$$个数，那么复杂度就是$$O(1)$$。

结论是每个数都可以分解成三个$$\leq\sert{n}$$的数的乘积，除非$$n$$有一个很大的素因子。构造方法是，线筛筛出每个数$$i$$的最小素因子$$p$$，然后把$$p$$塞到$$\frac{i}{p}$$的分解里面，尽量塞到靠前的位置。

看起来常数吓人了（

-----

Pollard-rho

先MR判掉素数。

考虑$$n$$的最小素因子$$p$$，有$$p\leq\sqrt{n}$$。

考虑一个随机函数$$f(x)$$，我们找一个$$x$$，假装我们可以计算$$x,f(x),f(f(x)),...$$膜$$p$$的值(但是我们还是不知道$$p$$)，根据生日悖论的结论，期望$$\sqrt{p}$$次就能找到两个相同的，设为$$x,y$$，此后会进入一个循环，于是这个过程看起来像是一个rho。

相同的有啥用?考虑膜$$p$$会在期望$$\Theta(\sqrt{p})=O(\sqrt[4]{n})$$次后循环，而膜$$n$$是$$\Theta(\sqrt{n})$$次，这两个rho很可能不一样，于是$$x\equiv y\pmod{p}$$，但是$$x\not\equiv y\pmod{n}$$，于是$$x-y$$是$$p$$的倍数而不是$$n$$的倍数，于是使用$$\gcd(x-y,n)$$就可以求出$$p$$。

我们并不能计算$$x,f(x),f(f(x)),...$$膜$$p$$的值，但是我们可以每一步都当成进入了循环。期望$$O(\sqrt[4]{n})$$次就循环了，于是我们每次随机两个，期望$$O(\sqrt[4]{n})$$就能找到值相同的，虽然我们并不知道它们值是否相同，但是可以每随一次都求一个$$\gcd(x-y,n)$$直到它$$>1$$，或者我们觉得这个$$f$$没希望了而换一个。然后因为函数是随机的，看起来我们直接迭代就是随机的，于是可以用一个类似于floyd判环的做法，让一个变量每轮迭代一步，另一个每轮迭代两步这样的。

这个找一个素因子的复杂度看起来是$$O(\sqrt[4]{n}\log n)$$，分解的复杂度还需要多一个$$\log$$。

考虑我们怎么砍$$\gcd$$的$$\log$$，你发现我们每次是有一堆$$x-y$$然后要求$$\gcd(x-y,n)>1$$的一个，那么我们可以每$$\log$$个分一块，每一块都乘起来和$$n$$求$$\gcd$$，如果$$>1$$再爆力遍历这一块。

实现可以取$$f(x)=x^2+c$$，其中$$c$$是随机整数。

-----

exLucas

这年头还会出这种东西吗（

咕咕咕。

-----

exBsgs

小驼峰（~~。BSgS : 大驼峰小驼峰~~

求解$$a^x\bmod{n}=b$$，其中$$a,n$$不一定互素。

考虑没法直接bsgs是因为$$a,n$$不互素，此时我们把$$x$$拆成$$x_1K-x_2$$的话，因为没有逆所以可能一个$$x_1$$对应了多个$$x_2$$，但是这些$$x_2$$并不都可行。

于是我们考虑除掉$$\gcd(a^x,n)$$让它俩互素。但是我们不知道$$a^x$$啊?

考虑我们先除掉$$\gcd(a,n)$$，然后有可能有$$a\not\perp\frac{n}{\gcd(a,n)}$$，那我们就继续除掉新的$$\gcd$$，显然除$$k=O(\log n)$$次就除没了，然后我们再判一下$$k$$以内有没有解。

现在方程看起来是$$\frac{a^x}{d}\bmod{\frac{n}{d}}=\frac{b}{d}$$，如果$$d\not\mid b$$就直接无解了，否则我们把$$\frac{a^k}{d}$$扔到右边(除光了所以必然有逆元)，然后用一般的bsgs。

-----

扩欧定理（

众所周知，~~扩欧可以用来求解一元一次同余方程~~ 费马小定理可以用来在膜素数的时候给指数取膜。exEuler定理说明，膜合数也可以给指数取膜，方法是如果我们要算$$a^x\bmod{n}$$，那么

 - 如果$$a\perp n$$，那么$$a^x\equiv a^{x\bmod{\varphi(n)}}$$。

 - 否则，如果$$x\geq\varphi(n)$$，那么$$a^x\equiv a^{x\bmod{\varphi(n)}+\varphi(n)}$$。

 - 否则exEuler定理并不能做什么。

这个可以保证指数在$$[0,2\varphi(n)]$$之内。经典题是 相逢是问候 和 Power Tower(好像是这个名字?)。

-----

反的莫反

反的莫反也是成立的，也就是说$$f(d)=\sum\limits_{d\mid n}g(n)\Leftrightarrow g(d)=\sum\limits_{d\mid n}\mu(\frac{n}{d})f(n)$$。当然这只对有限的函数有效。

如果用dgf解释这个......好像不行。

看起来反的二项式反演也是成立的，并且比正的二项式反演更常用，大量出现在 钦点一些 的容斥中。反的子集反演也是成立的。

-----

寿司晚宴

考虑存在一对不互素的，就是素因子有交。转而算无交的方案数。

然后就可以得到$$2^{\pi(n)}$$的爆力，就是直接枚举每个素数是A选了，B选了，还是都没选。然后如果一个数包含的素数有的被A选了有的被B选了，那就不能选它，否则一方或者两方可以选它也可以不选它。

考虑为什么值域只有可怜的500。注意到500以内有很多个素数，但是$$\sqrt{500}<23$$以下只有$$2,3,5,7,11,13,17,19$$八个素数，于是我们至少可以爆力枚举这些素数的情况。

每个数最多有一个$$\geq 23$$的素因子，于是每个数可以表示成至多一个大素数乘上若干个小素数。现在小素数已经枚举完了，我们在大素数处处理这个数选不选即可。复杂度是$$O(3^{\frac{n}{\ln n}}n)$$。

-----

$$\mu^2$$前缀和

这玩意是可以powerful number的/jy，因为$$\mu^2(p)=1$$，于是找一个$$\mathrm{id}_1$$就行了。这个好像早在去年省选计划就出过，但是我已经完全忘了。

-----

jloi2014 聪明的燕姿

搜。

听起来好离谱?

-----

haoi2018 奇怪的背包

判断是否可行就是，所有数都取$$\gcd$$，看是否整除$$w$$。

然后要计数的话，就是数多少子集加上$$p$$的$$\gcd$$整除$$w$$。这个咋做?

考虑我们记录一下$$\gcd$$，1e9以内最大因数个数只有1e3级别，因为总是要和$$p$$取$$\gcd$$，所以这个$$\gcd$$总是$$p$$的因数，于是我们就直接dp就行了，转移考虑一下感觉可以做到$$O(1)$$，于是就是$$O(nd(v))$$了。

然后这个还是不够好，你发现因为要跟$$p$$取$$\gcd$$，所以实际上只有$$d(v)$$种不同的数，于是就是$$O(d^2(v))$$了。

-----

snoi2017 遗失的答案

把gcd和lcm都分解掉，然后我们得到了对每个素因子的次数上下界限制，这样的素因子最多也只有$$8$$个。呃发现可以把每个数都除掉gcd，然后把gcd扔了，所以只剩上界了。

然后我们选的集合，对每个素因子，都需要有一个数达到上界，有一个数达到下界，这个就容斥一下，每个素因子的上界和下界各有两种情况，一共是$$4^{\omega(n)}=65536$$这么多的状态，然后看起来强制选$$x$$的效果就是不去枚举一些枝了，直接记忆化一下答案就$$O(9^{\omega(n)})$$了，然后就过了。

-----

codechef invxor

定义一个序列的权值是所有子序列xor的和，定义$$f(n,b)$$是长$$n$$的权值为$$b$$的非负整数序列个数，给$$n,m,x$$，求最小的$$b$$使得$$f(n,b)\equiv x\pmod{m}$$，可能无解。$$100$$组数据，$$n\leq 10^{10000},m\leq 10^9$$。

先考虑$$f(n,b)$$是啥，考虑每一位的出现次数，你发现如果这一位有1，那么贡献是$$2^{n-1}$$倍的位权，否则是$$0$$，于是权值就是整个序列的or乘上$$2^{n-1}$$。

然后$$f(n,b)$$也就是有多少个序列的or是$$\frac{b}{2^{n-1}}$$，这个可以容斥一下，钦点一些应该是1的位出现了0。如果or有$$c$$个1，我们钦点有$$i$$位被搞成$$0$$了，于是序列中所有数都在剩下的$$2^{c-i}$$个数中随意选，于是得到

$$
\sum\limits_{i=0}^c(-1)^i\binom{c}{i}2^{(c-i)n}=(2^n-1)^c
$$

。然后问题就是求$$(2^n-1)^c\equiv x\pmod{m}$$的最小解了，exBsgs即可。

-----

一个原根，所有原根

$$g$$是膜$$m$$的原根，当且仅当对于$$\varphi(m)$$的每个素因数$$p$$，都有$$g^{\frac{\varphi(m)}{p}}\ot\equiv 1\pmod{m}$$。同时最小原根是$$O(n^\frac{1}{4})$$级别的，所以从小到大枚举就可以求得最小原根。

如果我们已经得到了一个原根$$g$$，$$g^k$$也是原根，当且仅当$$k\perp\varphi(m)$$，可以想象在一个环上走。

-----

wc2021 斐波那契

给$$a,b,m$$，定义$$g_0=a,g_1=b,g_n=g_{n-1}+g_{n-2}$$，求最小的$$p$$使得$$f_p\bmod{m}=0$$。$$10^5$$次询问，每次给出$$a,b$$而$$m$$不变，$$m\leq 10^5$$。

有很多做法，这里讨论两种，但是有一种咕了。

第一个，先考虑膜素数怎么做。

考虑$$g_n=bf_n+af_{n-1}\equiv 0$$，这样看起来我们可以搞一搞$$f_{n-1},f_{n-2}$$来处理多组询问。经典结论是循环节长度$$\leq 6m$$，于是我们搜出所有循环，然后对每个循环把相邻的$$\frac{f_{n-1}}{f_n}$$扔进map，查询查$$-\frac{b}{a}$$。

如果不膜素数，就没有逆了，我们先给$$a,b,m$$都除掉$$\gcd(a,b,m)$$，只需要考虑$$\gcd(a,b,m)=1$$的情况。

注意到一个牛逼性质$$f_n\perp f_{n-1}$$，于是有一个离奇结论是$$\gcd(f_n,m)=\gcd(a,m),\gcd(f_{n-1},m)=\gcd(b,m)$$，这里不作证明，可以看一看 https://www.luogu.com.cn/blog/CJL/solution-p7325。

把这俩值设为$$d_1,d_2$$，那么我们三边同除$$d_1d_2$$得到$$\frac{b}{d_2}\cdot\frac{f_n}{d_1}+\frac{a}{d_1}\cdot\frac{f_{n-1}}{d_2}\equiv 0\pmod{\frac{m}{d_1d_2}}$$，然后大家就全都互素了，于是求逆元就行了。不过需要对$$m$$的每个因数都预处理一遍，复杂度升高为$$O(\sigma(m)\log m)$$。

第二个，考虑crt，膜$$m$$为$$0$$等价于膜$$m$$的每个素因数幂都为$$0$$，而膜每个素数幂看起来都是一个rho形，我们可以用exgcd合并等差数列。现在问题是怎么做膜$$p^k$$，我不是很会。

我总感觉我打的比赛都没有神仙题，实际上只是因为我做简单题和套路题的速度不够快，以至于我没有时间感受神仙题的神仙（

-----

蒜头的奖杯

怎么说都有点离谱（

## 状压dp，集合幂

2022-02-06

-----

cf1584f

考虑要求lcs，我们需要记上一个字符，然后就设$$dp(c,S)$$表示匹配到字符$$c$$，这个$$c$$ 在各串中是第几个$$c$$ 的状态是$$S$$，然后就做完了。

-----

cf1530f

直接dp，设$$dp(i,S,0/1,0/1)$$表示考虑前$$i$$列，各行状态是$$S$$，两对角线状态是$$0/1,0/1$$的概率，转移枚举这一列的状态，如果一列全是$$1$$那就直接计入答案。然后就死了，因为这是$$4^n$$。

考虑转移是个啥，你发现它看起来是，我们枚举这一行的状态$$T$$，然后用$$\mathrm{P}(T)dp(i,S,0/1,0/1)$$转移到$$S\operatorname{and}T$$。这个看起来是and卷积，于是法嘛塔一下就是$$O(2^nn^2)$$了。

如何优化?换个想法。容斥，枚举对角线和每一行，然后直接算每一列的容斥，每一列就是独立的了，看起来可以直接做。复杂度$$O(2^nn)$$。

-----

cf1523f

直接dp，设$$dp(i,S)$$表示处理了前$$i$$个任务，并且完成了第$$i$$个任务，已经激活了$$S$$中的传送门的答案，转移枚举接下来要激活哪些传送门，以及下一个要做的任务，用另一个状压dp预处理旅行商，复杂度猜测是$$O(3^nm^2)$$。

如何优化?法嘛塔，看起来就是$$O(2^nnm^2)$$了。然后还是过不了，考虑砍一个$$n$$或者砍一个$$m$$。

维度交换。设$$f(i,S)$$表示完成了$$i$$个任务，激活了$$S$$中的传送门，现在在一个传送门的最小时间，这个看起来是强行缩减状态数了。转移枚举接下来是激活一个传送门还是做一个任务，于是设$$g(i,S)$$表示刚完成第$$i$$个任务，激活了$$S$$中的传送门的最大答案。$$g$$的转移也是枚举接下来干什么，复杂度是$$O(2^nm^2)$$。

这个维度交换的作用是，把连续的时间扔到dp的值上去，这看起来是避免把时间变成离散事件的直接方法。不过两个dp数组用不同的维度还是很有趣的。

-----

cf1553h

看起来爆力足有$$4^k$$。

考虑对于一个$$x$$，不要排序啊，从高往低贪心，然后如果一位不同了，大小就确定了，接下来肯定是让小的尽可能大，大的尽可能小，所以我们可以建一个trie然后在上面贪心。

考虑$$x$$增加$$1$$的时候这个trie怎么变化，每一位变化，相当于把这个trie一层每个点的左右子树交换，于是我们每层打一个标记，然后总变化次数是$$2k$$，所以就做完了。复杂度是$$O(nk)$$。

但是这不是状压dp啊?

-----

cf1519f

任意箱子子集对应的钥匙，权值之和比箱子的权值之和大，这个东西让人很难不想起hall定理。建一个图，左边是宝箱，右边是钥匙，要保留一些边，让任意左部点子集的权值和不比邻接的右部点子集权值更大，也就是中间的边容量无穷，左部点有完美匹配。

这个东西看起来就很离谱。设$$dp(i,j,S)$$表示现在匹配了左部点$$i$$的$$j$$个流量，前面的匹配完了，后面的没有匹配，而右部点的情况是$$S$$的最小花费，这个是$$6\times 5\times 5^6$$，看起来就成功了。

-----

后面看起来是集合幂的杂题。

-----

agc043c

看起来很离奇。

首先我们肯定选$$(n,n,n)$$。

然后我们尝试选$$(n-1,n,n),(n,n-1,n),(n,n,n-1)$$中的一个。但是如果$$n-1$$和$$n$$在某个图上有边，对应的就没法选了。

然后我们尝试选$$(n-1,n-1,n),(n-1,n,n-1),(n,n-1,n-1),(n-2,n,n),(n,n-2,n),(n,n,n-2)$$中的一个，你发现如果$$n-1$$和$$n$$在某个图上有边，比如第一个图，这会ban掉两个点。

尝试总结一下，选了$$(n,n,n)$$之后，会在每一维ban掉几个点，然后我们继续选最大的就行了。看起来开三个堆即可，但是为什么会这么简单呢?

呃实际上确实不这么简单。我们可能会遇到几个一样大的，此时就需要在这里面跑一个最大独立集了，并且可能选的点的数量也非常多。

然后正解非常离谱。考虑我们把所有的点建一个dag，从权值小的指向大的，那么问题变成如果一个点连向的点都不选，那就选它，然后这个看起来很像是博弈论里面先/后手必胜的转移。

然后我们可以考虑把sg定理搬过来，因为这和博弈论里的情况完全一致，一个点会选当且仅当sg值为$$0$$。

一个点的sg值是连到的点的mex，然后因为这是三个维度拼起来，维度之间是独立的，所以sg值相当于这个点三张图上sg值的xor(每次只能在一维上移动一步，相当于三维的三个游戏同时进行)，爆力求出三张图每个点的sg值，然后法哇塔一下求xor起来得到$$0$$的方案权值和就好了。复杂度是$$O(m\log m)$$。

更好的方法是，结论是，sg值最大在$$O(\sqrt{m})$$级别，所以我们枚举两个统计另一个即可，复杂度是$$O(m)$$。

-----

## dp优化

haoi2016 字符合并

设$$dp(l,r,S)$$表示$$[l,r]$$合并完了得到$$S$$的最大答案，枚举最后一个字符是怎么来的，复杂度是$$O(n^32^k)$$。

注意到最后一个字符原来的长度肯定是$$(k-1)t+1$$，其中$$t$$是某个数。于是复杂度是$$O(\frac{n^32^k}{k})$$，并且剪一下无用状态，常数小的离谱。卡常看起来也需要找点性质（

-----

联合省选2021 滚榜

考虑判定，直接模拟即可。

考虑爆力，设$$dp(i,S,j,k)$$表示刚滚了$$i$$，之前滚了$$S$$，$$b_i=j$$，$$\sum b_i=k$$的方案数，转移$$O(1)$$，复杂度是$$O(2^nnm^2)$$，飞了。

考虑砍掉一个$$m$$，搞一个提前计算，因为$$b$$是不降的，所以当前这个$$b$$比上个$$b$$多选了，后面的$$b$$也都要增加，而这个增加是整体的，不影响$$a+b$$的大小关系，于是我们可以只用$$a$$来判断需要塞多少。复杂度降为$$O(2^nnm)$$。

要对单调序列进行dp，提前计算是常用技巧?

-----

wc2019 数树 op=1

设相同的边数量是$$c$$，那么答案是$$y^{n-c}$$。

考虑容斥，钦点有$$c$$条边相同，我们树形dp来选这些边，如果形成了$$k$$个连通块大小分别是$$s_1,...,s_k$$，那么拼成一棵树的方案数是$$n^{k-2}\prod s_i$$。做一个二项式反演就彳亍了。

现在问题是怎么dp。爆力做法是用一维记录连通块大小，复杂度是$$O(n^2)$$。

然后这看起来是经典问题了，考虑这个贡献的组合意义，相当于在连通块中选一个点的方案数，于是我们选一个点就行了。这个组合意义有没有对应的代数做法呢?

-----

unr#5 提问系统

爆力怎么做?爆力是不是，把pop贴到前面的push上作为一个操作一起处理，设$$dp(i,j,k)$$表示考虑前$$i$$次操作，用了$$j$$个R，$$i-j$$个B，现在栈中有$$k$$个R，$$t_i-k$$个B，其中$$t_i$$是$$i$$次操作后的问题个数。但是这个失败了，因为我们不知道弹出来的那个是R还是B。

我们需要考虑一下这个问题的结构。

注意到push和pop形成了一棵树，问题相当于我们要给每个点分配一个R或者B，使得每个点到根路径上RB的个数满足数量要求。

考虑树形dp，设$$dp(u,i,j,k)$$表示$$u$$子树有$$i$$个R，到子树中各点路径上，R最多的有$$j$$个R，B最多的有$$k$$个B的方案数，转移是max卷积，前缀和优化一下就$$O(1)$$了。复杂度$$O(n^4)$$。

考虑用一下那个牛逼组合意义的trick，这个贡献相当于选一个R两个B的方案数，于是我们设$$dp(i,j,k,0/1,0/1,0/1)$$表示懂的都懂，复杂度$$O(n^3)$$。

然后遇到了僵局。这里非常离谱，考虑换一个方向，我们这里是下面限制上面，所以需要记两个，如果改为用上面限制下面，也就是钦点了$$u$$到根链上R,B的个数之后再去钦点子树，那么只需要记一个了，因为$$u$$到根链上每个点要么是R要么是B，而总数是一定的。转移仍然可以进行，复杂度$$O(n^2)$$。看起来虽然是套路，但是还是很牛逼的。

-----

cf1342f

看起来比较困难。

我们dp最终的序列，设$$dp(i,S)$$表示考虑最终的前$$i$$个数，$$S$$是一个三进制状态，其中为$$0$$的位置还没用，$$1$$在之前用了，$$2$$在这里用了。转移枚举是新开一个位置还是把一个数放进当前这个位置，复杂度$$O(3^nn^2)$$。

-----

cf1149d

考虑一条路径什么时候是合法的。如果把它选了，仍然有mst，那就合法。

这看起来是废话。更棒的想法是，权值为$$a$$的边都可能在mst上，而权值为$$b$$的边能在mst上的可以求出来，也就是只加$$a$$边得到的连通块之间的边，类似于 mst计数。考虑加入$$a$$边得到的连通块们，连通块内只能走$$a$$边的最短路，也就是说不能走出连通块再走回来。于是一般的最短路做法失败了。

考虑状压dp，设$$dp(S,u)$$表示从$$1$$出发，经过了$$S$$中的连通块，到$$u$$的最小代价。

大小为$$1$$的连通块不需要记，所以复杂度是$$O(2^\frac{n}{2}nm)$$了。

注意到为$$2,3$$的走出去再走回来一定不优也不需要记，所以就是$$O(2^\frac{n}{4}nm)$$了，就过掉了。

-----

cf1039d

看起来像是 赛道修建，但是并不是。

考虑7s是干什么，我们凑个离奇复杂度，根号$$\log$$。先根号分治，小的multiset贪心，大的答案不超过根号可以枚举答案，二分最长选多少。真的是根号$$\log$$。

这个题引出一个结论，看起来是整除分块结论的加强版，如果整值函数$$f(n,k)\leq\frac{n}{k}$$，那么$$f(n,k)$$的取值只有$$O(\sqrt{n})$$种。

这看起来不是dp题?

-----

cf1119f/apio2021 B

爆力是，先枚举一个$$x$$，然后树形dp，设$$dp(u,0/1)$$表示$$u$$子树，删/不删$$u$$的父边的最小代价。转移排个序，选选了更优的就行了。

考虑我们从小到大扫$$x$$，如果一个点的度数比$$x$$要小了，那它就没用了，只有它的邻边有用，这样总点数是所有点的度数之和，它是$$O(n)$$的。

然后我们需要支持把这个点的dp值删掉，把它的邻边扔回去，可以用一个堆维护。复杂度$$O(n\log n)$$。

-----

cf917c

只有左边的青蛙可以跳，所以青蛙们集中在长$$k$$的一段里面，可以状压，状态数最大是$$\binom{k}{\frac{k}{2}}=70$$。

然后矩阵快速幂一下就好了。

-----

uer#7 套路

这好像也不是dp。

根号分治。如果区间长度超过根号，那么$$s$$就不超过根号，我们扫右端点，维护往左看$$s$$第一次取到每个值的位置，右端点右移一位，这些位置都只可能右移。考虑如何更新它们，如果我们要加入$$x$$，那么把前面所有距离$$x$$不超过根号的数找出来拼一拼，看看这些位置能不能提前。

如果区间长度不超过根号，爆力。

-----

雅礼集训2017 day5 珠宝

既然有五个亿，为什么不多雇几个保镖呢（

这是背包。

重量很少，所以重量相同的珠宝很多。

对于每个重量，我们肯定是先选价值大的，于是它是一个上凸的，然后我们要把若干个上凸函数做$$(\max,+)$$卷积，但是每个函数的步长是不一样的。

不过我们至少可以每次加入一个函数，然后这是多重背包，按膜重量分开转移，但是这里我们并没法用单调队列。复杂度是$$O(kc^2)$$。

注意到因为这是凸的，于是我们猜测整个问题都是凸的，所以有决策单调性，对于同一组，如果在背包容量为$$m$$的时候选$$i$$个比选$$j>i$$个要优，背包容量$$\geq m$$的时候还是选$$i$$个更优，于是可以决策单调性分治。复杂度$$O(kc\log k)$$。

## 模拟赛

A和B看起来好像比较无趣，A是z algo的板子(题解用的是kmp，看起来说明了kmp和z algo的等价性)，B的话rqy在sdsc2019就搬过。

C. fee

原题gym101630j/luogu6961 neerc2017 Journey from Petersburg to Moscow。

有一张有向图，边有边权，还有起点终点$$s,t$$和一个$$k$$。求$$s$$到$$t$$的最短路，这里最短路只计算边权最大的$$k$$条边，不足$$k$$条就全算。$$n,k\leq 1000,m\leq 2000,v\leq 10^9$$，2s。

据说很有趣。

免费一部分，这让我们想起来cf有个题是最大的免费，但是那个看起来并不能用到这里，因为这里是最大的收费。

考虑这个看起来有点像瓶颈路，但是我们显然不能直接用瓶颈路的做法。

必须得把这个 前$$k$$大 转化掉，因为最短路的处理都是局部的。

峰峰峰指出，考虑我们扫值域，给权值相同的随便钦定一个顺序，枚举第$$k$$大，设为$$x$$，让$$\geq x$$的产生贡献，然后跑一个最短路，把这条最短路拿去算出前$$k$$大之和并更新答案。

考虑证明最优解一定会是被恰好枚举到第$$k$$大的时候的最短路。然后你发现这个不对，反例是有一条路径由一条极大边和一些小边组成，然后极大边恰好比最优解小一点，于是我们失败了。

换个想法，还是枚举第$$k$$大$$x$$，然后$$\geq x$$的选恰好$$k$$条(说至少$$k$$条是一样的)，$$<x$$的随便选，可以用分层图搞定，这样做看起来非常正确，但是复杂度是$$O(m^2k\log n)$$，显然过不去。

考虑了很多做法。然后做不动了。

正解非常离奇，考虑给每条长边的权值减去$$x$$，然后直接跑最短路，再给最短路长度加上$$kx$$更新答案。对于任意一条路径，如果它的第$$k$$大比$$x$$小，那么加$$kx$$的时候会把它算大，如果它的第$$k$$大比$$x$$大，那么跑最短路的时候就会有更多的边产生贡献。于是做完了。

还是比较的妙啊。据说庭队长直接秒了。

因为这个题能做，而扫值域是必须的，最短路是必须的，于是必须有一个方法扔掉分层图直接跑最短路，此时对图做一些操作就是理所当然的，可以枚举几个想法然后尝试证明正确性。