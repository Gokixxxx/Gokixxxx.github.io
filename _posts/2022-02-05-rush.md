---
layout: post
title: 省选前的集训内容
subtitle: /kk
tags: 杂项
---

所有的都在这里了。不放来源了（

## 数论

2022-02-05

$$O(v)$$预处理，$$O(1)$$ gcd

没看懂，自己胡了一个。考虑要求$$\gcd(x,y)$$，我们可以把$$x$$分解成若干个$$\sqrt{v}$$级别的数的乘积，然后预处理$$\sqrt{v}$$以内的$$\gcd$$，把$$y$$对第一个取膜并查表，然后把$$y$$除掉第一轮的答案，再对第二个取膜并查表......如果分解成$$O(1)$$个数，那么复杂度就是$$O(1)$$。

结论是每个数都可以分解成三个$$\leq\sqrt{n}$$的数的乘积，除非$$n$$有一个很大的素因子。构造方法是，线筛筛出每个数$$i$$的最小素因子$$p$$，然后把$$p$$塞到$$\frac{i}{p}$$的分解里面，尽量塞到靠前的位置。

看起来常数吓人了（

-----

Pollard-rho

先MR判掉素数。

考虑$$n$$的最小素因子$$p$$，有$$p\leq\sqrt{n}$$。

考虑一个随机函数$$f(x)$$，我们找一个$$x$$，假装我们可以计算$$x,f(x),f(f(x)),...$$膜$$p$$的值(但是我们还是不知道$$p$$)，根据生日悖论的结论，期望$$\sqrt{p}$$次就能找到两个相同的，设为$$x,y$$，此后会进入一个循环，于是这个过程看起来像是一个rho。

相同的有啥用?考虑膜$$p$$会在期望$$\Theta(\sqrt{p})=O(\sqrt[4]{n})$$次后循环，而膜$$n$$是$$\Theta(\sqrt{n})$$次，这两个rho很可能不一样，于是$$x\equiv y\pmod{p}$$，但是$$x\not\equiv y\pmod{n}$$，于是$$x-y$$是$$p$$的倍数而不是$$n$$的倍数，于是使用$$\gcd(x-y,n)$$就可以求出$$p$$。

我们并不能计算$$x,f(x),f(f(x)),...$$膜$$p$$的值，但是我们可以每一步都当成进入了循环。期望$$O(\sqrt[4]{n})$$次就循环了，于是我们每次随机两个，期望$$O(\sqrt[4]{n})$$就能找到值相同的，虽然我们并不知道它们值是否相同，但是可以每随一次都求一个$$\gcd(x-y,n)$$直到它$$>1$$，或者我们觉得这个$$f$$没希望了而换一个。然后因为函数是随机的，看起来我们直接迭代就是随机的，于是可以用一个类似于floyd判环的做法，让一个变量每轮迭代一步，另一个每轮迭代两步这样的。

这个找一个素因子的复杂度看起来是$$O(\sqrt[4]{n}\log n)$$，分解的复杂度还需要多一个$$\log$$。

考虑我们怎么砍$$\gcd$$的$$\log$$，你发现我们每次是有一堆$$x-y$$然后要求$$\gcd(x-y,n)>1$$的一个，那么我们可以每$$\log$$个分一块，每一块都乘起来和$$n$$求$$\gcd$$，如果$$>1$$再爆力遍历这一块。

实现可以取$$f(x)=x^2+c$$，其中$$c$$是随机整数。

-----

exLucas

这年头还会出这种东西吗（

咕咕咕。

-----

exBsgs

小驼峰（~~。BSgS : 大驼峰小驼峰~~

求解$$a^x\bmod{n}=b$$，其中$$a,n$$不一定互素。

考虑没法直接bsgs是因为$$a,n$$不互素，此时我们把$$x$$拆成$$x_1K-x_2$$的话，因为没有逆所以可能一个$$x_1$$对应了多个$$x_2$$，但是这些$$x_2$$并不都可行。

于是我们考虑除掉$$\gcd(a^x,n)$$让它俩互素。但是我们不知道$$a^x$$啊?

考虑我们先除掉$$\gcd(a,n)$$，然后有可能有$$a\not\perp\frac{n}{\gcd(a,n)}$$，那我们就继续除掉新的$$\gcd$$，显然除$$k=O(\log n)$$次就除没了，然后我们再判一下$$k$$以内有没有解。

现在方程看起来是$$\frac{a^x}{d}\bmod{\frac{n}{d}}=\frac{b}{d}$$，如果$$d\not\mid b$$就直接无解了，否则我们把$$\frac{a^k}{d}$$扔到右边(除光了所以必然有逆元)，然后用一般的bsgs。

-----

扩欧定理（

众所周知，~~扩欧可以用来求解一元一次同余方程~~ 费马小定理可以用来在膜素数的时候给指数取膜。exEuler定理说明，膜合数也可以给指数取膜，方法是如果我们要算$$a^x\bmod{n}$$，那么

 - 如果$$a\perp n$$，那么$$a^x\equiv a^{x\bmod{\varphi(n)}}$$。

 - 否则，如果$$x\geq\varphi(n)$$，那么$$a^x\equiv a^{x\bmod{\varphi(n)}+\varphi(n)}$$。

 - 否则exEuler定理并不能做什么。

这个可以保证指数在$$[0,2\varphi(n)]$$之内。经典题是 相逢是问候 和 Power Tower(好像是这个名字?)。

-----

反的莫反

反的莫反也是成立的，也就是说$$f(d)=\sum\limits_{d\mid n}g(n)\Leftrightarrow g(d)=\sum\limits_{d\mid n}\mu(\frac{n}{d})f(n)$$。当然这只对有限的函数有效。

如果用dgf解释这个......好像不行。

看起来反的二项式反演也是成立的，并且比正的二项式反演更常用，大量出现在 钦点一些 的容斥中。反的子集反演也是成立的。

-----

寿司晚宴

考虑存在一对不互素的，就是素因子有交。转而算无交的方案数。

然后就可以得到$$2^{\pi(n)}$$的爆力，就是直接枚举每个素数是A选了，B选了，还是都没选。然后如果一个数包含的素数有的被A选了有的被B选了，那就不能选它，否则一方或者两方可以选它也可以不选它。

考虑为什么值域只有可怜的500。注意到500以内有很多个素数，但是$$\sqrt{500}<23$$以下只有$$2,3,5,7,11,13,17,19$$八个素数，于是我们至少可以爆力枚举这些素数的情况。

每个数最多有一个$$\geq 23$$的素因子，于是每个数可以表示成至多一个大素数乘上若干个小素数。现在小素数已经枚举完了，我们在大素数处处理这个数选不选即可。复杂度是$$O(3^{\frac{n}{\ln n}}n)$$。

-----

$$\mu^2$$前缀和

这玩意是可以powerful number的/jy，因为$$\mu^2(p)=1$$，于是找一个$$\mathrm{id}_1$$就行了。这个好像早在去年省选计划就出过，但是我已经完全忘了。

-----

jloi2014 聪明的燕姿

搜。

听起来好离谱?

-----

haoi2018 奇怪的背包

判断是否可行就是，所有数都取$$\gcd$$，看是否整除$$w$$。

然后要计数的话，就是数多少子集加上$$p$$的$$\gcd$$整除$$w$$。这个咋做?

考虑我们记录一下$$\gcd$$，1e9以内最大因数个数只有1e3级别，因为总是要和$$p$$取$$\gcd$$，所以这个$$\gcd$$总是$$p$$的因数，于是我们就直接dp就行了，转移考虑一下感觉可以做到$$O(1)$$，于是就是$$O(nd(v))$$了。

然后这个还是不够好，你发现因为要跟$$p$$取$$\gcd$$，所以实际上只有$$d(v)$$种不同的数，于是就是$$O(d^2(v))$$了。

-----

snoi2017 遗失的答案

把gcd和lcm都分解掉，然后我们得到了对每个素因子的次数上下界限制，这样的素因子最多也只有$$8$$个。呃发现可以把每个数都除掉gcd，然后把gcd扔了，所以只剩上界了。

然后我们选的集合，对每个素因子，都需要有一个数达到上界，有一个数达到下界，这个就容斥一下，每个素因子的上界和下界各有两种情况，一共是$$4^{\omega(n)}=65536$$这么多的状态，然后看起来强制选$$x$$的效果就是不去枚举一些枝了，直接记忆化一下答案就$$O(9^{\omega(n)})$$了，然后就过了。

-----

codechef invxor

定义一个序列的权值是所有子序列xor的和，定义$$f(n,b)$$是长$$n$$的权值为$$b$$的非负整数序列个数，给$$n,m,x$$，求最小的$$b$$使得$$f(n,b)\equiv x\pmod{m}$$，可能无解。$$100$$组数据，$$n\leq 10^{10000},m\leq 10^9$$。

先考虑$$f(n,b)$$是啥，考虑每一位的出现次数，你发现如果这一位有1，那么贡献是$$2^{n-1}$$倍的位权，否则是$$0$$，于是权值就是整个序列的or乘上$$2^{n-1}$$。

然后$$f(n,b)$$也就是有多少个序列的or是$$\frac{b}{2^{n-1}}$$，这个可以容斥一下，钦点一些应该是1的位出现了0。如果or有$$c$$个1，我们钦点有$$i$$位被搞成$$0$$了，于是序列中所有数都在剩下的$$2^{c-i}$$个数中随意选，于是得到

$$
\sum\limits_{i=0}^c(-1)^i\binom{c}{i}2^{(c-i)n}=(2^n-1)^c
$$

。然后问题就是求$$(2^n-1)^c\equiv x\pmod{m}$$的最小解了，exBsgs即可。

-----

一个原根，所有原根

$$g$$是膜$$m$$的原根，当且仅当对于$$\varphi(m)$$的每个素因数$$p$$，都有$$g^{\frac{\varphi(m)}{p}}\not\equiv 1\pmod{m}$$。同时最小原根是$$O(n^\frac{1}{4})$$级别的，所以从小到大枚举就可以求得最小原根。

如果我们已经得到了一个原根$$g$$，$$g^k$$也是原根，当且仅当$$k\perp\varphi(m)$$，可以想象在一个环上走。

-----

wc2021 斐波那契

给$$a,b,m$$，定义$$g_0=a,g_1=b,g_n=g_{n-1}+g_{n-2}$$，求最小的$$p$$使得$$f_p\bmod{m}=0$$。$$10^5$$次询问，每次给出$$a,b$$而$$m$$不变，$$m\leq 10^5$$。

有很多做法，这里讨论两种，但是有一种咕了。

第一个，先考虑膜素数怎么做。

考虑$$g_n=bf_n+af_{n-1}\equiv 0$$，这样看起来我们可以搞一搞$$f_{n-1},f_{n-2}$$来处理多组询问。经典结论是循环节长度$$\leq 6m$$，于是我们搜出所有循环，然后对每个循环把相邻的$$\frac{f_{n-1}}{f_n}$$扔进map，查询查$$-\frac{b}{a}$$。

如果不膜素数，就没有逆了，我们先给$$a,b,m$$都除掉$$\gcd(a,b,m)$$，只需要考虑$$\gcd(a,b,m)=1$$的情况。

注意到一个牛逼性质$$f_n\perp f_{n-1}$$，于是有一个离奇结论是$$\gcd(f_n,m)=\gcd(a,m),\gcd(f_{n-1},m)=\gcd(b,m)$$，这里不作证明，可以看一看 https://www.luogu.com.cn/blog/CJL/solution-p7325。

把这俩值设为$$d_1,d_2$$，那么我们三边同除$$d_1d_2$$得到$$\frac{b}{d_2}\cdot\frac{f_n}{d_1}+\frac{a}{d_1}\cdot\frac{f_{n-1}}{d_2}\equiv 0\pmod{\frac{m}{d_1d_2}}$$，然后大家就全都互素了，于是求逆元就行了。不过需要对$$m$$的每个因数都预处理一遍，复杂度升高为$$O(\sigma(m)\log m)$$。

第二个，考虑crt，膜$$m$$为$$0$$等价于膜$$m$$的每个素因数幂都为$$0$$，而膜每个素数幂看起来都是一个rho形，我们可以用exgcd合并等差数列。现在问题是怎么做膜$$p^k$$，我不是很会。

我总感觉我打的比赛都没有神仙题，实际上只是因为我做简单题和套路题的速度不够快，以至于我没有时间感受神仙题的神仙（

-----

蒜头的奖杯

怎么说都有点离谱（

## 状压dp，集合幂

2022-02-06

-----

cf1584f

考虑要求lcs，我们需要记上一个字符，然后就设$$dp(c,S)$$表示匹配到字符$$c$$，这个$$c$$ 在各串中是第几个$$c$$ 的状态是$$S$$，然后就做完了。

-----

cf1530f

直接dp，设$$dp(i,S,0/1,0/1)$$表示考虑前$$i$$列，各行状态是$$S$$，两对角线状态是$$0/1,0/1$$的概率，转移枚举这一列的状态，如果一列全是$$1$$那就直接计入答案。然后就死了，因为这是$$4^n$$。

考虑转移是个啥，你发现它看起来是，我们枚举这一行的状态$$T$$，然后用$$\mathrm{P}(T)dp(i,S,0/1,0/1)$$转移到$$S\operatorname{and}T$$。这个看起来是and卷积，于是法嘛塔一下就是$$O(2^nn^2)$$了。

如何优化?换个想法。容斥，枚举对角线和每一行，然后直接算每一列的容斥，每一列就是独立的了，看起来可以直接做。复杂度$$O(2^nn)$$。

-----

cf1523f

直接dp，设$$dp(i,S)$$表示处理了前$$i$$个任务，并且完成了第$$i$$个任务，已经激活了$$S$$中的传送门的答案，转移枚举接下来要激活哪些传送门，以及下一个要做的任务，用另一个状压dp预处理旅行商，复杂度猜测是$$O(3^nm^2)$$。

如何优化?法嘛塔，看起来就是$$O(2^nnm^2)$$了。然后还是过不了，考虑砍一个$$n$$或者砍一个$$m$$。

维度交换。设$$f(i,S)$$表示完成了$$i$$个任务，激活了$$S$$中的传送门，现在在一个传送门的最小时间，这个看起来是强行缩减状态数了。转移枚举接下来是激活一个传送门还是做一个任务，于是设$$g(i,S)$$表示刚完成第$$i$$个任务，激活了$$S$$中的传送门的最大答案。$$g$$的转移也是枚举接下来干什么，复杂度是$$O(2^nm^2)$$。

这个维度交换的作用是，把连续的时间扔到dp的值上去，这看起来是避免把时间变成离散事件的直接方法。不过两个dp数组用不同的维度还是很有趣的。

-----

cf1553h

看起来爆力足有$$4^k$$。

考虑对于一个$$x$$，不要排序啊，从高往低贪心，然后如果一位不同了，大小就确定了，接下来肯定是让小的尽可能大，大的尽可能小，所以我们可以建一个trie然后在上面贪心。

考虑$$x$$增加$$1$$的时候这个trie怎么变化，每一位变化，相当于把这个trie一层每个点的左右子树交换，于是我们每层打一个标记，然后总变化次数是$$2k$$，所以就做完了。复杂度是$$O(nk)$$。

但是这不是状压dp啊?

-----

cf1519f

任意箱子子集对应的钥匙，权值之和比箱子的权值之和大，这个东西让人很难不想起hall定理。建一个图，左边是宝箱，右边是钥匙，要保留一些边，让任意左部点子集的权值和不比邻接的右部点子集权值更大，也就是中间的边容量无穷，左部点有完美匹配。

这个东西看起来就很离谱。设$$dp(i,j,S)$$表示现在匹配了左部点$$i$$的$$j$$个流量，前面的匹配完了，后面的没有匹配，而右部点的情况是$$S$$的最小花费，这个是$$6\times 5\times 5^6$$，看起来就成功了。

-----

后面看起来是集合幂的杂题。

-----

agc043c

看起来很离奇。

首先我们肯定选$$(n,n,n)$$。

然后我们尝试选$$(n-1,n,n),(n,n-1,n),(n,n,n-1)$$中的一个。但是如果$$n-1$$和$$n$$在某个图上有边，对应的就没法选了。

然后我们尝试选$$(n-1,n-1,n),(n-1,n,n-1),(n,n-1,n-1),(n-2,n,n),(n,n-2,n),(n,n,n-2)$$中的一个，你发现如果$$n-1$$和$$n$$在某个图上有边，比如第一个图，这会ban掉两个点。

尝试总结一下，选了$$(n,n,n)$$之后，会在每一维ban掉几个点，然后我们继续选最大的就行了。看起来开三个堆即可，但是为什么会这么简单呢?

呃实际上确实不这么简单。我们可能会遇到几个一样大的，此时就需要在这里面跑一个最大独立集了，并且可能选的点的数量也非常多。

然后正解非常离谱。考虑我们把所有的点建一个dag，从权值小的指向大的，那么问题变成如果一个点连向的点都不选，那就选它，然后这个看起来很像是博弈论里面先/后手必胜的转移。

然后我们可以考虑把sg定理搬过来，因为这和博弈论里的情况完全一致，一个点会选当且仅当sg值为$$0$$。

一个点的sg值是连到的点的mex，然后因为这是三个维度拼起来，维度之间是独立的，所以sg值相当于这个点三张图上sg值的xor(每次只能在一维上移动一步，相当于三维的三个游戏同时进行)，爆力求出三张图每个点的sg值，然后法哇塔一下求xor起来得到$$0$$的方案权值和就好了。复杂度是$$O(m\log m)$$。

更好的方法是，结论是，sg值最大在$$O(\sqrt{m})$$级别，所以我们枚举两个统计另一个即可，复杂度是$$O(m)$$。

-----

## dp优化

haoi2016 字符合并

设$$dp(l,r,S)$$表示$$[l,r]$$合并完了得到$$S$$的最大答案，枚举最后一个字符是怎么来的，复杂度是$$O(n^32^k)$$。

注意到最后一个字符原来的长度肯定是$$(k-1)t+1$$，其中$$t$$是某个数。于是复杂度是$$O(\frac{n^32^k}{k})$$，并且剪一下无用状态，常数小的离谱。卡常看起来也需要找点性质（

-----

联合省选2021 滚榜

考虑判定，直接模拟即可。

考虑爆力，设$$dp(i,S,j,k)$$表示刚滚了$$i$$，之前滚了$$S$$，$$b_i=j$$，$$\sum b_i=k$$的方案数，转移$$O(1)$$，复杂度是$$O(2^nnm^2)$$，飞了。

考虑砍掉一个$$m$$，搞一个提前计算，因为$$b$$是不降的，所以当前这个$$b$$比上个$$b$$多选了，后面的$$b$$也都要增加，而这个增加是整体的，不影响$$a+b$$的大小关系，于是我们可以只用$$a$$来判断需要塞多少。复杂度降为$$O(2^nnm)$$。

要对单调序列进行dp，提前计算是常用技巧?

-----

wc2019 数树 op=1

设相同的边数量是$$c$$，那么答案是$$y^{n-c}$$。

考虑容斥，钦点有$$c$$条边相同，我们树形dp来选这些边，如果形成了$$k$$个连通块大小分别是$$s_1,...,s_k$$，那么拼成一棵树的方案数是$$n^{k-2}\prod s_i$$。做一个二项式反演就彳亍了。

现在问题是怎么dp。爆力做法是用一维记录连通块大小，复杂度是$$O(n^2)$$。

然后这看起来是经典问题了，考虑这个贡献的组合意义，相当于在连通块中选一个点的方案数，于是我们选一个点就行了。这个组合意义有没有对应的代数做法呢?

-----

unr#5 提问系统

爆力怎么做?爆力是不是，把pop贴到前面的push上作为一个操作一起处理，设$$dp(i,j,k)$$表示考虑前$$i$$次操作，用了$$j$$个R，$$i-j$$个B，现在栈中有$$k$$个R，$$t_i-k$$个B，其中$$t_i$$是$$i$$次操作后的问题个数。但是这个失败了，因为我们不知道弹出来的那个是R还是B。

我们需要考虑一下这个问题的结构。

注意到push和pop形成了一棵树，问题相当于我们要给每个点分配一个R或者B，使得每个点到根路径上RB的个数满足数量要求。

考虑树形dp，设$$dp(u,i,j,k)$$表示$$u$$子树有$$i$$个R，到子树中各点路径上，R最多的有$$j$$个R，B最多的有$$k$$个B的方案数，转移是max卷积，前缀和优化一下就$$O(1)$$了。复杂度$$O(n^4)$$。

考虑用一下那个牛逼组合意义的trick，这个贡献相当于选一个R两个B的方案数，于是我们设$$dp(i,j,k,0/1,0/1,0/1)$$表示懂的都懂，复杂度$$O(n^3)$$。

然后遇到了僵局。这里非常离谱，考虑换一个方向，我们这里是下面限制上面，所以需要记两个，如果改为用上面限制下面，也就是钦点了$$u$$到根链上R,B的个数之后再去钦点子树，那么只需要记一个了，因为$$u$$到根链上每个点要么是R要么是B，而总数是一定的。转移仍然可以进行，复杂度$$O(n^2)$$。看起来虽然是套路，但是还是很牛逼的。

-----

cf1342f

看起来比较困难。

我们dp最终的序列，设$$dp(i,S)$$表示考虑最终的前$$i$$个数，$$S$$是一个三进制状态，其中为$$0$$的位置还没用，$$1$$在之前用了，$$2$$在这里用了。转移枚举是新开一个位置还是把一个数放进当前这个位置，复杂度$$O(3^nn^2)$$。

-----

cf1149d

考虑一条路径什么时候是合法的。如果把它选了，仍然有mst，那就合法。

这看起来是废话。更棒的想法是，权值为$$a$$的边都可能在mst上，而权值为$$b$$的边能在mst上的可以求出来，也就是只加$$a$$边得到的连通块之间的边，类似于 mst计数。考虑加入$$a$$边得到的连通块们，连通块内只能走$$a$$边的最短路，也就是说不能走出连通块再走回来。于是一般的最短路做法失败了。

考虑状压dp，设$$dp(S,u)$$表示从$$1$$出发，经过了$$S$$中的连通块，到$$u$$的最小代价。

大小为$$1$$的连通块不需要记，所以复杂度是$$O(2^\frac{n}{2}nm)$$了。

注意到为$$2,3$$的走出去再走回来一定不优也不需要记，所以就是$$O(2^\frac{n}{4}nm)$$了，就过掉了。

-----

cf1039d

看起来像是 赛道修建，但是并不是。

考虑7s是干什么，我们凑个离奇复杂度，根号$$\log$$。先根号分治，小的multiset贪心，大的答案不超过根号可以枚举答案，二分最长选多少。真的是根号$$\log$$。

这个题引出一个结论，看起来是整除分块结论的加强版，如果整值函数$$f(n,k)\leq\frac{n}{k}$$，那么$$f(n,k)$$的取值只有$$O(\sqrt{n})$$种。

这看起来不是dp题?

-----

cf1119f/apio2021 B

爆力是，先枚举一个$$x$$，然后树形dp，设$$dp(u,0/1)$$表示$$u$$子树，删/不删$$u$$的父边的最小代价。转移排个序，选选了更优的就行了。

考虑我们从小到大扫$$x$$，如果一个点的度数比$$x$$要小了，那它就没用了，只有它的邻边有用，这样总点数是所有点的度数之和，它是$$O(n)$$的。

然后我们需要支持把这个点的dp值删掉，把它的邻边扔回去，可以用一个堆维护。复杂度$$O(n\log n)$$。

-----

cf917c

只有左边的青蛙可以跳，所以青蛙们集中在长$$k$$的一段里面，可以状压，状态数最大是$$\binom{k}{\frac{k}{2}}=70$$。

然后矩阵快速幂一下就好了。

-----

uer#7 套路

这好像也不是dp。

根号分治。如果区间长度超过根号，那么$$s$$就不超过根号，我们扫右端点，维护往左看$$s$$第一次取到每个值的位置，右端点右移一位，这些位置都只可能右移。考虑如何更新它们，如果我们要加入$$x$$，那么把前面所有距离$$x$$不超过根号的数找出来拼一拼，看看这些位置能不能提前。

如果区间长度不超过根号，爆力。

-----

雅礼集训2017 day5 珠宝

既然有五个亿，为什么不多雇几个保镖呢（

这是背包。

重量很少，所以重量相同的珠宝很多。

对于每个重量，我们肯定是先选价值大的，于是它是一个上凸的，然后我们要把若干个上凸函数做$$(\max,+)$$卷积，但是每个函数的步长是不一样的。

不过我们至少可以每次加入一个函数，然后这是多重背包，按膜重量分开转移，但是这里我们并没法用单调队列。复杂度是$$O(kc^2)$$。

注意到因为这是凸的，于是我们猜测整个问题都是凸的，所以有决策单调性，对于同一组，如果在背包容量为$$m$$的时候选$$i$$个比选$$j>i$$个要优，背包容量$$\geq m$$的时候还是选$$i$$个更优，于是可以决策单调性分治。复杂度$$O(kc\log k)$$。

## 模拟赛

A和B看起来好像比较无趣，A是z algo的板子(题解用的是kmp，看起来说明了kmp和z algo的等价性)，B的话rqy在sdsc2019就搬过。

C. fee

原题gym101630j/luogu6961 neerc2017 Journey from Petersburg to Moscow。

有一张有向图，边有边权，还有起点终点$$s,t$$和一个$$k$$。求$$s$$到$$t$$的最短路，这里最短路只计算边权最大的$$k$$条边，不足$$k$$条就全算。$$n,k\leq 1000,m\leq 2000,v\leq 10^9$$，2s。

据说很有趣。

免费一部分，这让我们想起来cf有个题是最大的免费，但是那个看起来并不能用到这里，因为这里是最大的收费。

考虑这个看起来有点像瓶颈路，但是我们显然不能直接用瓶颈路的做法。

必须得把这个 前$$k$$大 转化掉，因为最短路的处理都是局部的。

峰峰峰指出，考虑我们扫值域，给权值相同的随便钦定一个顺序，枚举第$$k$$大，设为$$x$$，让$$\geq x$$的产生贡献，然后跑一个最短路，把这条最短路拿去算出前$$k$$大之和并更新答案。

考虑证明最优解一定会是被恰好枚举到第$$k$$大的时候的最短路。然后你发现这个不对，反例是有一条路径由一条极大边和一些小边组成，然后极大边恰好比最优解小一点，于是我们失败了。

换个想法，还是枚举第$$k$$大$$x$$，然后$$\geq x$$的选恰好$$k$$条(说至少$$k$$条是一样的)，$$<x$$的随便选，可以用分层图搞定，这样做看起来非常正确，但是复杂度是$$O(m^2k\log n)$$，显然过不去。

考虑了很多做法。然后做不动了。

正解非常离奇，考虑给每条长边的权值减去$$x$$，然后直接跑最短路，再给最短路长度加上$$kx$$更新答案。对于任意一条路径，如果它的第$$k$$大比$$x$$小，那么加$$kx$$的时候会把它算大，如果它的第$$k$$大比$$x$$大，那么跑最短路的时候就会有更多的边产生贡献。于是做完了。

还是比较的妙啊。据说庭队长直接秒了。

因为这个题能做，而扫值域是必须的，最短路是必须的，于是必须有一个方法扔掉分层图直接跑最短路，此时对图做一些操作就是理所当然的，可以枚举几个想法然后尝试证明正确性。

-----

然后我们考虑了一下这么一个问题。每条路径的代价关于$$k$$都是凸的，于是让人想到wqs二分，但是这个凸性不对，它是上凸的而不是下凸的，而答案是求最小值。

如果可以wqs二分，做法应该是二分一个负的附加权值$$x$$，然后如果$$w+x>0$$则当成短边，$$w+x\leq 0$$当成长边。看起来这个直接失败了，因为减一减就出负环了。我不知道该如何描述它在干什么。



## 杂题选讲

gym103371 xxii open cup, gp of korea B

Kim接下来要做$$n$$份面条，每份面条可能加香菜或者不加，有$$n$$个顾客，每个顾客可能要或者不要香菜。Kim有一个栈，面条做出来了可以塞进栈里面，也可以弹出一个面条给一个顾客，顾客们必须被按顺序给面条。给出面条们加不加香菜的情况，以及顾客们要不要香菜的情况，求第一个人可能拿到哪些面条，只需要输出这些面条的编号和。$$n\leq 5\times 10^6$$，0.5s。

看起来要线性。

我们要删去每一个$$i$$，然后栈里有前$$i-1$$个，后面有$$n-i$$个，要判定能不能给剩下的顾客。

考虑一个牛逼想法，我们可以贪心，能弹就弹，因为栈里的看起来自由度更低。然后前缀增量就搞定了，问题是怎么搞后缀，也就是查询栈中一个前缀，栈外有一个后缀，要匹配一个顾客的后缀，是否可行。看起来很复杂。

考虑怎么1$$\log$$。据说这是显然的?如果第$$i$$份面条香菜放的是对的，但是不能给第一个人，那么后面所有面条都不能给第一个人了，因为栈外面的自由度比栈里面大。于是可以二分一下。

赵神赢之言可谓切中了肯綮。如果栈里剩下的，弹出来得到第$$2,...,n$$个人的一个子序列，那么就可行。倒着建立子序列自动机，然后在上面走就行了，复杂度线性，实际上也不需要建子序列自动机，反正只要匹配一次。

一个差不多自然的想法是，我们要求最远的面条使得它可以被第一个人拿到，于是前面的面条应该尽可能分给后面的人，这样往前分分分，直到分不动了就得到了答案。

-----

uoj695 候选队互测2022 毛估估就行

爆力怎么做?爆力是不是，直接从每个点出发bfs，用bitset找没有走过的邻接点，复杂度$$O(\frac{n^3}{w})$$。据说卡卡常就冲过去了（

还有没有别的爆力?

考虑算最短路肯定要bfs，但是从每个点出发bfs就很难搞，如果要求$$u\rightarrow v$$的最短路，我们可以考虑如果$$w$$离这条路径很近，那么可以用$$u\rightarrow w\rightarrow v$$近似。注意到如果$$w$$在这条路边上，那么这么近似出来的答案在真实答案到真实答案$$+2$$之间，把它$$-1$$就可以满足要求。

那么我们考虑干这么一件事，每次从一个点出发跑(普通的)bfs，然后把它删掉，图会分成若干连通块，每个连通块再递归就彳亍了。

考虑如何才能让这个规模快速减小，选取度数最大的点，它的度数至少是$$\frac{2m}{n}$$，而复杂度是$$O(\sum m_i)$$，其中$$m_i$$是删了$$i$$个点之后的边数。注意到我们删$$n$$次就把所有边删完了，第$$i$$次至少删$$\frac{2m_i}{i}$$条边，所以有$$\sum\frac{2m_i}{i}\geq n^2$$，于是$$\sum\frac{2m_i}{n}\leq n$$，于是$$\sum m_i=O(n^2)$$。

-----

cf1556g

-----

gym103371m

直接数点。这个好像lxl搬过一个更强的?

-----

gym103415d

题意是，有$$n$$个idea，其中有$$k$$个EE类和$$n-k$$个E类。你要用这些idea造$$m$$个题，每个题包含若干个EE类idea和一个E类idea，题是无序的，不能有两个题的idea完全相同。还给两个要求，表示有$$o_{ee}/o_{ez}$$个EE类/E类idea要在奇数个题中出现，剩下的要在偶数个题中出现，注意idea是可区分的。求方案数膜$$19260817$$。$$n\leq 10^9,m\leq 10^6,2^n-2^k\geq m$$。

注意到EE类idea的奇偶性我们只需要拿出最后一个题来救一下。

容斥，钦点若干对相同的题，然后它们就不需要决策了，问题变成快速求选$$m$$个题，可以相同的方案数。

先给所有出现奇数次的E类idea凑一个题，如果题数太少凑不完那就无解。然后每次拿一个E类idea，给它凑两个题。然后你发现我们失败了，因为我们不知道钦点的是啥，如果进一步钦点奇偶性复杂度就上天了。

考虑使用gf。一个固定E类idea的题的ogf是$$2^kz$$，那么一个出现偶数次的题是$$F_e=\frac{1}{1-4^kz^2}$$，奇数次是$$F_o=\frac{z}{1-4^kz^2}$$。然后如果可以相同，答案就是$$[z^m]F_e^{o_{ez}}F_o^{n-k-o_{ez}}$$。

-----

uoj697 候选队互测2022 广为人知题



-----

luogu7897 Ynoi2006 spxmcq

看起来是不是很简单啊（

写一个dp，$$dp(u)=a_u+\sum\limits_{v\in\mathrm{ch}(u)}\max(0,dp(v))$$。

注意到这个$$dp(u)$$是$$\mathrm{size}(u)$$段的函数，于是我们不是很好求它。

ddp，在静态lct上用ktt的trick。可能做完了，也可能直接假飞了（

考虑点正常做法。你发现因为它有$$\mathrm{size}$$段，所以我们必须用一些可持久化的数据结构来搞。考虑线段树合并，差分之后每个差分是一段区间，我们直接做这个dp，然后每一次二分出极长前缀$$0$$，线段树合并拍起来，看起来离线的话空间常数可以小一些，也可以尝试无敌splay或者直接用你最喜欢的平衡树。

考虑另一个正常做法。这个段数很多，但是切换次数实际上只有$$O(n)$$，也就是每个点在父亲处计算的时候是选它还是选$$0$$。用树剖维护一下，支持查下一次切换，并且在切换的时候支持往上走做链加就行了。

然后这个链加很难受，我们扔掉树剖

-----

uoj705 黄忠庆功宴

考虑如果是序列，经典做法就是根号分治。现在不是序列了要怎么办呢?

比根号小的可以预处理，注意这里查询是$$O(1)$$的。比根号大的也可以预处理，注意到比根号大意味着会快速转圈圈，然后每转一圈就是平移了一下，这说明这个可以拆成根号个不在膜意义下的等差数列。如果这个公差，也就是转一圈的平移量比根号小，那就做完了，然后感性理解一下这个还挺对的。所以就做完了。

-----

xtq的集训队论文的结论

有一个随机数生成器，它的期望是$$x$$，方差是$$\sigma^2$$，那么我们随机$$n$$次取平均值来求它的期望，误差的期望是$$\Theta(\frac{\sigma^2}{\sqrt{n}})$$。

一个推论是数轴上的随机游走。期望是$$0$$，方差是$$2$$，所以走$$n$$次误差的期望是$$\Theta(\frac{1}{\sqrt{n}})$$，所以和是$$\Theta(\sqrt{n})$$。

## 模拟赛

AB还是没意思。

C. race

原题可能并没有。

未知排列，你每次可以问交互库三个数两两的大小关系，求这个排列。$$n\leq 10^6$$，$$10^7$$次查询。

爆力是三路归并，随机打乱。

发现我们有很多信息没有用到。

whq的做法是卡一卡。

四路归并。第一次需要多比较一次，但是此后每一次比较中，上一次比较的时候最大的那个总是不会成为新的最小值，于是只需要比较另外三个。比较次数大约是$$n\log_4 n$$(归并自带一个$$-n$$)，卡的很准。

## 模拟赛

有两场，但是牛逼的lxl搬的是一样的题。由于我们有同时打了两场的wyx，lxl说会补一场/se

B

树，给出$$m$$条链，每条链有一个权值，对于每条边求不经过它的链的权值$$\mathrm{mex}$$。$$n\leq 5\times 10^5,m\leq 2\times 10^6$$，3s。

必须提醒自己枚举扫描线方向/fn，想了一年被群友一句枚举答案点醒了。

枚举答案，那么如果一条边的答案是$$x$$，需要边权是$$0$$的链不都经过它，边权是$$1$$的链不都经过它，......，边权是$$x-1$$的链不都经过它。然后 都经过它 是链交，把交出来这条链推掉就行了。使用四毛子lca和并查集支持推平链，复杂度$$O((n+m)\alpha(n))$$。

但是我没有链交板子，现在已经收录了（

然而它好像错了?明天调一调。

C

两个序列$$a,b$$，一开始$$b$$全是$$0$$，有$$m$$次操作，每次把$$a$$的一个区间$$l_1,r_1$$加到$$b$$的一个等长区间$$l_2,r_2$$上，求最后的$$b$$。$$a_i\leq 1000,n\leq 10^5,m\leq 10^6$$，3s。

我完全不会。

分块法法塔。转化成线代问题之后，容易想到用法法塔解决，但是由于区间种类太多所以不好法法塔。分块之后只需要处理一块加到一个区间的情况，只有$$O(n\sqrt{n})$$种，于是可以大力法法塔。复杂度平衡一下好像是$$O(\sqrt{n^2m\log n})$$。

## 构造

2022-02-12

-----

膜和xor

如果$$n$$是任意数，经常用到膜，如果$$n$$和$$2^k$$很有关，经常用到xor。能不能用看起来并不好直接判定，只能试一试。

-----

未知来源题，但是感觉见过?

构造三个$$0,...,n-1$$排列$$a,b,c$$，使得$$a_i+b_i\equiv c_i\pmod{n}$$。

考虑如果$$n$$是奇数，我们直接构造$$a=b=0,1,2,...,n-1$$。

考虑如果$$n$$是偶数，此时问题是只能膜出所有的偶数。转一下变成$$a=0,1,2,...,n-1,b=1,2,3,...,n-1,0$$。然后你发现死了。

考虑是不是无解，发现$$a,b$$所有数的和是$$n(n-1)$$，而$$c$$是$$\frac{1}{2}n(n-1)$$，两边膜$$n$$不同，于是必然无解。

-----

全都是未知来源题

$$2^n-1$$个点的完全图，找到尽可能多的三元环，使得它们两两没有公共边。

一共有$$\frac{(2^n-1)(2^n-2)}{2}=(2^{n-1}-1)(2^n-1)$$条边。猜测答案可以达到上界，然后考虑如何构造。

考虑一个强行想法，如果$$3\mid 2^n-1$$，也就是说$$n$$是偶数，我们把点分成三部分，然后枚举三部分之间的三元环，然后考虑三部分内部的三元环。递归下去，我们会得到形如$$a(2^n\pm 1)$$的子问题，看起来这个不好处理。

考虑一个正解做法，如果三个点xor和是$$0$$，那么我们就选它。考虑一下你发现这个显然不重，并且算一算真的就达到上界了。

-----

$$2n$$个点的完全图，把边集分成$$2n-1$$个大小为$$n$$的匹配。

我们自然希望这个匹配的形式看起来好一些。考虑我们把这些点摆在一个环上，很容易想到第$$i$$轮$$+i$$之类的转一圈做法，然后这个假了，因为可能会出现奇环。

换个方向，考虑先满足 一条边只出现一次，我们让一条边$$(u,v)$$在$$u+v\bmod{2n-1}$$轮出现(从$$0$$开始标号)，然后你发现这个不一定是匹配，因为点$$0$$和$$2n-1$$是一样的(从$$0$$开始标号)。

那么我们需要干掉其中一个。cbj之言可谓切中了肯綮，让前面这么连，而$$2n-1$$去连剩下的那个点(由于$$2n-1$$是奇数，必然剩下一个点)。

-----

归纳

-----

$$n$$个点的完全图，选出尽可能多的边不交的生成树。

考虑直接做。我们进行归纳，假设已经构造了$$n$$，我们考虑$$n+2$$。给每棵生成树塞入这两个新点，然后从两个新点向所有点连边得到一棵新树。

-----

nflspc #2 C

$$n\times n$$的矩阵，每个格子有一个字符，如果一行三个连续字符分别是key，那么就称为一个key。你每次可以把一行向右循环移位，或者一列向下循环移位，最大化key的数量。$$n\leq 40$$，你只能操作$$10^4$$次。

考虑如果一开始有一个k,e,y数量分别是满的但是乱序的矩阵，我们怎么把它们全搞成key。可以考虑一行一行处理，或者一列一列处理，如果最后有空行或者空列就很简单，否则也就是$$3\mid n$$的情况。

考虑这个怎么做。注意到最后三列必然可以搞成，要么全都是key，要么全都不是key，也就是如果足够填满最后三列就填满，不够就填到前面去，最后三列全部留空。而前面的列可以随意搞成你的任何目标，所以就结束了。

呃还没结束。如果$$n=3$$怎么办?搜。

-----

给一个整数矩阵，把它分解成$$A=QDP$$，其中$$Q,P$$是可逆整数矩阵，并且它们的逆也是整数矩阵；$$D$$是对角矩阵，并且$$D_{i,i}$$可以整除$$D_{i+1,i+1}$$。不用管高精。

注意到初等变换的逆也是初等变换，而初等变换看起来几乎是整数。现在问题是，你可以把一行乘上整数倍加到另一行，一列乘上整数倍加到另一列，要把它消成对角矩阵。这个看起来很经典，辗转相除就行了。

那么这个每一项整除前一项怎么搞?我们消成对角矩阵之后，还可以继续做一些操作，考虑我们把$$D_{1,1}$$搞成$$\gcd$$，那么剩下的就都搞定了。但是怎么搞成$$\gcd$$呢?直接做就行了。

多元exgcd等价于excrt。

-----

nflspc #3 G

平面上有$$n$$个蓝点，三点不共线，你需要放一些红点，使得每个蓝点组成的三角形内部(不包括边上)都有一个红点，最小化$$k$$。

如果是凸多边形，猜测$$k=n-2$$。

一个$$k=2n$$的构造比较牛逼，考虑在每个点左右eps处各放一个点，实现中看起来要随机一个角度，因为可能有和x轴平行的边。

注意到凸包外面的点没有用。注意到这外面恰好有$$n+2$$个点(多出来的两个在最上面和最下面)，所以对于凸多边形我们达到了下界。

如果不是凸多边形，我们猜测这个也是对的，也就是说如果凸包上有$$c$$个点，那么答案至少是$$2n-c-2=2(n-c)+c-2$$。如何证明?考虑选出一些不交的三角形，每个三角形必须有一个点。先把凸包三角剖分，此时答案至少是$$c-2$$，然后凸包外还有$$n-c$$个点，每个加到三角剖分中会产生两个三角形，所以答案至少是$$2n-c-2$$。

看起来还是非常的强啊/se

-----

操作可逆

如果你需要通过一些操作把一个转化成另一个，那么可以构造一个中间状态，把它俩都搞到中间，然后根据操作可逆搞回去。

-----

给一个环，每个点有rgb之一的颜色，如果一个点相邻两个点颜色不同，你就可以随意改变这个点的颜色，构造方案把$$s$$变成$$t$$，或者断言不可能。$$5\leq n\leq 10^5$$，你有$$10n$$次操作。

考虑这个操作确实是可逆的，因为倒着操作回去就行了。

考虑我们把它俩都操作成什么东西比较好。简单想法是rggggggggggggggggg，rgbrgbrgbrgbrgbrgb，rgrgrgrgrgrgrgrgrg这样的。显然是第一个比较有希望。

考虑我们直接先随便找一个可以操作的位置，然后把它改成和两边的两边不一样的，比如abcde，c可以操作，我们就把它改成和ae不一样的，这样的bd也可以操作了。每次操作之后不能操作的位置都会减少，并且只要存在位置不能操作，那么就一定存在旁边的位置可以操作，于是这就使得每个位置都能操作了。然后直接搞就行了。

-----

给一个$$n\times m$$的矩阵$$A$$，构造一个矩阵$$B$$，使得$$A_{i,j}=\sum\limits_k B_{i,k}+\sum\limits_k B_{k,j}-B_{i,j}$$。

考虑$$\sum\limits_{i,j} A_{i,j}$$，每个$$B_{i,j}$$被算了$$n+m-1$$次(好像是?)，所以我们得到$$B$$的总和，设为$$s$$。

考虑$$\sum\limits_i A_{i,j}=s+(m-1)\sum\limits_i B_{i,j}$$，于是我们得到了$$B$$每一行的和。同理也得到了$$B$$每一列的和。然后直接算就行了。

-----

$$n$$个点的简单无向图，你每次可以问 一棵$$n$$个点的完全图的生成树 和这个无向图的交的边数，求出这张图。$$n\leq 500,m\leq 2000$$，你有$$2\times 10^4$$次询问。

考虑我们能问出啥。

使用菊花可以问一个点的度数。

考虑在一个点的邻边中二分，问题是我们怎么处理 问一个点到一个编号区间有没有边，难度在于我们每次都要问一个生成树。

如果我们有一个生成树，知道它上面每条边是有还是没有，那么这个就很好做了，也就是把我们要问的点连一连，减去少掉的就行了。现在问题变成$$m\leq n$$。

考虑一个想法，我们拿着$$1,...,n,1$$这个环，然后问一圈，每条边被问了$$n-1$$次，于是我们知道环的总和，于是我们也知道环上每条边的状态了。做完了。

-----

寻找不变量

-----

$$n\times m$$的矩阵，你每次可以选择给一行加上一个整数，或给一列加上一个整数，或给一条主对角线加上一个整数，这里不一定$$n=m$$所以主对角线可能不止一条。把整个矩阵变成$$0$$，或断言无解。$$n,m\leq 1000$$，有$$6000$$次操作。

考虑只要有解就显然可以操作出来。

考虑一个牛逼想法，我们差分一下，设$$b_{i,j}=a_{i,j}-a_{i-1,j}-a_{i,j-1}+a_{i-1,j-1}$$，那么行列每次操作只改变$$b$$的$$O(1)$$个位置，而对角线操作会改变三条对角线。考虑我们先差分，处理完边角，此时每条对角线应该几乎是一样的，然后再把每条对角线搞定，就做完了。

官方做法更为强大。强行构造，设$$b_{i,j}=a_{i-1,j}-a_{i+1,j}+a_{i,j-1}-a_{i,j+1}+a_{i-1,j-1}-a_{i+1,j+1}$$，那么行列和对角线每次操作都只改变$$b$$的$$O(1)$$个位置。做完了。

-----

某胡策题

序列，有若干个条件，每个表示某三个位置的中位数是$$m$$，构造一个满足条件的序列。$$n\leq 10^5$$。

中位数居然可以转成2-sat。考虑中位数是十二个条件，也就是如果一个比中位数小，剩下两个不比中位数小；如果一个比中位数大，剩下两个不比中位数大。2-sat即可。

-----

未知来源题

给一个$$1,...,n(n+1)$$的排列，求一个长$$2n$$的子序列，使得其中第$$2k$$大和第$$2k-1$$大的数，在序列中是相邻的。

把序列分成$$n$$块，每一块大小都是$$n+1$$。考虑

-----

cf1365g

集合，你每次可以问一个子集的or，求出独立地删掉每一个数之后整个集合的or。$$n\leq 1000$$，你可以问$$13$$次。

or是可以合并的。所以我们可以对每个位问取0和取1的答案，然后合并。这需要20次。

考虑怎么砍这7次。我们强行修改这个做法，我们让每个数的编号是13位，然后一个牛逼的想法是，我们固定1的个数，此时就不存在一个编号是另一个编号的真子集，就只需要问每一位取1的答案了。显然固定1的个数为$$6,7$$时最优，有$$\binom{13}{6}=1716$$，看起来是足够的。