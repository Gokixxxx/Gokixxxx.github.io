---
layout: post
title: Cost Scaling
subtitle: uoj屠榜算法
tags: 图论 网络流
---

以下默认我们做的是最小费用循环流。$$C,U$$分别指费用和流量的值域。

网上找了一堆东西，最后找到了原论文，Finding Minimum-Cost Circulations by Successive Approximation，可以在[这里](https://apps.dtic.mil/sti/pdfs/ADA194028.pdf)看到。

### 定义和简单推论

定义一个循环网络是说每条边有一个容量$$u(v,w)$$和**整数**费用$$c(v,w)$$，$$v\rightarrow w$$的流量$$f(v,w)$$/费用和$$w\rightarrow v$$的流量/费用是相反数。

伪流是可以不流量平衡的流，一个点的超额流$$e(v)$$是它所有出边流量之和，称超额流为正的点是溢出的，循环流是所有点超额流都为$$0$$的伪流。

循环流的费用是所有边流量乘费用，加起来除以$$2$$，这个除以$$2$$是因为每个流算了两遍。

定义一个环的费用是环上所有边的费用和，平均费用是费用除以长度。

给每个点定义势能(price function)$$p(u)$$。定义边$$(u,v)$$的reduced cost(试译为 简化费用?)是$$c_p(u,v)=c(u,v)-p(u)+p(v)$$。容易知道使用$$c$$和$$c_p$$不影响最小费用循环流，所以以下如果没有特殊说明或者懂的都懂，说的都是简化费用。

**定理1** 一个循环流是最优的(最小费用的)，当且仅当不存在残存的负环。

**证明** 废话。

当然最小费用循环流的增广指的是找到负环然后在上面转圈。

**定理2** 一个循环流是最优的，当且仅当存在一组势能$$p$$，使得对于任意边$$v,w$$，有

$$
c_p(v,w)<0\Rightarrow f(v,w)=u(v,w)
$$

。

**证明** 充分性显然，因为不再有残存的负环，我们不可能再增广了。你说有没有可能走了正环?那在这个环上退流就是负的费用。正环和负环是对应的。

必要性也显然，因为最小费用了，那么没有残存的负环，我们按照Johnson取最短路来作为$$p$$就好了。好像有更快的方法，不过没大问题。

定义一个伪流是$$\epsilon$$最优的，当且仅当存在一组势能$$p$$，使得对于任意边$$v,w$$，有

$$
c_p(v,w)<-\epsilon\Rightarrow f(v,w)=u(v,w)
$$

。

**定理3** 一个循环流是$$\frac{1}{n}$$最优的，那么它就是最优的。

**证明** 考虑任意一个环的费用一定$$>-1$$，而因为费用是整数，这个环的费用肯定$$\geq 0$$。

容易知道，任意一个循环流都是$$C$$最优的，所以如果我们每轮把$$\epsilon$$缩小一半，$$\log(nC)$$轮之后就会得到答案。

### refine

refine是cost scaling的核心。它接受一组$$\epsilon,f,p$$，其中$$f$$是$$\epsilon$$最优的，$$p$$给出了此时的势能，它将$$\epsilon$$除以$$2$$，计算一组$$\epsilon$$最优的$$f,p$$。

首先假设你会push-relabel，但是这里的push-relabel不太一样，所以你不会也行。

定义$$\mathrm{push}(v,w)$$说的是，对于一个溢出点$$v$$和负边$$(v,w)$$，把它的超额流沿着$$(v,w)$$尽可能多地推给点$$w$$。

定义$$\mathrm{relabel}(v)$$说的是，对于一个没有负出边的溢出点$$v$$，把它的势能抬高使得现在有至少一条负出边，这个负出边的费用应该是$$-\epsilon$$。

我们称一次push是饱和的(saturating)，当且仅当它把一条边充满了。

**引理1** 一个溢出点要么可以push，要么可以relabel。

**证明** 废话。

**引理2** push不改变$$\epsilon$$最优性。

**证明** 显然。

****