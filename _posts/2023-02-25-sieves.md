---
layout: post
title: 重写筛子
subtitle: 怄火。
tags: 数学 数论
show: true
---

-----

dgf

可能可以用来判断我们需要什么筛子。

-----

线性积性函数狄利克雷卷积

爆力卷出素数幂处的值，然后线筛所有的值，复杂度就是线性。也就是$\sum\limits_{p\leq n}\log_p^2 n=O(n)$。

-----

轮子筛

可以在$O(\frac{n}{\log\log n})$内筛出前$n$个素数。

考虑我们取前$k$个素数，设它们的乘积是$L$，那么$n$和$n+L$是否被这$k$个素数整除的情况是相同的，所以我们考虑把$kL+1,...,(k+1)L$作为一段处理，这看起来就像用一个长$L$的轮子滚过数轴。

取最大的$k$使得$L\leq\sqrt{n}$，素数定理分析一下可以知道$k$是$\Theta(\log n)$的。

mertens定理指出这$L$个数里面有$O(\frac{L}{\log k})$个数不被前$k$个素数整除，也就是说我们一共有$O(\frac{n}{\log k})=O(\frac{n}{\log\log n})$个数还没被筛掉。

这些还没筛掉的数就是所有最小素因数在$k+1$个及以后的素数。我们只用$k+1$及以后的素数，在这些数里面跑一个线筛，复杂度就是$O(\frac{n}{\log\log n})$。在word-ram下直接压位复杂度就是对的。

-----

杜教筛

懒得写了（

-----

powerful numbers

现在要求积性函数$f$的前缀和$S_f(n)$，我们找一个$g$使得它积性，并且在素数处和$f$取值相同。那么我们知道$\frac{f}{g}$也是积性的，这里除法是狄利克雷卷积的逆，并且它在素数处全$0$，因此它仅在powerful numbers处非$0$。而powerful numbers只有$O(\sqrt{n})$个。通过拆式子我们可以得到，只要求出$\frac{f}{g}$在powerful numberes处的值和$g$的基本和组，就可以$O(\sqrt{n})$地求$f$的前缀和。

求$\frac{f}{g}$在powerful numberes处的值，如果可以快速求$f,g$在素数幂处的值，爆力卷起来复杂度就是$O(\frac{\sqrt{n}}{\log n})$。

求基本和组的话，按$\Theta(n^\frac{2}{3})$根号分治。

-----

$\mu^2$

可以注意到$\mu^2$的dgf是$\frac{\zeta(z)}{\zeta(2z)}$。考虑$\frac{1}{\zeta(2z)}$是个什么东西，它就是$\zeta(2z)=\sum\limits_i\frac{1}{(i^2)^z}$的逆，$\zeta(2z)$只在完全平方数处有值，那么由于完全平方数乘非完全平方数还是非完全平方数，$\frac{1}{\zeta(2z)}$它也只在完全平方数处有值，所以使用powerful numbers的时候可以在完全平方数上整除分块一下做到$O(\sqrt{n})-O(n^\frac{1}{3})$。

-----

Min_25筛

现在要求$S_f(n)=\sum\limits_{i=1}^n f(i)$，首先$f$得是个积性的。考虑如果$f$是积性的我们可以干啥，我们枚举$i$的最小素因数和次数，把它提出来，然后递归剩下的。设$\operatorname{minp}(n)$为$n$的最小素因数，$p_i$是第$i$个素数，$S(n,k)$为$\sum\limits_{i=2,\operatorname{minp}(i)>p_k}^n f(i)$，也就是说不考虑$1$，那么我们要求$S(n,0)$。

这里比较牛逼的是这么一个剪枝，注意到经典的，筛到根号我们总会剩下且只剩下一堆素数，此时每次枚举只能再筛掉一个数了。那么如果可以求出只考虑素数的前缀和，可能就可以极大地加速了。假设我们求出了只考虑素数的前缀和$g$，那么筛到根号先，我们有

$$
S(n,k)=g(n)-g(K)+\sum_{k<i\leq\pi(K)}\sum_e f(p_i^e)\left(S(\lfloor\frac{n}{p_i^e}\rfloor,i)+[e>1]\right)
$$

这里$K$是根号，$+[e>1]$是因为$S$不考虑$1$，而$e=1$已经在$g$中算过了。显然第一维只会递归到基本和组，$k>K$则和$=K$没有区别，于是积一下我们知道状态数是$O(\frac{n^\frac{3}{4}}{\log n})$，如果记忆化的话类似于powerful numbers里面的某个分析复杂度也是这个，这就是洲阁筛了。如果不记忆化，可以根据1e14以内的什么性质证明它在1e14以内是$O(\frac{n^\frac{3}{4}}{\log n})$的，并且跑的比记忆化还快。懒得看啦（

那么问题是怎么求$g$。这里如果存在一个完全积性函数$t$和$f$在素数处完全相同，有一个$O(\frac{n^\frac{3}{4}}{\log n})$的方法。在埃筛上dp，设$g(k,n)$表示拿前$k$个素数筛过了，剩下的答案，或者说素数和最小素因数$>p_k$的合数的$t$的和，那么转移的时候我们用当前这个素数筛所有最小素因数为$k$的数，这些数就是$k$的倍数中最小素因数$\geq k$的数，那么它们的$t$之和就是$t(p_k)\left(g(k-1,\lfloor\frac{n}{k}\rfloor)-\sum\limits_{p<p_k}t(p)\right)$。后面那个可以预处理，这就赢啦。

