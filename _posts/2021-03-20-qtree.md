---
layout: post
title: Qtree系列做题记录
subtitle: 今天也是个压行小能手呢
tags: 数据结构 树 lct 线段树
---

Qtree1

直接树剖。

Qtree2

直接树剖。

Qtree3

直接树剖。

Qtree4

这题就是白点的虚树的直径，看到直径考虑线段树维护，然后就做完了。复杂度$$O(n\log n)$$。

这个重要结论是，要合并两个点集的直径，只需要考虑两边直径的四个端点连出来的情况即可。

Qtree5

考虑使用lct，容易想到每次查询都`make_root`一下，但是发现深度变化不好处理，于是转而考虑公式$$\mathrm{dis}(u,v)=\mathrm{dep}(u)+\mathrm{dep}(v)-2\mathrm{dep}(\mathrm{lca}(u,v))$$。

发现`access(u)`之后所有可能的$$\mathrm{lca}(u,v)$$都和$$u$$在同一条链里面，当然这个结论反过来也成立。所以考虑每个点$$\mathrm{lca}$$维护虚子树中的$$\max(\mathrm{dep}(v))$$，减去$$2\mathrm{dep}(\mathrm{lca})$$之后作为点权，然后我们就可以给点权取$$\max$$得到答案了。复杂度$$O(n\log^2 n)$$。

Qtree6

经典!

这题就是求同色连通块大小，容易想到对黑白分别建lct。考虑翻转一个点的颜色，在菊花上复杂度会爆，因为一个点有很多连边。

考虑我们不维护点而维护边的连通性，每条边位于它下面端点的连通块里面，这样一个连通块的点数就是lct上的点数-1，并且每次翻转也只需要考虑父亲，容易维护。复杂度$$O(n\log n)$$。

Qtree7

连通块max，沿用6的做法即可，复杂度$$O(n\log^2 n)$$。注意为了避免

