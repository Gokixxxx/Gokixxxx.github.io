---
layout: post
title: CF思维题选㗅
subtitle: 不想上GM的Newbie不是好Newbie
tags: 思维 题选做
---

再开一个坑，整合各种各样的思维题。放学了，先咕咕咕。

-----

1495F : 好奇妙!我以为我开了一道2600，其实是一道3300/kk

出题人思维能力好强啊，我要膜拜出题人，不过官方题解写的好简单/kk

我们将第一种走法称为 一小步 ，第二种是 一大步 。

考虑这个$$p$$相当于一个高度，走一大步就是往右上方第一个点走。

我们发现，"一大步能走到"具有传递性，"一大步走不到"也具有传递性。也就是说如果$$i<j<k$$满足$$i$$走不到$$j$$，$$j$$走不到$$k$$，那么就有$$p_i>p_j>p_k$$，所以$$i$$也走不到$$k$$。

考虑一棵树，每个点$$i$$连向它左边第一个一大步走不到它的结点$$j$$，如果没有这样的$$j$$则连向$$0$$。由于"一大步走不到"的传递性，我们站在点$$i$$走一大步，将会跨过子树里的所有点。

接下来是四个人类可读的定理，稍微有点绕，请耐心读完。

-----

**定理1** 每个点$$i$$的子树里面编号一定是一个从$$i+1$$开始的区间。

**证明** 考虑每个点$$i$$子树里面的点都是它右下方的点，那么按编号走，走到的第一个子树外的点一定在这个点右上方，不然它应该还在$$i$$这个点子树里面。

考虑如果不是一个区间，那么一定存在一个位置$$j$$使得它前面一直到$$i$$全是子树内的点，后面还有子树内的点，而它自己是子树外的点。

那么我们知道一定有$$p_i<p_j$$，那么假设后面有个点$$k$$在$$i$$的子树里，我们知道$$p_i>p_k$$，所以$$p_j>p_k$$，所以$$k$$应该先连向$$j$$。

-----

**定理2** 如果一个点$$i$$有儿子，那么一定有$$i+1$$这个儿子。

**证明** 如果没有$$i+1$$这个儿子，父亲的编号还要比儿子大，那么$$i+1$$就不可能在子树中，而子树还要是$$i+1$$开始的区间，那么就没有子树，也就没有儿子了。

-----

**定理3** 走一小步是dfs树的过程。

**证明** 归纳法。考虑点$$0$$，我们假设它有$$k$$个儿子，每个的子树分别是$$[1,t_1],[t_1+1,t_2],...,[t_{k-1}+1,n]$$，那么我们知道一棵子树的最后一个点$$t_i$$走一小步之后一定会进入下一棵子树，所以从$$0$$的视角看是进行了dfs，那么根据dfs的递归性质可以知道每个点看来都在dfs。

-----

**定理4** 在点$$i$$走一大步，相当于在dfs树的过程中跳过了$$i$$的子树。

**证明** 假设$$i$$的子树是$$[i+1,j]$$，那么我们就是想要证明$$i$$走一大步会走到$$j+1$$。

如果$$i$$不能通过若干一大步走到$$j+1$$，那么$$p_i>p_{j+1}$$，那么$$j+1$$的父亲要么是$$i$$，要么在$$[i+1,j]$$里面，那么$$j+1$$一定在$$i$$的子树里。这是矛盾的，因为跳过子树之后要么走到兄弟要么回溯祖先并走到祖先的兄弟，不可能进入子树。所以$$i$$一定可以通过若干一大步走到$$j+1$$。

而$$i$$又不能一大步走到$$[i+1,j]$$，所以要想通过超过一个大步走到$$j+1$$中间也没有点可以中转，所以$$i$$走一大步一定会走到$$j+1$$。

-----

我们似乎已经对这棵树的结构有了一定了解。

以下开始全是口胡，我没有实现过，不知道正确性。

如果建立超级根$$-1$$，认为游戏结束是走到$$n+1$$，从$$-1$$向$$0$$和$$n+1$$连边，那么问题已经变成了，有一棵树，现在你要遍历这棵树，走一小步可以按照dfs序走到下一个结点，走一大步可以直接跳过整棵子树，有一些点必须走到，求走完的最小代价。当然$$-1$$和$$0$$号点走一大步的代价是$$+\infty$$，这三个点别的代价都是$$0$$。

我们考虑如果一个点需要被走到，它所有祖先都不能选择跳过子树。所以每次加入/删除一个点，相当于把到根的链全部+1/-1，要求所有值为正的点必须选一小步，别的点可以选一大步。

我们设一个dp。令$$f(u)$$表示从$$u$$点出发走一小步，走完子树的最小代价；$$dp(u)$$则允许第一步随便走。那么我们有

$$
\begin{aligned}
f(u)&=\sum_{v\in\mathrm{son}(u)}dp(v)\\
dp(u)&=\min(f_u,b_u)
\end{aligned}
$$

那么你发现，如果强制要求$$u$$走一小步，那么$$\mathrm{fa}(u)$$开始走完子树的代价应该是$$f(\mathrm{fa}(u))+f(u)-dp(u)$$。

如果强制要求$$u$$的一堆儿子$$v_1,...,v_m$$走一小步，那么$$u$$开始走完子树的代价应该是$$f(u)+\sum_{i=1}^m(f(v_i)-dp(v_i))$$。

你发现这个东西相当于每次加入一个结点，然后处理到根一条链上代价的变化，并且转移是ddp的形式，所以我们可以拍个板子搞定它。

-----

这个题好爽啊，我都不舍得换题了（

下面就是筛选2600+，constructive algorithms，并且按照通过人数降序做的了。

-----

741C : 