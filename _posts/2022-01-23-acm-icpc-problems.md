---
layout: post
title: acm/icpc题选做
subtitle: /kk
tags: 题选做
show: true
---

很久之前就想开这个坑了（

计划写hdu多校，ptz营，以及open cup。这三个感觉上难度是递增的吗（

区域赛啥的先咕了，太多了不知道先做哪些（

## hdu多校

这些题可以在vj上看到题面，但是并不能提交。讲道理胡题可以锻炼思维的精确度，也就是说你想出来基本是对的?（狡辩

### 2009

刚开始做你会觉得很水，但是后面几场难度还是有一点的（

#### contest1

A. A sequence of numbers

签到题。如果是等差数列，那么两个差分是一样的，否则必然不一样。

B. Building Block

签到题。并查集。

C. Swap

不需要最小化步数/jy

考虑从行来看，每一行的内容不变，它们只是被换来换去，并且在列上重排了而已。那么如果某一行没有1，或者某一列没有1，必然完蛋了。

否则，我们可以考虑找到一个列的排列$$p$$，使得$$i$$行$$p_i$$列都是1，那么只需要按照$$p$$的逆来换就行了。可是这个只做了列的交换。为了证明必要性(或者你会认为它是充分性?)，我们考虑如果现在同时允许行列的交换，得到了一个对角线的1，那么我们换两行，再换它们对应的两列，对角线上还是全是1。同时显然行列的交换是独立的，那么我们这样就可以用列的交换代替行的交换。

那么接下来问题就很简单了，我们只需要在这里面找一个排列。但是想了想发现这个问题并不是很简单（

建一个图，有$$n$$个数，每行连到它有的数，那么这就是一个匹配。跑网络流即可。

D. Permutation

状压dp。

E. Pusher

这个游戏好像已经因为flash player的退休而退出历史舞台了/ll

完全没看懂题。据说搜就行了，那就搜就行了吧。

F. Dogs

01bfs。

G. The widest road

求出两边的凸壳，然后如果有交那就完蛋了，否则双指针卡一卡。

H. The Euler function

签到题，直接线筛。那个时候毒假筛还没普及吗?

I. Wireless password

先建一个acam再说。然后你发现直接dp就行了，那么为什么这个题数据范围这么小?

#### contest2

A. The troubles of lmy

我们先找到一个具有某种特征的边，比如最短的，然后把它们对齐即可。

B. The Evaluation of Determinant

板子。为什么hdu多校还有板子?可能这是上古场所以很水吧（

C. Lamp

这个看起来是要挑战npc。

然后又读了一遍题，你发现一个开关最多可以控制两个灯，也就是说一个开关只会在两个灯的表达式中出现。但是这还不是一个2-sat。

考虑建个图，容易想到灯是点而开关是边。如果一个开关只控制一个灯，那么可以把这个开关和这个灯直接删掉，此时与这个灯相连的别的开关也只控制一个灯了，最后整个连通块都会删掉，也就是说如果一个连通块有一个开关只控制一个灯那就赢麻了。

然后容易想到猜测连通块边数够的时候总是不会出问题。考虑边数够就必然有环，我们保留一个环，从环出发找随便一棵dfs树，然后把树的部分删一度点删空，环上的就转一圈即可。所以只有连通块是一棵树的时候会无解。

D. Lawrence

直接dp就过了。

这看起来很凸，于是可以尝试wqs二分之后斜率优化。但是我懒得试（

E. Matrix Swapping II

这会只能交换两列了。看起来好像更困难了（

我们枚举一个行的区间，然后求出有多少列包含这个行的区间，把它们换到一起就彳亍了。枚举区间的一个端点，这个东西是关于另一个端点单调的，于是我们直接扫过去就行了。

F. Plants VS Zombies

让我想起一个经典牛逼题（

签到题，直接贪就行了。

G. Snail’s trouble

如果你看过具体数学的哪怕一点，就可以开始猜答案了（

实际上好像打表即可。

H. WuKong

交的肯定是连续的一段，于是枚举这一段，然后看它是不是有可能在最短路上，跑四遍Dij即可。

I. Girl Friend II

直接dp。难度在于读题。

#### contest3

A. Operating system

经典问题。贪心踢掉下一次出现最晚的即可。

B. Traversal

线段树优化dp。

C. Calculation

快速幂。

D. Cow Sorting

注意到交换对两个牛是独立的，也就是说它们的贡献可以拆开，并且冒泡排序对每个元素都达到了交换次数下界，于是直接BiT求每个数被换了多少次即可。

E. Game

看起来它是越改越小了。

每个位置是独立的。

考虑能否直接把它变成nim。然而这是一个不平等博弈。

不过没有关系，你发现数的大小只有区区$$15$$，于是我们可以直接爆力搞出状态之间的转移。然后怎么才能合并这些堆?看起来sg定理在这里不起作用，于是我们尝试使用超现实数。看起来我需要尝试复习超现实数?

以前尝试过写超现实数入门，但是失败了。现在就去写/fn

这题有两个人交了，全wa了，网上还没有题解/jy

F. Self-Replicating Numbers

如果是输出所有的，那看来个数非常少。

考虑这个写个式子就是$$x^2\bmod{b^n}=x$$，那么也就是$$x(x-1)\bmod{b^n}=0\Leftrightarrow b^n\mid x(x-1)$$，那么$$x,x-1$$中$$b$$的幂次应该足够多($$0$$包含每个素数的任意次)。注意到如果$$p\mid x$$，那么必然有$$p\not\mid x-1$$，于是我们枚举$$b$$的每个素因子出现在$$x$$还是$$x-1$$中，然后上一个crt即可。比如样例中有$$2^4\mid 9376,5^4\mid 9375$$。

考虑了一下最后crt出来是膜$$b^n$$，所以每种情况下只有一个解，最后解的个数有上界$$2^{\omega(b)}$$。

G. Visible Trees

能看到等价于互质，直接莫反。

H. Chinese Rings

考虑这个式子会是什么。设答案是$$f(n)$$。

首先我们肯定要拿下第$$n$$个环，于是我们必然需要让$$n-1$$在上面，而$$1,...,n-2$$全都拿掉了。这是$$f(n-2)$$。

拿完第$$n$$个之后，只剩下$$n-1$$在上面，这个我们设只拿下$$n-1$$的步数是$$g(n-1)$$。答案是$$f(n)=f(n-2)+g(n-1)+1$$。

考虑$$g(n)$$，我们要把$$n-1$$放上去，然后把$$n$$拿下来，然后把$$n-1$$拿下来。为了把$$n-1$$放上去，我们需要把$$n-2$$放上去，然后把$$n-1$$放上去，然后把$$n-2$$拿下来。为了把$$n-1$$拿下来，看起来这是一样的，于是有$$g(n)=2g(n-1)+1$$。矩阵快速幂即可。

然后据说它等价于$$f(n)=f(n-1)+2f(n-2)+1$$。

I. I Will Win

一眼看上去像是签到题?

然而会让人有点迷惑，因为考虑0 0(但是实际上0 0不会出现，它表示结束)，就可以把很多猜的结论hack掉了。于是还是得强行计算。

<span style="color:rgb(153,217,234);">两人分别赢了$a,b$场下胜率是$p$的概率</span>应该与<span style="color:rgb(255,174,201);">胜率是$p$下两人分别赢$a,b$场的概率</span>成正比，那么根据二项分布，这个概率是$$\binom{a+b}{a}p^a(1-p)^b$$，而$$\binom{a+b}{a}$$是常数，于是胜率是$$p$$的概率就是$$\displaystyle\frac{p^a(1-p)^b}{\int_0^1 x^a(1-x)^b\ \mathrm{d}x}$$，于是答案就是$$\displaystyle\frac{\int_0^1 p^{a+1}(1-p)^{b}\ \mathrm{d}p}{\int_0^1 x^a(1-x)^b\ \mathrm{d}x}$$。这里随便找了一个$$x$$当变量名?

这俩积分咋算?扔进wolfram alpha(然而它比较拉，得把两个积分分开算再合起来，不然跑不出来)，然后它就是

$$
\frac{\frac{\Gamma(a+2)\Gamma(b+1)}{\Gamma(a+b+3)}}{\frac{\Gamma(a+1)\Gamma(b+1)}{\Gamma(a+b+2)}}=\frac{\frac{(a+1)!b!}{(a+b+2)!}}{\frac{a!b!}{(a+b+1)!}}=\frac{(a+1)!b!(a+b+1)!}{a!b!(a+b+2)!}=\frac{a+1}{a+b+2}
$$

于是答案就是$$\frac{m+1}{n+2}$$。看起来还是挺优美的?

J. Coins

whuacmers指的是whu的acmer，这个词造的可真是太离谱了（

模板 背包。

#### contest4

A. Beans

直接dp。

B. Repository

直接多串sam。

也可以对查询建acam。

C. Binary String

长度最小，长度相同字典序最小，看起来就是比较这个数的大小。

不过这个没啥用。考虑数位dp，我们dp出最小长度，再从高往低找最小字典序就好了。

D. Number Cutting Game

签到题。

看起来很像是搜。感觉上状态数实在是很少，于是搜应该就行了（

E. For Kisses

在题目的最前面加上一句话 你是一名骨科医生。

直接状压dp即可。想了半天怎么搜（

F. Load Balancing

上来就说这个是np-hard可还行（

讲道理，背包也是np-hard的。

答案在1e6级别，于是spj那个1e3看起来像是根号?也可能只是一个随便加上去的常数。

感觉上直接退火就过了，但是感觉总是会骗人的（

考虑先生成一个很优的解，然后随机调整。我们从大到小加入所有任务，每次把当前这个任务扔到时间最短的机器上。然后我就没有什么想法了（

G. Lode Runner

看不懂题/cy

据说是直接最短路。

H. KiKi's K-Number

set。

I. Assignment

最大权匹配。

#### contest5

A. Central Meridian Number

注意到$$a,b$$都可以对$$n$$取膜，所以打表就行了。

B. Fibonacci Check-up

这个公式看起来很眼熟，我们打个表观察一下它是啥。

打出不爆int的项。

```
1
3
8
21
55
144
377
987
2584
6765
17711
46368
121393
317811
832040
2178309
5702887
14930352
39088169
102334155
267914296
701408733
1836311903
```

扔进oeis，这是$$f(2n)$$，$$f$$是fib数。实际上肉眼也可以看出来。

如何解释?组合意义天地灭，考虑fib数的ogf $$\frac{x}{1-x-x^2}$$，但是这个不能表示对它做那个带组合数系数的前缀和，这需要egf。

关于fib数的egf，我们有微分方程$$F^{\prime\prime}-F^\prime-F=0$$，这个实在是懒得解，我们直接卷上$$e^z$$得到$$e^zF^{\prime\prime}-e^zF^\prime-e^zF=0$$。我们希望把它凑成$$e^zF$$的一个微分方程，也就是说求导的时候都是对$$e^zF$$求导，而不是只对$$F$$求导。

我们先尝试强行做这个事情。

给$$e^zF^{\prime\prime}$$凑一个$$e^zF+2e^zF^\prime$$，我们得到$$(e^zF)^{\prime\prime}-e^zF^\prime-e^zF=e^zF+2e^zF^\prime$$，移项得$$(e^zF)^{\prime\prime}-3e^zF^\prime-2e^zF=0$$。

给$$-3e^zF^\prime$$凑一个$$-3e^zF$$，我们得到$$(e^zF)^{\prime\prime}-3(e^zF)^\prime-2e^zF=-3e^zF$$，化简得$$(e^zF)^{\prime\prime}-3(e^zF)^\prime+e^zF=0$$，于是我们知道它的递归式就是$$a_n=3a_{n-1}-a_{n-2}$$。同时斐波那契数的递归式是$$f_{2n}=f_{2n-1}+f_{2n-2}=2f_{2n-2}+f_{2n-3}=3f_{2n-2}-f_{2n-4}$$，所以它俩确实是一样的。你也可以用这个方法直接推式子（

C. Find Its Place

看起来非常简单，我们爆力给边上的几列强行解方程，然后中间的部分可能的最大行数将会非常小，比如爆力边上10列就可以给中间开十次根号，于是继续爆力即可。

D. Mirror and Light

计算几何/jy

直接做。

E. Oil on the Mars

题意有点不明确，说的大概是，有一个棋盘，你可以选一些连在一起的格子，使得它的边界看起来是单调的，也就是最左边的点到最上面的点看起来是单调的，最上面的点到最右边的点看起来是单调的这样的。

考虑直接dp，设$$dp(i,j,l,r,0/1,0/1)$$表示走到$$i$$行，选了$$j$$个，这一行选了$$[l,r]$$这个区间，左边接下来应该往左/往右，右边接下来应该往右/往左这样的，然后它的复杂度是$$O(n^5)$$，如果感觉空间危险，把$$i$$滚一下变成$$n^4$$就好了。

F. Phalanx

直接dp，可以用二分hash来转移，就$$n^2\log n$$了。

考虑能不能做到$$n^2$$。我们要查询一个行的区间和一个列的区间的lcp，这个看起来很像是z algo做的事情，但是实际上它并不是（

考虑先把所有的行和列拼成一个串，现在问题是有一个串，每次查两个子串的lcp，这个sa就做掉了，使用sais和四毛子st表，复杂度是严格$$O(n^2)$$。

G. Regroup

模板 并查集。

H. Stools

直接dp。

I. The Crazy O2jamer

二分答案，然后问题变成这个过程分成了若干段，你要给每一段分配一些note，然后段之间会爆一个miss。问题在于如何分配good和cool。

打cool和good的顺序区别不是特别大，我们可以钦点每一段先打cool再打good，这样就不会出问题。

贪心地，只有两种可能的方案，也就是把cool尽可能塞在一起，或者平均分配。事实证明塞在一起是对的，感性理解就是cool占一个位置可以得到两倍于good的jam加成。

#### contest6

A. FunnyXEN

看起来还挺有趣的，相当于是说求$$1,...,2n$$在整除意义下的最长反链和不包含于任何最长反链的元素。

然而想了一下还是过分简单。最长反链长度等于最小链覆盖，所以看起来就是选所有的素数了。然后如果一个数包含两个素因子，选了它这两个素数都没法选了，所以它就不能被选，然后$$1$$总是不能被选，然后就是求素数幂个数了，然后这玩意是不是还可以加强到1e11上min25筛（

B. Tree Fence

看起来比A更有趣。

考虑直接对选的桩子dp，也就是从左往右走，记录上凸壳和下凸壳的走向和最右的点，转移需要三角形数点，可以差分成三个 原点和两个桩子的三角形 数点，然后我们就爆力预处理这个就行了，复杂度$$O(nm^2)$$。

C. Sum of Digits

直接dp，看起来只需要dp一遍就可以回答所有询问。

D. Dirt

直接最短路。

E. Repairman

走到的是一个区间，区间dp。

F. Two Mirrors

真实的计算几何。直接做。

G. Chinese Chess

这是一个二分图匹配，我们要找到其中必流的边。

看起来这是经典问题。做法是dinic，然后在残量网络上kosaraju，然后如果一条边满流，并且两个端点不在同一个scc，那么它必流。

H. Network

看起来很有意思。

注意题目中把很多个$$2^n$$写成了$$2n$$，并且时限足有10s，所以复杂度可能是$$2^{3n}$$这样的。

贡献方式看起来是，用的少的那一种要付钱，用的多的免费。

注意到这个pair贡献是假的，它对两个人其实是独立的，所以我们可以预处理每个人在每个祖先处的贡献。

然后考虑dp，我们决策一个人的时候，把他到根的链上每个点是A多还是B多记入状态。但是这样会出问题，因为我们dp过去就dp过去了，不能保证钦定了A多最后就是A多这样的。

考虑了一下子树为状态的，直觉上感觉不行，是因为它可能不能保证 不管这个点A多还是B多，子树总是采用局部最优策略。考虑如果这个点A多，它的儿子也是A多，那么可能有一个叶子翻转的代价很大，而只考虑儿子的子树翻它不划算，考虑上这个点翻它就划算了(在这个点不翻它的代价更大)。

考虑一个离奇做法，我们每次找到一个点，如果翻了可以使答案减小那就翻，啥也不翻的话答案不会超过5e8所以最多翻这么多次，树高是10所以容易找到哪里可以翻，但是我不会证单谷。

切队长之言可谓切中了肯綮，考虑我们把两个dp拼起来，同时记录到根链上的状态和这个点子树有多少个A，然后转移是背包，复杂度是树卷积，多了一维所以是$$O(4^nn)$$。

这个故事告诉我们，如果你的两个dp状态设计都有不能考虑到的问题，不妨把它们拼起来。或者说想到一个要记的东西的时候，就总是记它直到你写出一个可以优化的dp，然后在优化的时候删掉多余的信息，除非你确定有别的更简单的东西可以替代它，或者确定记这个东西不会有任何效果。

I. Robot

看起来类似于 美食家，但是做法不是很一样。我们直接dp，然后分析复杂度，看起来是$$O(mT)$$，于是做完了。

J. Scales

平衡三进制。

K. Increasing Speed Limits

BiT优化dp。

#### contest7

A. Top Shooter

一秒一个可真是恐怖啊/jk

贪心地，先打更低的。

B. “Base B”

直接做。先用B进制表示，如果有太小的，从高位退下来。

C. Birthday Toy

几分钟玩1e9个珠子/jy

考虑冲一个burnside。burnside指出，置换群作用下不同的染色个数等于每个置换作用下不变的颜色数量的平均值。这里置换只有1e9个，所以我们先枚举一个置换，对于转$$i$$下的置换，它确定了$$\gcd(i,n)$$个等价类，每个等价类颜色必须是一样的，于是问题变成有$$\gcd(i,n)$$个珠子排成的环，中间还有一个珠子，不考虑同构，相邻的必须不同的方案数，设为$$f(\gcd(i,n))$$好了。搞完这个，我们的问题就是对所有$$n$$的因数$$d$$求$$f(d)$$然后反演算贡献而已。

然后这个$$f$$看起来很不好算。现在我们要算$$f(d)$$。考虑中间的珠子相当于ban了一个颜色，然后考虑容斥，钦点$$i$$个间隔使得两边相同，这会产生$$n-i$$个连通块(钦点了$$n-1$$或$$n$$个都得到一个连通块)，于是方案数就是$$\displaystyle\sum\limits_{i=0}^n\binom{n}{i}(-1)^i(k-1)^{n-i}+(-1)^n(k-2)=(k-2)^n+(-1)^{n}(k-2)$$，后面那个是钦点$$n$$个的时候少算的。

另一个做法是矩阵快速幂优化dp。

然后复杂度就是$$O(\sqrt{n}\log n)$$了，可以光速幂再砍$$\log$$。不过不知道莫反的部分是啥复杂度?反正能做。

D. Special Prime

考虑如何判断一个数是不是特殊的。我们移过去变成$$p=\frac{m^3-n^3}{n^2}=m\left(\frac{m}{n}\right)^2-n$$，如果有一组$$n,m$$使得这个成立就彳亍了。然而这个看起来比较困难。

考虑$$\frac{m^3-n^3}{n^2}=(m-n)(\frac{m^2}{n^2}+\frac{m}{n}+1)$$。这个也失败了。

考虑$$n^2(n+p)=m^3$$。注意到如果$$n^2(n+p)$$是立方数，要么$$n^2,n+p$$都是立方数，要么$$p\mid n$$。然而设$$n=kp$$，那么$$n^2(n+p)=k^2(k+1)p^3$$，于是$$k^2(k+1)=k^3+k^2$$必须是立方数，然而$$(k+1)^3=k^3+3k^2+3k+1>k^2$$，于是它不可能是立方数。于是只可能$$n^2,n+p$$都是立方数，并且容易感觉到这个是充要的。

问题是能不能找到一个$$n$$使得$$n^2,n+p$$都是立方数。注意到$$n^2$$是立方数，当且仅当$$n$$是立方数，因为一个素因子的次数是否被$$3$$整除，不管乘上多少个$$2$$都不会影响。

问题是能不能找到一个$$n$$使得$$n,n+p$$都是立方数，也就是$$p$$是不是一个立方差。设$$p=a^3-b^3=(a-b)(a^2+ab+b^2)$$，注意到$$a^2+ab+b^2\neq 1$$，于是$$a-b=1$$，否则$$p$$就不是素数了。

设$$p=(x+1)^3-x^3=3x^2+3x+1$$，解二次方程即可。复杂度$$O(1)$$。这题是不是mo味道过于浓重了?

E. Continuous Digit

从高到低逐位确定这个数的大小。它的值看起来不超过1e19，于是数位dp将会非常快。

F. Neighbor Friend

我们直接按照这个关系建图，如果$$a$$到$$b$$的所有路径上存在别的点，那么$$a,b$$不可能挨着。如果不存在别的点，那么我们感觉上总可以找到一种方案让它俩挨着。

问题是求两点间的最长路，枚举起点，拓扑排序即可。

G. Paper Cutting Game

注意切一刀是同时切所有的纸/jy

模拟。

H. Largest Submatrix

枚举答案由哪个字符贡献，然后dp或者单调栈。

I. Memory Control

模拟。

#### contest8

A. Another Snake

直接dp。

B. Bomb Game

注意到有 炸弹相撞会消失 的规则，于是我们似乎不能用sg定理了。

诶真的不能用吗?考虑两个同一位置的炸弹相当于没有，这是真的，因为后手可以模仿先手操作。于是我们可以把这个规则删去，答案是不变的。递推sg值即可。

C. Connections between cities

注意 no circle exists as well 说的是真的没有环，而不是可能没有环。板子。

D. DNA Sequence

第二类限制是一组里面两两不同，可以连个边。

为什么我会以为是要计数（

计数非常复杂，感觉上像是不弱于图着色，没法多项式时间做掉。这个问题相当于是有一些边，然后要做一个四染色，对相邻的还有一些要求。

观察一下这个相邻的要求，看起来是说相同的不能相邻，AC不能相邻，CG不能相邻，GT不能相邻，于是可能相邻的只有AG，AT，CT，这个形成了一条链，每一步只能往左或者往右走。我们枚举第一个，然后整个串可以用一个二进制数表示，于是状态数缩减成$$2^n$$了，但是这还是没啥用。

不妨假设第一位是A或者C，那么奇数位只能是A或者C，偶数位是G或者T，于是这看起来像一个2-sat了。直接建图跑即可。

怎么求2-sat方案数啊?

E. Ellipse, again and again

一开始看成Eclipse了，感觉很有诗意啊（

不过我可能一直以为eclipse是日落的意思了，实际上那是sunset，eclipse是日食/月食，也比喻权力/地位的丧失，也作动词表示使丧失。

算就行了。我不懂几何啊，但是我知道算肯定可以（

F. Florid Banner

rnm，每一行是独立的啊/fn，注意题面中说这些东西都不能转，也就是说只能横着摆。

直接dp即可，用hash table找一下合法的转移。

G. Great World of Goo

原题面写的很烂，并且据说有错误。转化之后是，二分图，有若干条特殊边，特殊边需要选至少一条，最大匹配计数，答案超过$$2^{16}-1$$则输出overflow!。

那这个是不是简简单单啊!我们跑一个最大匹配，然后开始搜交替路来扩展，用map支持 扩展到走过的状态就跳，搜够$$2^{16}-1$$种就溜。复杂度未知。

据说一个直接做法是，直接搜选哪些边，然后用dancing links维护。

H. HeHe

前面有一个 Self-Replicating Numbers 指出，$$x^2\equiv x\pmod{n}$$变换成$$n\mid x(x-1)$$，并且$$x\perp x-1$$，于是需要把$$n$$的素因子成两部分分别扔进$$x$$和$$x-1$$，然后通过乘上一些东西使得它俩差$$1$$。这是两条直线，所以只可能有一个解，而由于裴蜀定理必然有一个解，所以方案数就是$$2^{\omega(n)}$$。求和即可。

看起来可以做到$$\tilde{O}(n^\frac{3}{5})$$，也就是用因数个数函数$$d$$构造powerful number，然后问题变成算$$d$$的前缀和$$S_d$$在$$n$$的基本和组处的值。基本和组就是$$\lfloor\frac{n}{i}\rfloor$$形成的集合，它只有$$O(\sqrt{n})$$个元素。

我们有方法在$$O(n^\frac{1}{3}\log n)$$(divcnt1是带$$\log$$的，但是论文不带)内算$$S_d$$在$$n$$处的值，参见 https://www.luogu.com.cn/problem/SP26073 。

考虑对于大的部分上这个，小的部分打表，积分可以得到大的部分的复杂度，解个方程得到打表长度为$$\tilde{\Theta}(n^\frac{3}{5})$$时最优，复杂度是$$\tilde{O}(n^\frac{3}{5})$$。

可能有复杂度更低的做法，不过最practical的还是直接上$$O(n^\frac{2}{3})$$的爆力，也就是把sb树那个东西换成整除分块。

I. Ingredient

求lcm。

J. Jack's struggle

直接dp。5s慌什么!

#### contest9

A. The k-th String sequence

在子序列自动机上逐位确定。

B. kebab

不能分成实数，但是我们也不需要分成实数，所以当成可以分成实数做也是对的。

先烤截止时间更近的。

C. Orefield Design

看起来是说，选五个点，要包含五种不同的矿物，然后最小化斯坦呐树边权和。直接dp，设$$dp(u,S)$$表示$$u$$子树内选了$$S$$内的矿物的最小斯坦呐树边权和，转移直接做，复杂度是$$O(3^5n)$$。

D. Drr1 Numbers

枚举位数$$k$$和最后一位$$c$$，问题变成有多少个$$k-1$$位数$$x$$满足$$10x+c\mid 10^{k-1}c+x$$。这个看起来还挺困难的（

进一步注意到$$\frac{10^{k-1}c+x}{10x+c}$$不超过$$9$$，因为极端情况下第一位是$$1$$而最后一位是$$9$$。于是我们进一步枚举这个值，设为$$d$$。

此时得到$$d(10x+c)=10^{k-1}c+x$$，解得$$x=\frac{(10^{k-1}+d)c}{10d-1}$$，于是直接就把这个数求出来了。要求它膜$$100000$$的值，注意到分母只可能是$$9,19,29,39,49,59,69,79,89$$，它们都与$$100000$$互素，于是可以exgcd求逆。

E. Lou 1 Zhuang

显然必然是分成若干个$$2$$和$$3$$的乘积。讨论一下是尽可能分$$3$$因为$$2^3<3^2$$，分到只剩$$O(1)$$再打个表看看就彳亍了。

F. Watering Hole

把挖井看成连向一个虚点，跑一个mst，然后对于每条加进来的边，在mst上尝试替换形成的环的最大边，使用fib堆优化prim和四毛子lca，复杂度$$O(n\log n+m+p)$$。

G. Check Corners

矩形$$\max$$是经典分治扫描线。复杂度忘了，猜一手$$O((nm+q)\log^2 n)$$（

gp of zhejiang里面有个题指出矩形加矩形$$\max$$可以做到一个$$\log$$，方法是让线段树支持清空(直接在根上打标记)，然后每次扫分治树的一层。

H. Without Zero

这玩意就是九进制。

I. Longest Repeated subsequence

请注意subsequence应为substring/jy，这玩意谁能看出来/jy

考虑使用后缀树，我们直接在后缀树上模拟。如果一个点的子树中还有至少$$k$$个叶子，并且可以从中选出$$k$$个不相撞的串(也就是说如果这个点深度是$$d$$，可以选出$$k$$个叶子对应的后缀位置两两差$$\geq d$$)，这个点就合法，然后只需要找最深的合法点。如何判断 不相撞?感觉并不好做。

考虑二分答案，然后这个点的深度就是固定的了，然后我们找到所有这样的点，它们子树中叶子个数和是$$O(n)$$的，于是直接贪心选取即可。复杂度$$O(n\log n)$$。

#### contest10

A. addHP

dp，设$$dp(i,j)$$表示$$i$$时刻刚刚加上了一些血，现在血量为$$j$$，之前的最小血量是多少。转移枚举上一次加上血的时间，然后中间是个前缀和。但是转移量很大，看起来复杂度是$$O(nmv)$$，不太行啊。

最小值最大，考虑二分答案$$d$$，然后状态变成$$dp(i,j)=0/1$$这样的。注意到固定$$i$$，$$dp(i,j)=1$$的$$j$$只有最大的那个有用，于是维度交换，设$$dp(i)$$表示$$i$$时刻刚刚加上了一些血，最小血量$$\geq d$$，现在血量的最大值，转移还是枚举上一次操作，看起来复杂度是$$O(nv\log v)$$，1e7带$$\log$$真的行吗?

然后你发现我们没有办法进一步优化了，因为这玩意不弱于背包，boos一上来第一炮把血条打干净，后面不开炮了，你就是在跑完全背包(现在我已经不知道该叫完全背包还是无限背包了，很年轻的时候学的是前一种，但是看起来两种说法都很流行?)。所以交上去，直接就过掉了。

B. area

首先根据平抛的结论求出落地点，然后问题是圆和多边形交的面积。考虑多边形的顶点，以及多边形和圆的交点，从这些点到圆心连线，这会把交分成若干个扇形和三角形。求即可。

C. cube

扫描线，问题是矩形加减，每次操作后查询全局$$>0$$位置数。只需要维护$$0$$的个数，然后k-dt维护一下就行了，复杂度$$O(n\sqrt{n})$$。

D. DeBruijin

这是一个欧拉回路的经典问题。如果直接搞则转化为哈密顿回路，我们就完蛋了，考虑把这个数当成边而不是点，两个数可以转一下相互得到，就让它们有公共端点。

E. Edit distance

模拟。

F. 病毒侵袭

kmp。

G. 邂逅明下

这怎么看都是一个经典问题。

直接做看起来并不行。

考虑一个经典想法，不管先手怎么取，后手总可以保证两个人一共取$$p+q$$个，如果最后剩下$$\leq p$$个，也就是说$$n\bmod{(p+q)}\leq p$$，那么后手将绝杀。否则，先手上来取$$n\bmod{(p+q)}-1$$个，就必胜了。

H. 旋转

不会，但是是板子。

#### contest11

A. A Simple Language

模拟。

B. Travelling

枚举全排列。

C. King of Destruction

无源汇最小割。这个不需要学习科技，直接最小割树就行了（

stoer-wagner，sw算法说的是，考虑我们随便求一个$$s$$到$$t$$的最小割，如果它不是答案，那么说明在割掉全局最小割之后，$$s,t$$在同一个连通块，此时把它们缩点不会影响全局最小割。于是每次求出随便一个有源汇最小割并合并源汇，合并$$n-1$$次之后，必然有一次得到了全局最小割。

**结论** 随便选一个点开始跑prim最大生成树，设最后连通的点是$$t$$，倒数第二个是$$s$$，那么$$(V-t,t)$$是一个$$s$$到$$t$$的最小割。

**证明** 略（

于是做即可。fib堆优化prim，复杂度$$O(n^2\log n+nm)$$，一般实现小常数的$$O(n^3)$$。

D. Pupu

注意 all of a PuPu's skins has been changed from opacity to clarity 是说都至少变成clarity一次，而不是当时全都是clarity。直接算即可。

E. The Chess

显然只可能动车，马，炮，车炮，马炮。

车是简单的，bfs即可。马，炮是一样的。

车炮是简单的，都bfs一下，然后枚举最后的位置即可。马炮是一样的。

F. The Different World

好像很难看懂题。大概是说，求第$$n$$个数$$m$$，满足存在一个$$k$$使得$$\sum\limits_{i=k+1}^{k+m}i^2=m^3$$，输出$$m,k$$。

直接自然数幂和，然后展开那个式子，发现$$m$$是三次的而$$k$$是二次的，于是爆力求解$$k$$，得到$$k=\frac{\sqrt{33m^2+3}}{6}-\frac{m+1}{2}$$，看起来如果它是整数我们就找到了一组$$m,k$$。

打表发现，只要那个根可以开出来，也就是说$$33m^2+3$$是平方数，得到的$$m,k$$就必然是整数。接下来证明这个事情。

如果$$m$$是奇数，那么问题就变成$$\frac{\sqrt{33m^2+3}}{6}$$是整数，也即$$\sqrt{33m^2+3}$$是整数且是$$6$$的倍数。由于$$m$$是奇数，有$$33m^2+3\bmod{2}=0$$；显然也有$$33m^2+3\bmod{3}=0$$。所以只要求$$33m^2+3$$是平方数就行。如果$$m$$是偶数，问题就变成$$\sqrt{33m^2+3}$$是整数，是$$3$$的倍数且不是$$2$$的倍数，证明看起来是一样的。但是打表发现好像没有$$m$$是偶数的解。

剩下的问题是求所有使得$$33m^2+3$$是平方数的$$m$$。

设$$u^2=33m^2+3,v^2=m^2$$，那么问题变成求所有$$u^2-33v^2=3$$的正整数解。这是一套经典的理论，称为Pell方程，我也是现学的。

**结论** 要求$$ax^2-by^2=c$$的所有整数解，先求$$x^2-aby^2=1$$的最小正整数解$$x_0,y_0$$，以及$$ax^2-by^2=c$$的最小正整数解$$x_1,y_1$$，那么$$ax^2-by^2=c$$的第$$k$$个正整数解即为

$$
\begin{bmatrix}
x_k\\
y_k
\end{bmatrix}
=
\begin{bmatrix}
x_0 & by_0\\
ay_0 & x_0
\end{bmatrix}^{k-1}
\begin{bmatrix}
x_1\\
y_1
\end{bmatrix}
$$

。证明不会。于是爆力求解即可。

Pell方程的那一套里面，最复杂的部分这题并不涉及，是用连分数求$$x^2-ny^2=-1$$的最小正整数解。我并不打算学，要是oi出连分数大家应该都不会。

G. The Number of set

状压，背包。

H. Buried memory

最小圆覆盖。

I. Warcraft

直接dp，设$$dp(i,j)$$表示现在是$$i$$时刻，你有$$j$$法力，boss的最小血量。不需要记你的血量，因为boss一直在打你。前面好像有一个更强的题?

#### contest12

A. Go Fishing

搜肯定没问题。

是不是可以费用流做到多项式复杂度啊/kel

B. N Knight

注意这里的knight说的是车/jy

类似于错排的经典容斥。

C. Cut Pyramid

不要几何题啊/fn

体积可以强硬插值积分，所以就结束了。但是我不会写/cy

D. Travel around the world

哈密顿路/jy

考虑一对$$(a,b>a)$$什么时候是可行的，看起来最优策略总是先从$$a$$走到最小值，然后从最小值走到最大值，然后从最大值走到$$b$$，于是这玩意两边是两段双调的，可以强力dp，中间如果没有断层就不用管，有就直接输出$$0$$，复杂度是$$O(n^4)$$。

考虑优化，我们写出dp的式子，设$$l(i,j)$$表示从$$i$$走到最小值，从最小值走到$$j$$是否可行，$$r(i,j)$$类似，转移枚举下一个点给哪一边，复杂度是$$O(n^2)$$。求出这个之后，我们枚举$$a,b$$，看$$l(a,a+1)\operatorname{r(b,b+1)}$$，然后这个东西很好做到$$O(n)$$。

考虑进一步优化，设$$l(i)$$表示从$$i$$走到最小值，从最小值走到$$i+1$$是否可行，$$r(i)$$类似，转移枚举上一个在最小值到$$i+1$$路径上的点。注意到一个性质，因为我们只要可行性，所以如果有相邻三个点都在$$i$$到最小值的路径上，那么中间那一个换到最小值到$$i+1$$的路径上不会更差，于是转移的枚举量是$$O(1)$$，总复杂度$$O(n)$$。这就加强到1e6出给小朋友。

E. Tetris

模拟。

F. Counting Problem

看到题目名，就好这口啊!

然而是简单题。选选选就行了。注意不能求逆元，需要递推组合数。

G. Disharmony Trees

卡笛尔树。找到高度的$$\min$$，然后求$$\min$$跟所有树的贡献，这个贡献看起来只需要用一个值域BiT维护一下有多少距离更小的。然后递归两边。复杂度$$O(n\log n)$$。

H. Man Down

dp。

I. Treasure Division

背包。

J. Ant Trip

题意好像是连通块数?

K. Tracing Fairy

终于有二次元题面图片了（

L. Tracing Fairy

模拟，

#### contest13

A. To Be Or Not To Be

模拟。

B. Nim or not Nim?

先模拟一下算个sg值，然后找找规律。

你发现当$$n\bmod{4}=3$$时，$$\mathrm{SG}(n)=n+1$$，当$$n\bmod{4}=0$$时，$$\mathrm{SG}(n)=n-1$$($$n=0$$时为$$0$$)，此外$$\mathrm{SG}(n)=n$$。做即可。

C. I love sneakers!

看起来是什么所谓分组背包，每组至少选一个。这个简简单单，我们只需要依次处理每一组，记一个$$0/1$$表示有没有选这一组就好了，如果没选则不能转移到下一组。

D. Board Game

搜。

E. War

平面图最小割，也就是对偶图最短路。

F. Escape

军训的教官还敢喝酒/jy

显然可以二分答案之后线性规划多物品流。考虑有没有正常一点的做法。

注意到每个门处理的是一个连续的区域。同时注意到，只要每个门处理的是一个连续的区域，并且这个区域包含自己，那么它一定是满负荷运转的，也就是说每秒都有一个人出去。于是这个区域的花费就是区域的大小。问题变成，对于原图每个连通块，把点分成若干个部分，每部分连通且包含恰好一个E，最小化最大的部分的大小。

设原图中一个连通块有$$n$$个人和$$c$$个E，感觉上下界$$\lceil\rceil{n}{c}$$一定是可以达到的。于是就做完了。复杂度是$$O(rc)$$，是不是赢麻了（

G. Saving Beans

隔板一下，答案是个组合数，然后Lucas就行了。

H. How Many Answers Are Wrong

加权并查集。

I. A high-dimensional problem

知道了点积就知道了平面。高消解一解就好了。

#### contest14

A. Happy Girls

模拟。

B. Bee

经典问题。二分答案，然后模拟。

C. Josephus Again

看图你就理解题意了。

这玩意形成了一个类似stern-brocot环的形状，我们可以求出一个点的子树里面有多少点，然后二分即可。

D. Number game

状压dp，然后这看起来是个dag路径计数，在这上面跑就行了。

E. Dog and dog

模板 定积分。你需要一些数学功底，或者需要一把wolfram alpha。

F. Picnic Cows

看起来并不是很困难。在值域上dp，然后转移方程是$$dp(i)=\min_{j<i-k}dp(j)+(pre_i-pre_j)-(i-j)a_{j+1}$$，然后这个看起来就很斜率优化。

G. Pleasant sheep and big big wolf

模板 最小割。

H. Zjnu Stadium

并查集。

I. XX’s puzzle

看起来很有意思。三角剖分中每个三角形都以多边形的一条边作为边，所以等腰三角形要么是一条边连到对面的顶点，要么是相邻两条边。前者只在$$n$$为奇数的时候出现最多一个，后者看起来很局部。dp一下，把相邻两条边连成的三角形缩起来，直接计算三角剖分方案数，这个好像是一个组合数。如果是$$n$$奇数就再加上枚举中间那个有还是没有，如果有在哪里，两边拼起来。

J. Data Processing

模板 快速幂。

#### contest15

为什么这么多场¿

A. Cat Jim

直接做。如果$$i$$堆里面有一个$$j$$，我们从$$i$$连边到$$j$$(允许重边)，那么这个会形成若干个环的并，我们几乎每一步都可以走掉一条边，除了在连通块之间需要额外的一步。

B. Peaceful Negotiation

考虑容斥，我们钦点$$k$$条边贴着放了，那么把两个人绑起来，然后随便排，方案数是$$\binom{n}{k}2^k(2n-k)!$$。做完了。

C. Vim

模拟。

D. Group Travel

邮局。

E. Fibonacci

要求$$10^k\mid f_n$$的$$n$$。

打表观察一下，$$k=8,9$$的答案是

```
75000000 150000000 225000000 300000000 375000000 450000000 525000000 600000000 675000000 750000000 825000000 900000000 975000000 1050000000 1125000000 1200000000 1275000000 1350000000 1425000000 1500000000 1575000000 1650000000 1725000000 1800000000 1875000000 1950000000 2025000000 2100000000
750000000 1500000000。

```

，看起来很有规律。做就行了。

F. Mine

状压dp。

G. Stock

经典结论是，买一定尽可能多买，卖一定尽可能多卖。dp，设$$dp(i)$$表示在$$i$$天卖了股票，最多剩下多少钱。转移枚举这个股票是在哪买的即可。

H. Core

梦 幻 联 动

然而这个居然还是加强版。题意说的是，找一个连通块，使得这个连通块到树上任意点的最大距离最小。noip题说的是找一条链。

显然这个连通块必须包含center，这里的center应该是加权的。然后直接从center出发往各子树扩展，开个堆维护当前的瓶颈就行了。

I. Generator

板子题。

J. Count Cross

直接做。

#### contest16

A. Area2

并=和-交。

如果保证是凸多边形，kdw就秒了，只需要半平面交拍上去就行了。如果不是凸的呢?

注意到$$n,m$$非常小，所以我们可以考虑强行算出这个交。考虑找到所有两个图形的边的交点，扫描线扫过去，这把平面分成了若干个区域，我们只需要算出每个区域是否在交里面，从里面找一个点算它是否同时在两个多边形里面就行了。复杂度是$$O(n^3)$$，带小于$$\frac{1}{4}$$的常数，感觉如果好好剪一剪可以做到$$\frac{1}{16}$$。

B. Battle

模板 最大权闭合子图。

C. Party

模板 2-sat。nit你在干什么啊¿

D. Play game

直接做。可以让机子帮你插一插。

E. twoNumber

模拟。

F. 病毒侵袭持续中

模板 acam。nit你清醒一点/jk

G. 火拼双扣

模拟。nit你在干什么啊/fn

H. 小t的游戏

显然它肯定会循环。

显然这是一个集合，顺序是没有关系的。先从小到大排个序，这样每次杀掉的都是一个前缀，于是我们可以支持快速的模拟。但是这又有什么用呢?

考虑能不能找点性质。考虑什么样的局面才可能是循环的。最简单的是$$1,2,3,...,k$$，循环节是$$1$$。

想象一下这个变化的过程，你发现所有的序列都在向$$1,2,3,...,k$$逼近，因为当你有$$c$$堆的时候，你会在位置$$c+1$$加入一个$$c$$个石子的堆，那么画到平面上就是$$(c+1,c)$$。同时因为平均每轮要杀掉一堆，所以它大概就在$$x-y=0$$这条线上。于是我们大胆猜测，只有不能进一步向$$1,2,3,...,k$$逼近的局面才可能是循环的。

如果总和是$$\frac{1}{2}k(k+1)$$，那就输出$$1$$。

否则，观察一下样例第二组，你发现它大概是，

```
0 2 3
1 2 2
1 1 3
0 2 3
1 2 2
1 1 3
```

这样的。它看起来跟$$1,2,3$$非常接近，但是它的循环节是$$3$$，仔细观察一下，你可以看到一个1在转圈圈。再试一试2 2。

```
0 2 2
1 1 2
0 1 3
0 2 2
1 1 2
0 1 3
```

你还是可以看到有一个1在转圈圈。于是就结束了，如果总和介于$$\frac{1}{2}k(k+1),\frac{1}{2}(k+1)(k+2)$$之间，那么答案是$$k+1$$。

I. 最长回文

模板 manacher。模板赛?

#### contest17

A. Arrest

如果是一条链，直接从这头冲到那头。

如果是一个菊花，那么需要在中间留一个人。

于是猜测答案是度数$$>2$$的点个数$$+1$$。手玩了一下样例你发现不对。小朋友想一想，这是因为留的那一个人不一定一直站着不动。如果子树已经搜查干净了，那么子树里面站着的老哥们就可以到别的子树继续战斗了。

考虑我们枚举一个根，然后依次自底向上处理根的子树。设$$dp(u)$$表示$$u$$子树最少需要多少人手，如果$$u$$是二度点那么把子树里面最高的老哥提上来就行了，否则我们需要在$$u$$放一个人。处理完一个儿子，那边的人手还可以拿来用，所以$$dp(u)=1+\max\limits_{v\in\mathrm{ch}(u)}dp(v)$$。

然后你发现样例还是不对。看起来是说，如果这个$$\max$$只有一个，那么我们处理完剩下所有子树，可以把$$u$$下移到这个子树去，此时那个$$1$$就不用加了。做完了。

B. Counting spanning trees

草，看起来好困难（

不过实际上也不困难吧/jy，考虑一个强力做法，我们直接矩阵树，每个点开一个元，然后我们要拉插$$100$$元gf。是不是随随便便就做掉了/tuu

考虑利用树的结构，直接dp即可。然后就做完了。但是我们看起来并不满意。

考虑能不能写成gf。刚才那个dp看起来是设$$f_n$$表示答案，$$g_n$$要求根的度数是$$d-1$$而别的点度数是$$g$$，容易看出$$F^\prime=G+G^2+...+G^d=\frac{1-G^{d+1}}{1-G}$$，当然也有$$G^\prime=F+F^2+...+F^{d-1}=\frac{1-F^d}{1-F}$$，边界是$$[z^0]F=[z^0]G=1$$。然后这是两个方程，直接分治法法塔就彳亍了。没有写过，不知道式子是否正确。

C. Gcd & Lcm game

直接做。算lcm的时候，gcd不一定有逆，不过显然可以把第一项单独拿出来除掉gcd这样的。

D. Intelligence System

mst。

E. Mars Life Tree

火星生活在树上/jy

完全没有看懂题。是说，找到一条边，使得从这条边开始长出这棵树代价最小?当这个做吧。注意到这个代价和谁在长叶子是无关的，于是模拟即可。

F. Multiply game

直接做。

G. Mystery ET

状压dp。

H. ssworld VS DDD

先爆力求出更大的概率，然后直接dp。

如果期望谁赢，好像是可以做到$$O(1)$$的。

I. Recursive Ants

建出递归树，设$$dp(i,j,k)$$表示在$$i$$号点代表的矩形中，从一边第$$j$$个点进入，另一边第$$k$$个点离开，是否可行。转移枚举走儿子的顺序，然后卷起来就行了，感觉上复杂度是$$O(2^{3n})$$。

J. Network

单点修改，链kth。看起来很困难啊/yun

考虑二分答案，然后统计一下rank，这只需要树剖树套树就好了，一共是四个$$\log$$。

考虑有没有什么正常做法。带修莫队，很难不过。

考虑有没有什么更正常的做法。二分答案肯定要有，然后rank是可差分的，考虑对时间分治，然后对树点分，这就是三个$$\log$$。

考虑整体二分，要支持单点修改链求和，树剖就是三个$$\log$$，静态lct就是俩$$\log$$。俩$$\log$$就是(算法竞赛范围内的，不知道是不是学界的)下界了，因为链kth是经典树套树。

可是据说爆力就过了啊?这么水的吗/qd

#### contest18

A. WORM

搜。

1e5能不能做啊?

B. Josephus again

具体数学给出了约瑟夫问题的公式，但是那个实在是太离奇了，不是很好用。

考虑一个牛逼递推式，我们有$$J(n,k)=(J(n-1,k)+k)\bmod{n}$$，含义是我们上来会干掉$$k-1$$号(从$$0$$开始编号)而递归到有$$n-1$$个人的情况，当然需要对编号作变换，接下来第一个人是$$k$$，于是$$J(n-1,k)$$相当于给每个人的编号都减去$$k$$之后的答案，我们再加回来就好了。你可能会疑惑中间不是断了一个吗?有趣的是它被平移到$$n-1$$位，所以没了。

然后考虑这个如何优化。注意到$$k$$很小，于是当$$n$$很大的时候，取膜是很难发生的，可以一口气加上一车。复杂度看起来有可能是$$O(k\log_k n)$$，但是wiki上写的是$$O(k\log n)$$，不过我实在是非常怀疑这里是前者。看一眼wiki你发现这个好像已经很优秀了。

C. Go Home

模拟。

D. Necklace

挑战哈密顿。

E. Least common multiple

显然我们分出来的所有数都是互素的，也就是说只可能选若干个素数幂。

显然我们会先选小的。然后可能的素数非常少，爆力即可。

F. Parliament Seat

模拟。

G. A tree game

模板 green hackenbush。

H. Eleven puzzle

搜。状态数看起来是3e9，如果加上一些启发式方法和一些剪枝，速度应该会很吓人。

I. Life Game

矩阵快速幂。

#### contest19

A. The Partition of A Graph

看起来是简单题。如果两条边可以在一组，我们就给它们连一条边，然后要找一般图完美匹配，带花树即可。呃复杂度是啥啊?好像是$$O(n^7)$$之类的。

居然把我难到了。直接dfs，走到不能再走，就在回溯的时候把每两条边分一组，注意是最深的和次深的一组，而不是最浅的和次浅的一组，这样感觉上完全不会丢解。类似于欧拉路?

B. Round Table Banquet

太拉了，国王请吃饭，每个人只有一道菜（

好像曾经和zyz讨论过这个问题，那是hdu mutc09 contest7 C。讨论奇偶性，问题变成相邻的不同，然后可以容斥得到一个简单答案，或者矩阵快速幂优化dp。

C. Defense of the Ancients

先求出左下凸壳(因为有位置限制，非常的好)，然后二分找到交的线段，在上面求一次交点即可。

D. MAX Average Problem

经典题。设前缀和是$$s$$，那么我们要找一对$$i>j$$，最大化$$\frac{s_i-s_j}{i-j}$$。注意到，固定一个$$j$$的话，相当于把后面所有$$i$$的$$(i,s_i)$$画到平面上，要求到$$(-j,-s_j)$$连线斜率最大的点。单调队列维护凸壳即可。

E. Ant on the graph

矩阵快速幂。先用一个不统计答案的矩阵跑到Tmin，然后用一个统计答案的矩阵跑到Tmax。

F. Another Panda's Birthday Present

爆力枚举每种情况算概率，这个东西足有$$2^{54}$$。

然后注意到一个骰子只有红色和蓝色的数量有效，这就只剩下$$7^9$$。打打表就行了。

这个题应该和前面那个积分题放到一场里面用来吓人（

G. Pagination

模拟。

H. Chromatron

恐怖模拟。

I. Binary Search Tree

看起来我可能没有理解题意。

区间dp。设$$dp(i,j,k)$$表示区间$$[i,j]$$构成一棵子树，这棵子树根的父亲的权值是$$k$$的最小代价。$$k$$一定是某个点的初始权值(因为可以改成实数)，所以复杂度是$$O(n^4)$$。如果不可以改成实数，还需要多一个$$n$$。

J. Stone Game, Why are you always there?

直接dp。

-----

然后09就结束了呢。感觉好多题，但是平均难度很低啊（

每场有一两道牛逼题可能是oi训练比较好的难度。

好像09一年的题就够2.5w字了。要写上古hdu多校全题解，对高中选手来说是不是不太可能啊（

往后跳一跳。下一步做16年。

### 2016

-----

#### contest1

A. Abandoned country

强行套皮/jy

mst然后换根。只换根不dp，是不是更适合称为up and down?

B. Chess

直接搜sg值。

C. Game

题意是求所有两点之间最短路的平均值，而不是让你找一个点最小化到其它点的最短路平均值。

那是不是简简单单啊!题目给了一个很牛逼的性质，没有两个守卫八连通下相邻，或者在同一行同一列，这说明直接走最短路几乎不可能被阻挡。只有一种可能的情况，也就是比如起点在左上终点在右下，中间每一行都有一个守卫，并且有从左上到右下排成一条斜线，第一个在起点右边，最后一个在终点左边。此时必然需要从一个口绕过去，答案会$$+2$$，最多也只会$$+2$$了。

于是我们统计有多少$$+2$$的。先只考虑起点在左上终点在右下的。直接强行枚举乱算就行了（

D. GCD

每个点往前不停二分。复杂度$$O(n\log n\log v)$$。

E. Necklace

状压dp。

F. PowMod

显然是两部分。第二部分是 模板 扩欧定理，于是考虑第一部分。

小朋友想一想，为什么$$n$$无平方因子呢?注意到$$\varphi$$有一个很好的性质，它不积性是因为$$n$$中$$p$$的次数对$$\varphi(np)$$的值有影响，而$$\varphi$$的话，只有这个次数是不是$$0$$这件事有影响。比如$$n$$中没有$$p$$，那么$$\varphi(np)=\varphi(n)\varphi(p)=(p-1)\varphi(n)$$，如果有$$p$$，那么$$\varphi(np)=p\varphi(n)$$，这和$$p$$的次数无关。

于是如果$$n\perp i$$，那么直接拆开即可。如果$$n\not\perp i$$，那么我们枚举$$\gcd(n,i)$$，然后容斥一下就好了，复杂度是$$O(2^{\omega(n)})=O(d(n))$$，感觉很对。

这玩意可以推式子简单地推出来。这个容斥是每一维上容斥拼起来的，所以在考虑一个素因子的情况下特别简单。考虑随便找一个$$n$$的素因子$$p$$，那么$$\varphi(n)=\varphi(p)\varphi(\frac{n}{p})$$。此时如果$$i\perp p$$，那么有$$\varphi(in)=\varphi(\frac{in}{p})\varphi(p)$$，否则则有$$p\mid i$$，这样的$$i$$只有$$\frac{m}{p}$$个，把它们拿出来单独算。写出来就是

$$
\begin{aligned}
f(n,m)&=\sum_{i=1}^m\varphi(in)\\
&=(p-1)\sum_{i=1}^m\varphi(\frac{in}{p})-(p-1)\sum_{i=1,p\mid i}^m\varphi(\frac{in}{p})+\sum_{i=1,p\mid i}^m\varphi(in)\\
&=(p-1)\sum_{i=1}^m\varphi(\frac{in}{p})-(p-1)\sum_{i=1}^{\lfloor\frac{m}{p}\rfloor}\varphi(in)+\sum_{i=1}^{\lfloor\frac{m}{p}\rfloor}\varphi(inp)
\end{aligned}
$$

，注意到$$p\mid n$$，所以$$\varphi(inp)=p\varphi(in)$$，于是有

$$
\begin{aligned}
&=(p-1)\sum_{i=1}^m\varphi(\frac{in}{p})-(p-1)\sum_{i=1}^{\lfloor\frac{m}{p}\rfloor}\varphi(in)+p\sum_{i=1}^{\lfloor\frac{m}{p}\rfloor}\varphi(in)\\
&=(p-1)\sum_{i=1}^m\varphi(\frac{in}{p})+\sum_{i=1}^{\lfloor\frac{m}{p}\rfloor}\varphi(in)\\
&=(p-1)f(\frac{n}{p},m)+f(n,\lfloor\frac{m}{p}\rfloor)
\end{aligned}
$$

就结束了，复杂度确实是$$O(2^{\omega(n)}=O(d(n))$$。加强到1e14出给小朋友/se

G. Rigid Frameworks

我们从小就知道三角形具有稳定性。

一开始猜的结论是，每行每列都有一个就行，但是百度一下看起来并不是这样。一个反例是，$$n=m=2$$，把主对角线杀了，那么这个居然还可以折，大概就是绕着中间那个点转一转，可以想象一下（

那么我们需要wikipedia一下，看看是不是很有已经存在的理论来描述这个东西。发现真的有，你可以搜索 Structural rigidity。结论是，一个图是刚性的，当且仅当它存在一个Laman子图。而Laman图的定义是，每个点数为$$k>1$$的子图只有不超过$$2k-3$$条边，并且整张图有恰好$$2n-3$$条边。

这个可以直观理解一下，刚性图就是，边是线段，画在平面上只有三个自由度的图，也就是确定了一个点和另一个点与这个点的角度，就确定了整个图画下来长啥样。没有边的图有$$2n$$个自由度，每加入一条连接两个点的线段，感觉上就可以缩减一个自由度，但是如果两个点之间已经是刚性的了则没有用，于是限制每个子图只能有$$2k-3$$条边，确保每条边都可以缩减一个自由度。Laman图在这个问题中好像不是很有用，但是自由度的概念非常有用。

还有一个牛逼东西叫刚性拟阵，它指出一个图的所有子图和它们的自由度构成一个拟阵(好像是?)，这说明所有极小刚性图的大小是一样的。所以我们猜测这在加了一些边的网格图上也成立，所以我们考虑极小刚性图是什么样的，也就是什么样的边能缩减一个自由度。

实际上如果你真的看了wikipedia，它提到了网格图自由度的结论，但是如果你没看那就没事了（

考虑网格图的自由度有多少个......你发现看起来有$$2+n+m$$个，也就是我们确定左下角，这是两个自由度；然后确定左边和下边，每条线段有一个角度，这是$$n+m$$个自由度。确定了左边和下边的所有点之后，每个点的坐标都确定了。所以说，我们需要放至少$$n+m-1$$条边，刚才$$n=m=2$$两条边就搞定了是显然不行的。

考虑什么情况下加入一条边是无效的。你发现这当且仅当它所在的正方形已经固定了，这个是可以推广的，也就是说加入一条边之前，不管图怎么动，这条边的两个端点的距离都不变，那么这条边是无用的。不妨称一对不管怎么动距离都不变的子图为相对固定的，当然这是因为我没有找到一个术语。显然相对固定是传递的。

考虑如果一个正方形所在的行没有加任何边或者列没有加任何边，那么它肯定不是固定的。如果有，那么我们找到它同行的一条边和同列的一条边，如果这两条边相对固定，那么这个正方形应该是固定的，而如果不存在这样的两条边，我们还可以像一开始的讨论中那样弯一弯。

那么如何看两条边是不是相对固定的呢?如果这两条边同行或者同列，那么它们肯定是相对固定的。同时因为相对固定具有传递性，如果存在一条链，使得链中相邻两个点要么同行要么同列，那么链中任意两个点都是相对固定的。

你发现这个看起来是经典套路了。我们给每行每列建一个点，然后每条边连接它所在的行列，那么两条边相对固定，当且仅当它们在一个连通块中。类似地可以推出，如果加入一条边的时候，它的端点在同一个连通块中，那么它就是没有用的，否则它还是有用的。这一套分析看起来还是非常套路，但是看起来也非常优美啊（

然后问题变成连通二分图计数，每条边还有$$2$$的权值。刚才考虑了往生成树上加边，但是发现加完之后并不是二项式反演，所以考虑一个牛逼dp。

设$$dp(i,j)$$表示两边有$$i,j$$个点的答案。注意到连通很是不容易dp，所以我们容斥一下。考虑$$1$$号点所在的连通块，如果这个连通块不包含所有点，那么就是不连通的，否则就是连通的。我们对它包含的点数进行容斥，现在问题是左边有$$i^\prime$$个点(包括$$1$$)，右边有$$j^\prime$$个点，剩下随意的方案数，看起来就是$$\binom{i}{i^\prime-1}\binom{j}{j^\prime}dp(i^\prime,j^\prime)3^{i-i^\prime+j-j^\prime}$$。然后就结束了。

确实是牛逼题。这就搬给小朋友。

另外，生成树确实是有结论的。完全二分图的生成树个数是$$n^{m-1}m^{n-1}$$。

H. Shell Necklace

模板 多项式求逆。写一个dp，然后发现它是个卷积，然后用gf描述一下，就是$$F=CF+1$$，于是$$F=\frac{1}{1-C}$$。或者你也可以直接看出多项式然后直接得到这个式子?

I. Solid Dominoes Tilings

当然考虑状压dp。问题就是每个竖线上都有一个横着的，每个横线上都有一个竖着的。

设$$dp(i,S,T)$$表示考虑前$$i$$行，$$S$$中的竖线上已经有了骨牌，上一行留给这一行的状态是$$T$$，或者说$$T$$表示上一行中放了一个竖着的骨牌的上半部分的位置。预处理所有可能的转移，看起来数量是斐波那契数，这个东西复杂度看起来低于$$O((2\sqrt{5}+2)^nn)$$，不过还是没太有可能。

考虑换成轮廓线，复杂度变成$$O(4^nn^2)$$。但是问题是我们需要砍那个$$4^n$$啊?

容斥。钦点若干竖线可以切开，那么就把这个分成了若干部分，每一部分是独立的，可以跑$$n$$遍轮廓线dp全都预处理出来，然后只有最大的一遍影响复杂度，最后复杂度是$$O(2^nn^2)$$。那这么说可以加强到$$18$$?

J. Subway

树同构/jy

经典做法是，我们找到重心，把重心当成根拎起来，如果有两个就把两种情况都试一下。

对于有根树同构，简单做法是树hash，复杂做法是ahu。

树hash的一个难以hack的经典方法是，每个点的hash值是儿子们的hash值分别乘上第子树大小个素数，然后加起来再$$+1$$，比较的时候还需要比较子树大小。看起来是说$$f(u)=1+\sum\limits_{v\in\mathrm{ch}(u)}p_{\mathrm{size}(v)}f(v)$$，然后$$\mathrm{hash}(u)=nf(u)+\mathrm{size}(u)$$这样的。

然后ahu还是去他的吧（

K. tetrahedron

为什么只有这个题首字母是小写的（

几何题还是去他的吧。

这个东西可以变成到四个面距离平方的方差为$$0$$，然后方差$$\geq 0$$，并且这是一堆很光滑的东西，所以只需要上一个退火就行了，我猜测直接梯度下降就行。

这玩意有公式，但是我怎么可能推出这个公式呢（

#### contest2

这同时是ptzsc2016的Day1。

脑子一抽写了翻译。不过实际上写不写差不多?

可以在baekjoon oj提交。不过hdu马上就要修好了?

-----

翻译

A. Acperience

给一个序列$$w_i$$，你可以选择一个数$$\alpha\geq 0$$和一个序列$$b_i$$，要求$$b_i=\pm 1$$，并且$$\sum(w_i-\alpha b_i)^2$$最小，只需要输出这个最小值，但是你需要输出有理数。$$n\leq 10^5,-10^4\leq v\leq 10^4$$，大约$$15$$组数据。

B. Born Slippy

有根树，点有点权$$w_i$$，还有一种位运算op=and/or/xor。对于每个点，求从它开始走，每次走到一个祖先，如果从$$u$$走到$$v$$，则答案增加$$w_u\operatorname{op}w_v$$，只需要对于每个点找到这个最大值。$$n,v\leq 2^{16}$$，多测，$$\sum n\leq 10^6$$，6s。

C. Call It What You Want

树上加不超过五条边的无权图，求最长简单路。$$n\leq 10^4,m\leq n+4$$，大约$$50$$组数据。

D. Differencia

两个序列$$a,b$$，支持$$a$$的区间推平，查询区间有多少$$i$$满足$$a_i\geq b_i$$，强制在线，操作完全随机生成。$$n\leq 10^5,m\leq 3\times 10^6$$，14s，多测，大约$$10$$组数据。

E. Eureka

欧几里得平面上有$$n$$个点，定义一个点的子集$$P$$是好的，当且仅当其中存在一对点$$u,v$$，使得对于任意$$w$$，都有$$\mathrm{dist}(u,v)\geq\frac{\mathrm{dist}(u,v)+\mathrm{dist}(u,w)+\mathrm{dist}(v,w)}{2}$$。求有多少个好的子集，膜$$10^9+7$$。$$n\leq 1000,-10^9\leq x,y\leq 10^9$$，多测，$$\sum n\leq 4\times 10^4$$，5s。

F. Fantasia

无向图，点权，删去每一个点(相互独立)之后，求所有连通块点权乘积之和。$$n\leq 10^5,m\leq 2\times 10^5$$，多测，$$\sum n,\sum m\leq 1.5\times 10^6$$，5s。

G. Glorious Brilliance

给一张图和一个黑白染色方案，但是这个方案不一定是对的，你每次可以交换相邻两个点的颜色，求最少的交换次数使得它是对的，也就是没有相邻两个点颜色相同，并构造方案，无解输出-1。$$n\leq 500$$，$$200$$组数据。

H. Helter Skelter

有一个很长的01串，由$$n$$个0连续段或者1连续段构成，第一个字符是0，第$$i$$段长度是$$x_i$$。有$$m$$次查询，每次给$$a,b$$，求是否存在一个子串恰好有$$a$$个$$0$$和$$b$$个$$1$$。$$n\leq 1000,m\leq 5\times 10^5,x_i\leq 10^6$$，多测，$$200$$组数据，$$\sum m\leq 2\times 10^6$$。

I. It's All In The Mind

有一个序列$$a$$，每个数都在$$0,...,100$$之中，有一些位置是未知的，现在给你已知的所有位置和它们的值，把未知的位置填上$$0,...,100$$的数，使得序列单调(非严格)递减，不全为$$0$$，最大化$$\frac{a_1+a_2}{\sum a_i}$$，只需要输出这个最大值，并且你需要输出有理数。$$n\leq 100$$，$$2000$$组数据。

J. Join The Future

给定序列$$x,y$$，若干个区间和值的二元组$$([l_i,r_i],s_i)$$，求有多少序列$$a$$，满足$$x_i\leq a_i\leq y_i$$，并且$$a$$在$$[l_i,r_i]$$的和膜$$2$$是$$s_i$$，并构造其中字典序最小的。$$n\leq 40,x_i,y_i\leq 10^9$$，$$110$$组数据，5s。

K. Keep On Movin

有$$n$$种字符，第$$i$$种有$$a_i$$个，用它们构造若干个回文串，每个字符都要用完，最大化最短的串的长度，只需要输出这个长度。$$n\leq 10^5,a_i\leq 10^4$$，多测，大约有$$\sum n\leq 3\times 10^6$$。

L. La Vie En Rose

有长$$m$$的模式串$$p$$和长$$n$$的文本串$$t$$，对于$$t$$的每个长$$m$$的子串，求它是否与$$p$$经过一次变换生成的某个串相同。一次变换定义为，选取$$p$$的若干对相邻位置并交换每一对，并且一个位置不能被换两次，比如abcd可以变换成badc或者acbd这样的。$$n\leq 10^5,m\leq 5\times 10^4$$，2.5s 64mb。

M. Memento Mori

有一个$$n\times m$$的矩阵，其中$$k$$个位置是$$1$$，别的全是$$0$$。给一个$$1,2,3,4$$的排列$$p$$，求有多少极小子矩形，使得其中恰有四个$$1$$，并且设这些$$1$$从上到下(行编号从小到大)的位置是$$(r_i,c_i)$$，则对于任意$$1\leq i<j\leq 4$$，有$$(p_i-p_j)(c_i-c_j)>0$$。$$n,m,k\leq 2000$$，多测，$$250$$组数据，大约有$$\sum k\leq 6\times 10^4$$，2.5s 64mb。

-----

sol

A. Acperience

签到题。首先每个$$b$$显然是和对应的$$w$$符号相同，于是我们得到一个$$\sum w_i^2-2\alpha\sum w_ib_i+\alpha^2\sum b_i$$。然后惊喜发现这是二次函数，求个极值就行了。

感觉适合给普及组做?

B. Born Slippy

$$2^{16}=65536$$。直接递推(或者你也可能觉得这是dp?)是$$n^2$$。

考虑什么数据结构可以支持维护一堆$$a,b$$，给一个$$x$$，查询$$x\operatorname{op}a+b$$的$$\max$$。

对于or，我们不需要这样的数据结构，因为显然增加点不会让答案变劣，转移必然直接到父亲。

对于xor，好像只能想到trie，但是在trie上走看起来比较困难，因为如果一个数$$b$$很大但是$$a$$没有这一位，另一个数$$b$$不够大但是$$a$$有这一位，我们并不是很好立刻决策。

对于and，好像只能想到法嘛塔，看起来没有什么前途。

我们可能都需要像or那样找点结论。

dwt之言可谓切中了肯綮，打表可知xor也是直接选父亲最优，而zyz指出这是因为sum>=xor。现在只剩下and我们还不会了。

考虑一个点的答案总是不比父亲小，于是转移到祖先看起来是很离奇的事情，除非我们是为了获取巨大的$$x\operatorname{and}y$$。考虑一个点$$x$$往上所有的$$x\operatorname{and}y$$的前缀$$\max$$。

然而这个东西可能有很多个。and的构造是一条$$2^{15}$$的长链，下面挂着$$2^{15}$$个点，上面的权值从上往下依次是$$2^{15}-1,2^{15}-2,...$$，下面全都是$$2^{15}-1$$。所以我们失败了。

考虑了很多东西，但是好像都得不到什么，于是我来猜一个结论，从每个点往上找到每一位第一次出现，转移必然在这其中。考虑如何证明，考虑现在要给$$x$$转移，对于某个$$z$$，考虑$$x\operatorname{and}z$$的最高位，如果$$z$$的这一位不是第一次出现，我们直接选取第一次出现$$y$$，改为走$$x\rightarrow y\rightarrow z$$，可以得到两倍的这一位。于是做完了。

这题非常有趣，我很喜欢。这就搬给普及组。

但是我做法好像跟网上不太一样/yun，网上做法都是折半，但是我找了一个写了一发拍了一拍，看起来是对的?

呃可以在baekjoon提交，看起来它确实是对的，并且我手动O2了一下就最优解了。

C. Call It What You Want

考虑树怎么做，就是直径。

考虑我们枚举多出来的五条边有哪些经过了，然后枚举一个经过顺序，然后中间因为是简单路径只能走唯一的路径，边上就往两边dfs，复杂度是$$O(5!n)$$。

D. Differencia

随机数据?odt冲啊/fn

正经做法是归并树。讲道理归并树应该算是线段树的一种，还是说归并一个序列的线段树是归并树的扩展或者延申?

E. Eureka

这个问题看起来好像并不计算几何。考虑那个式子啥时候会成立，它等价于$$\mathrm{dist}(u,v)\geq\mathrm{dist}(u,w)+\mathrm{dist}(v,w)$$。

看起来这个式子很离奇啊，因为欧氏距离是满足三角不等式的/yiw，然后这个是反着的?也就是说它们只能相等了，也就是说实际上它算的是整个点集都在一条直线上的方案数。

然后就随便做了，枚举两个点确定一条直线，然后统计直线上随意选点的方案数就彳亍了。记得预处理2的幂。

F. Fantasia

看起来是不是简简单单，只需要分治，分治，分治，然后，并查集查询，就好了。

G. Glorious Brilliance

先看一看是不是二分图，如果不是那就没救了。

然后我们只能想到网络流了。考虑交换01相当于把1移动到0的位置，于是对每个连通块枚举两种染色方案，跑Floyd求最短路，然后猜测所有的1一定可以都走最短路而不相撞，于是km跑最小权完美匹配即可。复杂度是$$O(n^3)$$。

H. Helter Skelter

直接爆力枚举左右端点所在的段，然后就是两个区间的笛卡尔积，然后就可以得到一些线段和一些矩形，每次是查询一个点在不在这里面，直接数点即可。

但是你发现$$200$$组数据好像完全没法这么搞，做到低于$$n^2$$才有可能?

然后想了很久都不成功。上网一查发现$$n^2\log$$就过了（

$$n^2$$也是简单的，我们把0,1的个数画到平面上，考虑到可行区域是连续的，于是我们爆力枚举两个分段点，求出这个区域的边界，然后因为它的上下都是单调的，我们只需要求上下两条折线，基排然后单调栈即可。查询在这上面二分即可。

I. It's All In The Mind

签到题。直接前两个填尽可能大的，后面填尽可能小的。

J. Join The Future

两问看起来不是一件事。

考虑这个相当于一个区间的xor，然后拆成前缀xor，建个图就彳亍了。如果有权值xor是奇数的环那就没救，否则每个连通块，确定了一个，剩下的就都确定了。

然后我们可以做字典序最小了。从前往后贪心，每次选择了一个就把整个连通块都确定了。但是这个并不能做方案数，因为我们考虑的是前缀xor，而前缀之间并不是独立的，换句话说，我们确定了前缀$$p$$的取值，并不能确定位置$$p$$的方案数，因为它受到前缀$$p-1$$的影响。

现在问题转化为，有一张图，每个点可以选0或者1，点$$u$$选0/1的方案数是$$f(u,0/1)$$，对于所有黑白染色的方案，求所有点$$f$$乘积之和。感觉上$$f(u,0),f(u,1)$$差不超过$$1$$的性质并没有什么用。

考虑一个强行想法，我们从前往后dp，然后记一下每个连通块编号最小的点有没有确定，如果确定了那么它的值是什么，这是三进制的，然后复杂度就是$$O(3^n)$$，看起来飞了。

注意到 编号最小的点有没有确定 没有记录的必要，因为我们是从前往后dp。复杂度变成了$$O(2^nn)$$，看起来还是不是很行。

注意到大小为$$1$$的连通块没有记录的必要，所以复杂度变成了$$O(2^{\frac{n}{2}}n)$$，看起来好像差不多了，但是因为有多测，还是不是很行。不过讲道理1e9是有可能冲过的?

然后百度了一下发现确实冲过了。但是我并不是很满足于这个结果。

考虑我们搞另一个复杂度也是$$O(2^{\frac{n}{2}}n)$$的做法，直接爆力枚举所有大小$$>1$$的连通块的结果，然后从左往右做一个线性的dp来决策大小是$$1$$的连通块。这个看起来要更快一些，毕竟空间是线性。

然后这两个做法看起来都不是很能优化，于是我就失败了。反正过了，那还是就过了吧（

K. Keep On Movin

看起来应该挺简单吧（

考虑这是构造回文串，所以有两个a和两个b的效果是一样的，但是有一个a一个b和有两个b的效果是不一样的，于是我们把所有字符尽可能变成a，现在除了a之外所有字符最多有一个。呃虽然我这么说，但是这题字符集不是小写字母（

因为要把所有字符用完，并且每个奇回文串只有一个字符是单着的，所以所有单着的字符我们都得给它一个串，然后剩下的就把所有a平均分配即可，当然优先分给偶回文串。所以这是签到题?

L. La Vie En Rose

看起来这个信息很局部。

考虑如果$$n=m$$怎么做，我们从左往右爆力扫，然后你惊喜发现这个信息足够局部，以至于我们可以记录上一个间隔换没换来dp。

考虑对于原问题，我们双指针扫长$$m$$的子串，双栈代替队列来维护一下，也就是枚举中间那个断点是否被选了，然后两边dp。复杂度是线性。

M. Memento Mori

首先我们可以删去没有$$1$$的行列而不影响答案，这样复杂度只跟$$k$$相关了。

考虑$$(p_i-p_j)(c_i-c_j)>0$$说的是啥，看起来这个说的是$$[p_i>p_j]=[c_i>c_j]$$，然后对于任意$$i,j$$都满足的话，看起来说的是$$c$$离散化之后和$$p$$相同。

这个判定看起来非常不好，于是我们大胆猜测包含四个1的极小子矩形个数只有$$O(k^2)$$。枚举了几个扫描线方向，你发现我们可以这么做，枚举哪个点贡献了上边界，哪个点贡献了下边界，那么最多只有四个可行的子矩形，于是这样的子矩形确实只有$$O(k^2)$$个。要找到它们，从下往上扫，维护上边界下面所有点按列排序的结果，然后双指针扫这个结果和这一行的点，再把这一行归并进去，复杂度$$O(k^2)$$，空间是线性。

#### contest3

好像是sxyz出的?

我们班的团支书(不是OIer)的绰号就是Bo，因为他的名字有一个Bo字（

A. Sqrt Bo

注意到好像超过unsigned int的都无解，于是连高精都不用写。

B. Permutation Bo

拿这个题讲一讲期望的线性性（

根据期望的线性性拆开每个位置。也就是说

$$
\mathrm{E}(f(h))=\mathrm{E}(\sum_h\sum_{i=1}^n c_i[h_{i-1}<h_i>h_{i+1}])=\sum_{i=1}^n\mathrm{E}(\sum_h c_i[h_{i-1}<h_i>h_{i+1}])
$$

中间的概率应该是$$\frac{1}{3}$$，边上是$$\frac{1}{2}$$，于是直接做就行了。为什么$$n\leq 1000$$呢?

C. Life Winner Bo

对每种dp一遍，前缀和优化就行了。应该出到1e9/fn

D. Gambler Bo

这玩意是个lights out游戏，于是我们还是主元法，设出第一行然后递推出最后一行，然后高消最后一行。复杂度是$$O(n^3)$$。所以出题人拉了，居然没有听说过lights out（

E. Boss Bo

ancient/jy

这个ban掉一些子树的话，每个子树是一个区间，于是我们得到最多$$k+1$$个区间，然后对于sum我们就差分成前缀然后扫描线静态lct或者树剖BiT(这个是不是经典做法?求点到集合的lca深度和，就是把集合每个点到根的链+1，然后查询那个点到根的链和)，对于max和min看起来要分治多$$\log$$，但是实际上很有性质，min的话就是往上跳到第一个good node，max的话必然在直径端点取到，可以用合并直径的trick。

sum用静态lct是一个$$\log$$，min的话是线性，max直接对dfs序分治看起来是$$O(n\log n)-O(1)$$。总共是一个$$\log$$。

跟dwt讨论了一下，dwt给出了sum和max的二维数点俩$$\log$$做法，然后我们一致感觉这个静态lct和合并直径是难以省掉的。

F. Product Bo

原来已经帮你取好对数了（

注意到如果$$\binom{l}{m}\geq k$$，那么只有前$$l$$个是有用的。

考虑爆力扩展，我们一次会有$$m$$种扩展方式，如果$$m$$很大的话，比如$$m>10$$，那么$$l$$就会很小，算一算可以知道$$m=10,k=2\times 10^5$$的时候$$l=21$$，直接搜就行了。如果$$m$$超过了$$\frac{2}{n}$$，那么我们可以转而找选$$n-m$$个的第$$k$$小。不会分析复杂度（

G. Explorer Bo

注意题意是，不能上一次传送之后走过的所有边，而不是只有上一条。要最小化传送次数，然后最小化距离。

如果有$$c$$个叶子，那么我们每次传送前可以干掉两个叶子，于是需要$$\lceil\frac{c}{2}\rceil-1$$次。看起来需要讨论奇偶性。

如果有偶数个叶子，那么每一次都需要选两个叶子，否则可以有一次选随便一个点和一个叶子。考虑直接dp，我们选择一个叶子当根，设$$dp(u)$$表示$$u$$子树和$$u$$的父边都被覆盖了的最小代价。但是不一定只扔一条边上去啊?所以我们就失败了。

呃没有失败。猜测可以只扔最多两条边就行了，然后这看起来非常对，因为不会出现一棵子树没有叶子的情况。感觉上选什么点当根都是可以的。

H. Gardener Bo

第一个在bfs序上是三个区间。第二个是相当于子树点权和乘上子树点数，然后减去儿子们的子树点权和乘上子树点数，子树点数不变，点权和容易维护，然后儿子们在bfs序上是一个区间，所以线段树即可。

I. Palindrome Bo

这个问题不知道是不是强于最长回文子序列，感觉应该是不弱的。最长回文子序列可以转化成和反串的lcs，所以可以上经典bitset优化除掉一个$$w$$。

直接dp是$$O(n^3)$$的。扫值域，这玩意转移是个单点修改2-side查询max，可以分治扫描线BiT做到$$O(n^2\log^2 n)$$，看起来不是很有前途。写一下式子吧。

$$
dp(i,j)=1+\max_{i<k\leq l<j,a_i\geq a_k=a_l}dp(k,l)
$$

感觉了一下你发现这个东西可能满足四边形不等式，但是再感觉一下，好像它的不等号是反的。

外层从左往右扫$$j$$，内层扫$$i$$，你发现对于每个数值只有一个区间可能有效，所以可能的转移的变化量只有$$O(n)$$，然后如果从右往左扫$$i$$的话是只增不减的，于是随便维护一下就做完了。

J. 

## ptz营

可以在Baekjoon oj找到。在我开始写的时候一共有1115道题，非常的好啊!

### sc2016

#### contest1

同时是hdu多校16 contest2，所以收录于前面了。

