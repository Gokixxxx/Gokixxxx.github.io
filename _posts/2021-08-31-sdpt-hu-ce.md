---
layout: post
title: 省队胡策
subtitle: /kk
tags: 题选做
---

只有两场，迟迟没有放出来是因为咕了（

### chz

T1

给一个序列和$$k$$，定义一个区间的权值是其中只出现一次的数的个数，求有多少种划分这个序列的方式，使得每一段的权值不超过$$k$$。$$n,k\leq 10^5$$。

爆力dp显然，如何优化?

考虑加入一个数的时候，用数据结构维护左端点，那么相当于对一个区间的权值$$+1$$，另一个区间$$-1$$，要查询全局权值$$\leq k$$的位置的和。容易用分块搞定，每一块开一个桶就好了。

-----

T2

### dsq

T1

给一个序列，支持单点修改，查询一个区间所有子序列和的$$\mathrm{mex}$$，或者说做01背包之后最小的不能表示出的数。$$n\leq 5\times 10^5,q\leq 10^5,a_i\leq 10^9$$。

很有意思。考虑静态全局询问怎么做?

我们把所有数从小到大排序，维护一个极长的可以表示出的前缀$$[0,r]$$。假设现在要加入$$x$$，如果$$x\leq r+1$$，我们用$$r+x$$更新$$r$$；否则，答案就是$$r$$了。

如何加速?发现这个看起来很像能翻倍的样子，容易发现如果我们每次把所有$$\leq r+1$$的都加入，那么两轮就会让$$r$$翻倍(并且很松)。用树套树支持单点修改，查询区间内$$\leq$$某数的数的和，就可以做到$$O(q\log^2 n\log v)$$了!

考虑把值域分成$$\log$$块，每一块是$$[2^i,2^{i+1})$$。然后你发现，如果一块里面的$$\min$$被加入了，那么整个块都会被加入。这样就可以开一棵线段树，每个区间维护一下这$$\log$$块的和和$$\min$$，然后查询的时候先合并一遍，再爆力跳即可。复杂度是$$O(n\log v+q\log n\log v)$$。

dsq说可以用$$d$$叉树做到$$O(n+q\log^2 n/\log\log n)$$，空间可以把底层改成分块做到线性，但是我都不会/cy

-----

T2

笑晕了/cy

收录于 ode和组合计数。